<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zeanzai.github.io/cs-tips/cs-tips/docs/04-middleware/redis.html"><meta property="og:site_name" content="cs-tips"><meta property="og:title" content="Redis知识点汇总"><meta property="og:description" content="**日期** 迭代内容 ---------- ----------------------------------------------------------------------------------------- 23-11-24 1. 创建文档骨架，确定知识体系；2. 完成《概述》《对象系统》等篇；3. 完成《持久化》篇章； | 导学指引..."><meta property="og:type" content="article"><meta property="og:image" content="https://zeanzai.github.io/cs-tips/cs-tips/"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Redis知识点汇总"><meta property="article:author" content="zeanzai"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis知识点汇总","image":["https://zeanzai.github.io/cs-tips/cs-tips/"],"dateModified":null,"author":[{"@type":"Person","name":"zeanzai","url":"https://github.com/zeanzai"}]}</script><link rel="icon" href="/favicon.ico"><link rel="manifest" href="/cs-tips/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><link rel="icon" href="/cs-tips/favicon.ico"><title>Redis知识点汇总 | cs-tips</title><meta name="description" content="**日期** 迭代内容 ---------- ----------------------------------------------------------------------------------------- 23-11-24 1. 创建文档骨架，确定知识体系；2. 完成《概述》《对象系统》等篇；3. 完成《持久化》篇章； | 导学指引...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/cs-tips/assets/style-37e20de6.css" as="style"><link rel="stylesheet" href="/cs-tips/assets/style-37e20de6.css">
    <link rel="modulepreload" href="/cs-tips/assets/app-fa4d50d2.js"><link rel="modulepreload" href="/cs-tips/assets/framework-16b96b76.js"><link rel="modulepreload" href="/cs-tips/assets/redis.html-60f57732.js"><link rel="modulepreload" href="/cs-tips/assets/redis.html-bbc91c1a.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/cs-tips/" class="brand"><img class="logo" src="/cs-tips/logo.svg" alt="cs-tips"><!----><span class="site-name hide-in-pad">cs-tips</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/cs-tips/" class="nav-link" aria-label="主页"><span class="font-icon icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/cs-tips/docs/01-csbase/" class="nav-link" aria-label="要点提示"><span class="font-icon icon iconfont icon-ability" style=""></span>要点提示<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://github.com/zeanzai/cs-tips/issues" rel="noopener noreferrer" target="_blank" aria-label="问题反馈" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>问题反馈<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/zeanzai/cs-tips" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">搜索</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-computer" style=""></span><span class="title">01-CS基础</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="title">02-Java编程语言</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-layout" style=""></span><span class="title">03-框架</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-api" style=""></span><span class="title">04-中间件</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/cs-tips/docs/04-middleware/mysql.html" class="nav-link sidebar-link sidebar-page" aria-label="MySQL"><!---->MySQL<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/cs-tips/docs/04-middleware/nginx.html" class="nav-link sidebar-link sidebar-page" aria-label="nginx"><!---->nginx<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Redis知识点汇总"><!---->Redis知识点汇总<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#知识体系" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="知识体系"><!---->知识体系<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#本地缓存vs分布式缓存" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="本地缓存VS分布式缓存"><!---->本地缓存VS分布式缓存<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-对象系统" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. 对象系统"><!---->1. 对象系统<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-1-为什么要有对象系统" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.1. 为什么要有对象系统"><!---->1.1. 为什么要有对象系统<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-源代码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2. 源代码"><!---->1.2. 源代码<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-1-type-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2.1. type 属性"><!---->1.2.1. type 属性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-2-encoding-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2.2. encoding 属性"><!---->1.2.2. encoding 属性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-3-lru-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2.3. lru 属性"><!---->1.2.3. lru 属性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-4-refcount-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2.4. refcount 属性"><!---->1.2.4. refcount 属性<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-5-ptr-属性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2.5. ptr 属性"><!---->1.2.5. ptr 属性<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-3-一个对象在内存中的存储示意" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.3. 一个对象在内存中的存储示意"><!---->1.3. 一个对象在内存中的存储示意<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-4-内建对象" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.4. 内建对象"><!---->1.4. 内建对象<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#命令的类型检查和多态" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="命令的类型检查和多态"><!---->命令的类型检查和多态<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-5-总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.5. 总结"><!---->1.5. 总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-数据类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. 数据类型"><!---->2. 数据类型<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-redis-中的数据结构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1. redis 中的数据结构"><!---->2.1. redis 中的数据结构<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-1-sds" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.1. SDS"><!---->2.1.1. SDS<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-2-ziplist" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.2. ziplist"><!---->2.1.2. ziplist<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-3-quicklist" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.3. quicklist"><!---->2.1.3. quicklist<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-4-hashtable" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.4. hashtable"><!---->2.1.4. hashtable<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-5-skiplist" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.5. skiplist"><!---->2.1.5. skiplist<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#其他" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="其他"><!---->其他<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-基本数据类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2. 基本数据类型"><!---->2.2. 基本数据类型<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-1-字符串-string" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.1. 字符串 string"><!---->2.2.1. 字符串 string<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-2-列表-list" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.2. 列表 list"><!---->2.2.2. 列表 list<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-3-集合-set" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.3. 集合 set"><!---->2.2.3. 集合 set<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-4-有序集合-zset" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.4. 有序集合 zset"><!---->2.2.4. 有序集合 zset<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-5-散列-hash" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.5. 散列 hash"><!---->2.2.5. 散列 hash<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-6-流-stream" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.6. 流 stream"><!---->2.2.6. 流 stream<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-5-命令汇总" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.5. 命令汇总"><!---->2.5. 命令汇总<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-高级特性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 高级特性"><!---->3. 高级特性<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-1-事务" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1. 事务"><!---->3.1. 事务<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-2-lua-脚本" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2. LUA 脚本"><!---->3.2. LUA 脚本<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-3-消息队列-发布订阅" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3. 消息队列（发布订阅）"><!---->3.3. 消息队列（发布订阅）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-4-搜索引擎" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.4. 搜索引擎"><!---->3.4. 搜索引擎<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-5-管道" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.5. 管道"><!---->3.5. 管道<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-6-布隆过滤器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.6. 布隆过滤器"><!---->3.6. 布隆过滤器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-7-迭代器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.7. 迭代器"><!---->3.7. 迭代器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#事件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="事件"><!---->事件<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-内存管理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. 内存管理"><!---->4. 内存管理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-1-键的驱逐策略-删除策略" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1. 键的驱逐策略（删除策略）"><!---->4.1. 键的驱逐策略（删除策略）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-1-1-redis-中键的过期时间的管理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1.1. Redis 中键的过期时间的管理"><!---->4.1.1. Redis 中键的过期时间的管理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-1-2-删除带过期时间的-key-的通用做法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1.2. 删除带过期时间的 key 的通用做法"><!---->4.1.2. 删除带过期时间的 key 的通用做法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-1-3-redis-中的键的驱逐策略-删除策略" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.1.3. redis 中的键的驱逐策略（删除策略）"><!---->4.1.3. redis 中的键的驱逐策略（删除策略）<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-2-内存回收机制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.2. 内存回收机制"><!---->4.2. 内存回收机制<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-持久化机制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5. 持久化机制"><!---->5. 持久化机制<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-rdb-持久化方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.1. RDB 持久化方式"><!---->5.1. RDB 持久化方式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-1-配置参数有哪些" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.1.1. 配置参数有哪些？"><!---->5.1.1. 配置参数有哪些？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-2-触发条件有哪些" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.1.2. 触发条件有哪些？"><!---->5.1.2. 触发条件有哪些？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-3-持久化原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.1.3. 持久化原理"><!---->5.1.3. 持久化原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-4-有什么优缺点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.1.4. 有什么优缺点？"><!---->5.1.4. 有什么优缺点？<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-aof-持久化方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2. AOF 持久化方式"><!---->5.2. AOF 持久化方式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-1-配置参数有哪些" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2.1. 配置参数有哪些？"><!---->5.2.1. 配置参数有哪些？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-2-触发条件有哪些" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2.2. 触发条件有哪些？"><!---->5.2.2. 触发条件有哪些？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-3-持久化原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2.3. 持久化原理"><!---->5.2.3. 持久化原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-4-重写原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2.4. 重写原理"><!---->5.2.4. 重写原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-5-恢复" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2.5. 恢复"><!---->5.2.5. 恢复<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-6-有什么优缺点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2.6. 有什么优缺点"><!---->5.2.6. 有什么优缺点<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-3-混合持久化方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.3. 混合持久化方式"><!---->5.3. 混合持久化方式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-4-持久化方式的最佳实践" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.4. 持久化方式的最佳实践"><!---->5.4. 持久化方式的最佳实践<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#本地缓存" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="本地缓存"><!---->本地缓存<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#spring-boot-本地缓存示例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Spring Boot 本地缓存示例"><!---->Spring Boot 本地缓存示例<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#依赖配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="依赖配置"><!---->依赖配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#配置类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="配置类"><!---->配置类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#服务类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="服务类"><!---->服务类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#主应用类" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="主应用类"><!---->主应用类<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#springboot-guaua" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBoot+Guaua"><!---->SpringBoot+Guaua<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#springboot-ehcache" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="SpringBoot+Ehcache"><!---->SpringBoot+Ehcache<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#分布式缓存" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="分布式缓存"><!---->分布式缓存<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#spring-boot-分布式缓存示例" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Spring Boot 分布式缓存示例"><!---->Spring Boot 分布式缓存示例<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#依赖配置-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="依赖配置"><!---->依赖配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#配置类-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="配置类"><!---->配置类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#服务类-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="服务类"><!---->服务类<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="配置文件"><!---->配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#主应用类-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="主应用类"><!---->主应用类<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="总结"><!---->总结<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-运行模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6. 运行模式"><!---->6. 运行模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#单机模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="单机模式"><!---->单机模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#主从模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="主从模式"><!---->主从模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#哨兵模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="哨兵模式"><!---->哨兵模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#集群模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="集群模式"><!---->集群模式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#安装过程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="安装过程"><!---->安装过程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#查看集群及节点信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="查看集群及节点信息"><!---->查看集群及节点信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#部署视图" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="部署视图"><!---->部署视图<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#增加节点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="增加节点"><!---->增加节点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#变更节点角色" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="变更节点角色"><!---->变更节点角色<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#增加新节点后rehash" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="增加新节点后rehash"><!---->增加新节点后rehash<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#移除某节点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="移除某节点"><!---->移除某节点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-1-单机模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1. 单机模式"><!---->6.1. 单机模式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-1-1-安装过程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1.1. 安装过程"><!---->6.1.1. 安装过程<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-2-主从模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2. 主从模式"><!---->6.2. 主从模式<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-2-1-安装" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2.1. 安装"><!---->6.2.1. 安装<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-3-哨兵模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3. 哨兵模式"><!---->6.3. 哨兵模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-4-集群模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.4. 集群模式"><!---->6.4. 集群模式<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-生产运维" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7. 生产运维"><!---->7. 生产运维<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-1-基准测试" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.1. 基准测试"><!---->7.1. 基准测试<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-2-慢查询" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.2. 慢查询"><!---->7.2. 慢查询<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-3-监控和报警" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.3. 监控和报警"><!---->7.3. 监控和报警<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-4-性能优化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.4. 性能优化"><!---->7.4. 性能优化<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_8-生产实践" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8. 生产实践"><!---->8. 生产实践<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_8-1-生产场景" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.1. 生产场景"><!---->8.1. 生产场景<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_8-2-问题及解决" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.2. 问题及解决"><!---->8.2. 问题及解决<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#资料" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="资料"><!---->资料<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#面试题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="面试题"><!---->面试题<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/cs-tips/docs/04-middleware/es.html" class="nav-link sidebar-link sidebar-page" aria-label="搜索引擎知识点汇总"><!---->搜索引擎知识点汇总<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/cs-tips/docs/04-middleware/mq.html" class="nav-link sidebar-link sidebar-page" aria-label="消息队列知识点汇总"><!---->消息队列知识点汇总<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-structure" style=""></span><span class="title">05-分布式</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-like" style=""></span><span class="title">06-软件质量管理</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-editor" style=""></span><span class="title">07-工程设计</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Redis知识点汇总</h1><!----><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#知识体系" class="router-link-active router-link-exact-active toc-link level2">知识体系</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#本地缓存vs分布式缓存" class="router-link-active router-link-exact-active toc-link level2">本地缓存VS分布式缓存</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-对象系统" class="router-link-active router-link-exact-active toc-link level2">1. 对象系统</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-1-为什么要有对象系统" class="router-link-active router-link-exact-active toc-link level3">1.1. 为什么要有对象系统</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-源代码" class="router-link-active router-link-exact-active toc-link level3">1.2. 源代码</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-1-type-属性" class="router-link-active router-link-exact-active toc-link level4">1.2.1. type 属性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-2-encoding-属性" class="router-link-active router-link-exact-active toc-link level4">1.2.2. encoding 属性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-3-lru-属性" class="router-link-active router-link-exact-active toc-link level4">1.2.3. lru 属性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-4-refcount-属性" class="router-link-active router-link-exact-active toc-link level4">1.2.4. refcount 属性</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-2-5-ptr-属性" class="router-link-active router-link-exact-active toc-link level4">1.2.5. ptr 属性</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-3-一个对象在内存中的存储示意" class="router-link-active router-link-exact-active toc-link level3">1.3. 一个对象在内存中的存储示意</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-4-内建对象" class="router-link-active router-link-exact-active toc-link level3">1.4. 内建对象</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#命令的类型检查和多态" class="router-link-active router-link-exact-active toc-link level3">命令的类型检查和多态</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_1-5-总结" class="router-link-active router-link-exact-active toc-link level3">1.5. 总结</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-数据类型" class="router-link-active router-link-exact-active toc-link level2">2. 数据类型</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-redis-中的数据结构" class="router-link-active router-link-exact-active toc-link level3">2.1. redis 中的数据结构</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-1-sds" class="router-link-active router-link-exact-active toc-link level4">2.1.1. SDS</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-2-ziplist" class="router-link-active router-link-exact-active toc-link level4">2.1.2. ziplist</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-3-quicklist" class="router-link-active router-link-exact-active toc-link level4">2.1.3. quicklist</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-4-hashtable" class="router-link-active router-link-exact-active toc-link level4">2.1.4. hashtable</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-1-5-skiplist" class="router-link-active router-link-exact-active toc-link level4">2.1.5. skiplist</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#其他" class="router-link-active router-link-exact-active toc-link level4">其他</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-基本数据类型" class="router-link-active router-link-exact-active toc-link level3">2.2. 基本数据类型</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-1-字符串-string" class="router-link-active router-link-exact-active toc-link level4">2.2.1. 字符串 string</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-2-列表-list" class="router-link-active router-link-exact-active toc-link level4">2.2.2. 列表 list</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-3-集合-set" class="router-link-active router-link-exact-active toc-link level4">2.2.3. 集合 set</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-4-有序集合-zset" class="router-link-active router-link-exact-active toc-link level4">2.2.4. 有序集合 zset</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-5-散列-hash" class="router-link-active router-link-exact-active toc-link level4">2.2.5. 散列 hash</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-2-6-流-stream" class="router-link-active router-link-exact-active toc-link level4">2.2.6. 流 stream</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_2-5-命令汇总" class="router-link-active router-link-exact-active toc-link level3">2.5. 命令汇总</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-高级特性" class="router-link-active router-link-exact-active toc-link level2">3. 高级特性</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-1-事务" class="router-link-active router-link-exact-active toc-link level3">3.1. 事务</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-2-lua-脚本" class="router-link-active router-link-exact-active toc-link level3">3.2. LUA 脚本</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-3-消息队列-发布订阅" class="router-link-active router-link-exact-active toc-link level3">3.3. 消息队列（发布订阅）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-4-搜索引擎" class="router-link-active router-link-exact-active toc-link level3">3.4. 搜索引擎</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-5-管道" class="router-link-active router-link-exact-active toc-link level3">3.5. 管道</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-6-布隆过滤器" class="router-link-active router-link-exact-active toc-link level3">3.6. 布隆过滤器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_3-7-迭代器" class="router-link-active router-link-exact-active toc-link level3">3.7. 迭代器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#事件" class="router-link-active router-link-exact-active toc-link level3">事件</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-内存管理" class="router-link-active router-link-exact-active toc-link level2">4. 内存管理</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-1-键的驱逐策略-删除策略" class="router-link-active router-link-exact-active toc-link level3">4.1. 键的驱逐策略（删除策略）</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-1-1-redis-中键的过期时间的管理" class="router-link-active router-link-exact-active toc-link level4">4.1.1. Redis 中键的过期时间的管理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-1-2-删除带过期时间的-key-的通用做法" class="router-link-active router-link-exact-active toc-link level4">4.1.2. 删除带过期时间的 key 的通用做法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-1-3-redis-中的键的驱逐策略-删除策略" class="router-link-active router-link-exact-active toc-link level4">4.1.3. redis 中的键的驱逐策略（删除策略）</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_4-2-内存回收机制" class="router-link-active router-link-exact-active toc-link level3">4.2. 内存回收机制</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-持久化机制" class="router-link-active router-link-exact-active toc-link level2">5. 持久化机制</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-rdb-持久化方式" class="router-link-active router-link-exact-active toc-link level3">5.1. RDB 持久化方式</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-1-配置参数有哪些" class="router-link-active router-link-exact-active toc-link level4">5.1.1. 配置参数有哪些？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-2-触发条件有哪些" class="router-link-active router-link-exact-active toc-link level4">5.1.2. 触发条件有哪些？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-3-持久化原理" class="router-link-active router-link-exact-active toc-link level4">5.1.3. 持久化原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-1-4-有什么优缺点" class="router-link-active router-link-exact-active toc-link level4">5.1.4. 有什么优缺点？</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-aof-持久化方式" class="router-link-active router-link-exact-active toc-link level3">5.2. AOF 持久化方式</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-1-配置参数有哪些" class="router-link-active router-link-exact-active toc-link level4">5.2.1. 配置参数有哪些？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-2-触发条件有哪些" class="router-link-active router-link-exact-active toc-link level4">5.2.2. 触发条件有哪些？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-3-持久化原理" class="router-link-active router-link-exact-active toc-link level4">5.2.3. 持久化原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-4-重写原理" class="router-link-active router-link-exact-active toc-link level4">5.2.4. 重写原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-5-恢复" class="router-link-active router-link-exact-active toc-link level4">5.2.5. 恢复</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-2-6-有什么优缺点" class="router-link-active router-link-exact-active toc-link level4">5.2.6. 有什么优缺点</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-3-混合持久化方式" class="router-link-active router-link-exact-active toc-link level3">5.3. 混合持久化方式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_5-4-持久化方式的最佳实践" class="router-link-active router-link-exact-active toc-link level3">5.4. 持久化方式的最佳实践</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#本地缓存" class="router-link-active router-link-exact-active toc-link level2">本地缓存</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#spring-boot-本地缓存示例" class="router-link-active router-link-exact-active toc-link level3">Spring Boot 本地缓存示例</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#依赖配置" class="router-link-active router-link-exact-active toc-link level4">依赖配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#配置类" class="router-link-active router-link-exact-active toc-link level4">配置类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#服务类" class="router-link-active router-link-exact-active toc-link level4">服务类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#主应用类" class="router-link-active router-link-exact-active toc-link level4">主应用类</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#springboot-guaua" class="router-link-active router-link-exact-active toc-link level3">SpringBoot+Guaua</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#springboot-ehcache" class="router-link-active router-link-exact-active toc-link level3">SpringBoot+Ehcache</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#分布式缓存" class="router-link-active router-link-exact-active toc-link level2">分布式缓存</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#spring-boot-分布式缓存示例" class="router-link-active router-link-exact-active toc-link level3">Spring Boot 分布式缓存示例</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#依赖配置-1" class="router-link-active router-link-exact-active toc-link level4">依赖配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#配置类-1" class="router-link-active router-link-exact-active toc-link level4">配置类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#服务类-1" class="router-link-active router-link-exact-active toc-link level4">服务类</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#配置文件" class="router-link-active router-link-exact-active toc-link level4">配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#主应用类-1" class="router-link-active router-link-exact-active toc-link level4">主应用类</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#总结" class="router-link-active router-link-exact-active toc-link level2">总结</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-运行模式" class="router-link-active router-link-exact-active toc-link level2">6. 运行模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#单机模式" class="router-link-active router-link-exact-active toc-link level2">单机模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#主从模式" class="router-link-active router-link-exact-active toc-link level2">主从模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#哨兵模式" class="router-link-active router-link-exact-active toc-link level2">哨兵模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#集群模式" class="router-link-active router-link-exact-active toc-link level2">集群模式</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#安装过程" class="router-link-active router-link-exact-active toc-link level4">安装过程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#查看集群及节点信息" class="router-link-active router-link-exact-active toc-link level4">查看集群及节点信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#部署视图" class="router-link-active router-link-exact-active toc-link level4">部署视图</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#增加节点" class="router-link-active router-link-exact-active toc-link level4">增加节点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#变更节点角色" class="router-link-active router-link-exact-active toc-link level4">变更节点角色</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#增加新节点后rehash" class="router-link-active router-link-exact-active toc-link level4">增加新节点后rehash</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#移除某节点" class="router-link-active router-link-exact-active toc-link level4">移除某节点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-1-单机模式" class="router-link-active router-link-exact-active toc-link level3">6.1. 单机模式</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-1-1-安装过程" class="router-link-active router-link-exact-active toc-link level4">6.1.1. 安装过程</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-2-主从模式" class="router-link-active router-link-exact-active toc-link level3">6.2. 主从模式</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-2-1-安装" class="router-link-active router-link-exact-active toc-link level4">6.2.1. 安装</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-3-哨兵模式" class="router-link-active router-link-exact-active toc-link level3">6.3. 哨兵模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_6-4-集群模式" class="router-link-active router-link-exact-active toc-link level3">6.4. 集群模式</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-生产运维" class="router-link-active router-link-exact-active toc-link level2">7. 生产运维</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-1-基准测试" class="router-link-active router-link-exact-active toc-link level3">7.1. 基准测试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-2-慢查询" class="router-link-active router-link-exact-active toc-link level3">7.2. 慢查询</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-3-监控和报警" class="router-link-active router-link-exact-active toc-link level3">7.3. 监控和报警</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_7-4-性能优化" class="router-link-active router-link-exact-active toc-link level3">7.4. 性能优化</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_8-生产实践" class="router-link-active router-link-exact-active toc-link level2">8. 生产实践</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_8-1-生产场景" class="router-link-active router-link-exact-active toc-link level3">8.1. 生产场景</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#_8-2-问题及解决" class="router-link-active router-link-exact-active toc-link level3">8.2. 问题及解决</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#资料" class="router-link-active router-link-exact-active toc-link level2">资料</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cs-tips/docs/04-middleware/redis.html#面试题" class="router-link-active router-link-exact-active toc-link level2">面试题</a></li><!----><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="redis知识点汇总" tabindex="-1"><a class="header-anchor" href="#redis知识点汇总" aria-hidden="true">#</a> Redis知识点汇总</h1><table><thead><tr><th><strong>日期</strong></th><th><strong>迭代内容</strong></th></tr></thead><tbody><tr><td>23-11-24</td><td>1. 创建文档骨架，确定知识体系；2. 完成《概述》《对象系统》等篇；3. 完成《持久化》篇章；</td></tr></tbody></table><div class="hint-container tip"><p class="hint-container-title">导学指引</p><ol><li>首先要了解 Redis 有哪些功能特性，背景；</li><li>其次再了解 Redis 的对象系统，支持哪些数据类型，又根据对象系统设计出了哪些底层数据结构，对象系统是如何支持命令多态的；</li><li>之后要了解 Redis 的企业级的特性：持久化与高可用；</li><li>再之后要了解 Redis 的高级的特性：常用客户端、事务、管道、迭代器、发布订阅、分布式问题解决方案；</li><li>最后要了解 Redis 生产级的运维特性：基准测试、监控与告警、性能优化等；</li></ol></div><h2 id="知识体系" tabindex="-1"><a class="header-anchor" href="#知识体系" aria-hidden="true">#</a> 知识体系</h2><ul><li><a href="https://www.yuque.com/zeanzai.me/nox53r/aoprriuexhb7r5wr" target="_blank" rel="noopener noreferrer"><strong>1010.简介</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ol><li>什么是 Redis</li><li>版本迭代</li><li>为什么使用缓存</li><li>常见的使用到 Redis 的业务场景</li><li>本地缓存与分布式缓存的区别</li><li>本地缓存的实战过程</li></ol></blockquote><ul><li><a href="https://www.yuque.com/zeanzai.me/nox53r/ab23mmumc0znoivl" target="_blank" rel="noopener noreferrer"><strong>20.对象系统——概述</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ol><li>为什么设计对象系统</li><li>如何实现命令的多态</li><li>内建对象有哪些</li></ol></blockquote><ul><li><a href="https://www.yuque.com/zeanzai.me/nox53r/fhzz7q63idveolq5" target="_blank" rel="noopener noreferrer"><strong>21.对象系统——支持的数据类型</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ol><li>值对象支持哪些数据类型，分别有哪些常用命令和分别有哪些业务场景</li></ol></blockquote><ul><li><a href="https://www.yuque.com/zeanzai.me/nox53r/gxxmb58di3sfxgs2" target="_blank" rel="noopener noreferrer"><strong>22.对象系统——底层数据结构</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ol><li>值对象底层有哪些数据结构，转换条件是怎样的，如何高效利用这些转换条件</li></ol></blockquote><ul><li><a href="https://www.yuque.com/zeanzai.me/nox53r/ge8rwhsa0011756m" target="_blank" rel="noopener noreferrer"><strong>30.持久化机制</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ol><li>RDB 基本原理，配置参数是怎样的，手动触发与自动触发，什么是增量复制，有哪些优缺点，如何保证备份时的数据一致性， 备份时服务崩溃应如何应对，生产环境下如何配置</li><li>AOF 基本原理，配置参数是怎样的，手动触发与自动触发，什么是重写，有哪些优缺点，全量复制和增量复制，如何保证备份时的数据一致性，备份时服务崩溃应如何应对，生产环境下如何配置</li><li>混合方式配置参数，实现原理【恢复数据的过程】，相比单一持久化方式的优势，</li><li>数据驱逐策略有哪些，如何使用，底层算法是怎样的</li></ol></blockquote><ul><li><a href="https://www.yuque.com/zeanzai.me/nox53r/zsf5og0or2godcan" target="_blank" rel="noopener noreferrer"><strong>40.高可用机制</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ol><li>主从模式</li><li>哨兵模式</li><li>集群模式</li></ol></blockquote><ul><li><a href="https://www.yuque.com/zeanzai.me/nox53r/fyl7dtpz44ucvbp3" target="_blank" rel="noopener noreferrer"><strong>50.高级特性——事务、管道、迭代器、发布与订阅、布隆过滤器</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ol><li>事务</li><li>管道</li><li>迭代器</li><li>发布与订阅</li><li>布隆过滤器</li></ol></blockquote><ul><li><a href="https://www.yuque.com/zeanzai.me/nox53r/sdt8ga914angv80u" target="_blank" rel="noopener noreferrer"><strong>51.高级特性——分布式的相关解决方案</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ol><li>分布式锁</li><li>分布式 ID</li><li>分布式限流</li></ol></blockquote><ul><li><a href="https://www.yuque.com/zeanzai.me/nox53r/efc8isa3ipdy4mf6" target="_blank" rel="noopener noreferrer"><strong>60.生产运维——基准测试、慢查询、性能优化、监控与告警</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ol><li>基准测试</li><li>慢查询</li><li>性能优化</li><li>监控与告警</li></ol></blockquote><figure><img src="/cs-tips/assets/1726158188826-ec20bdfe.png" alt="1726158188826" tabindex="0" loading="lazy"><figcaption>1726158188826</figcaption></figure><figure><img src="/cs-tips/assets/1726158220767-ae116957.png" alt="1726158220767" tabindex="0" loading="lazy"><figcaption>1726158220767</figcaption></figure><h2 id="本地缓存vs分布式缓存" tabindex="-1"><a class="header-anchor" href="#本地缓存vs分布式缓存" aria-hidden="true">#</a> 本地缓存VS分布式缓存</h2><p><strong>本地缓存</strong>和<strong>分布式缓存</strong>在架构和使用场景上存在显著区别：</p><table><thead><tr><th></th><th>本地缓存</th><th>分布式缓存</th></tr></thead><tbody><tr><td>含义</td><td>与应用程序在同一台主机节点上，多是进程间访问，与JVM生命周期一致，大多不会产生网络IO，因此访问速度更快</td><td>大多具备独立部署的主机节点，跨进程访问，会产生网络IO，访问速度较本地缓存更慢，支持的数据结构更多</td></tr><tr><td>持久性</td><td>大多不具备持久性，存在的生命周期与JVM的生命周期一致</td><td>根据分布式缓存的技术选型而定，如redis具有完善的持久化机制</td></tr><tr><td>存储空间</td><td>受JVM堆空间大小限制</td><td>受部署节点的物理主机的内存大小限制</td></tr><tr><td>技术选型</td><td>实现简单，在项目中集成相关的组件即可，如ehcache、guava等</td><td>实现也较为简单，如Redis、Memercached等</td></tr><tr><td>适用场景</td><td>适用于读多写少的，变更较少的业务场景，比如数据字典等</td><td>支持更多的业务场景</td></tr><tr><td>一致性</td><td>- 多个应用实例之间无法共享数据，一致性较差；- 与数据库数据存在一致性问题，需在应用端进行保证；</td><td>- 可在多个应用实例之间共享数据，一致性较好；- 仍然存在与数据库数据不一致的情况，也需要在应用端进行保证；</td></tr></tbody></table><h2 id="_1-对象系统" tabindex="-1"><a class="header-anchor" href="#_1-对象系统" aria-hidden="true">#</a> 1. 对象系统</h2><p>Redis使用对象来表示每一个键值对，在Redis中创建的每一个键值对，Redis都会为我们创建至少两个RedisObject对象：</p><ul><li><strong>键对象，即 key</strong> ；键对象的数据结构为字符串；</li><li><strong>值对象，即 value</strong> ；而值对象因其保存的数据内容不一样，因而其使用的数据结构也不一样。</li></ul><p>事实上，数据库中的每个键、值，以及 Redis 本身处理的参数, 都表示为这种数据类型。</p><blockquote><p>这里，我们介绍一下Redis <code>值对象</code>所支持的数据类型。所谓 <code>值对象</code>所支持的数据类型，是从业务角度来讲的，如String，是指使用Redis的业务，需要保存到Redis中的数据的类型为String，而不是指别的其他。同理List，是指使用Redis的业务场景中，保存到Redis的数据的数据类型是List，也不是指其他。</p><p>说白了，<code>键对象</code>就是一个字符串，相当于对保存的值起了个名字。</p><p>读者要对这一点很清楚。</p></blockquote><p>3.2版本是一个重要的稳定版本，有很多的更新，详见<a href="http://antirez.com/news/104" target="_blank" rel="noopener noreferrer">这里<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h3 id="_1-1-为什么要有对象系统" tabindex="-1"><a class="header-anchor" href="#_1-1-为什么要有对象系统" aria-hidden="true">#</a> 1.1. 为什么要有对象系统</h3><ol><li>有些命令要求只能用于某种特定类型的键，而有些命令则可以作用到所有类型的键，这就需要构建一种可以识别键的类型的机制，让命令执行时通过判断键的类型来选择合适的处理方式；</li><li>Redis 是内存数据库，为了节省内存资源，Redis 设计了多种数据类型，而某些命令作用于其中某种类型的数据时，并不需要关注其底层到底使用的是那种数据结构，因此，还需要建立一种能够识别值的数据类型的机制，让命令执行时能够自行判断到底应该用到哪种数据结构上；</li></ol><p>因此，redis 设计了自己的类型系统——redisObject对象。</p><p>主要有两点原因：</p><ol><li>为了更好的管理 redis 中的数据；</li><li>为了适应命令的多态；</li></ol><h3 id="_1-2-源代码" tabindex="-1"><a class="header-anchor" href="#_1-2-源代码" aria-hidden="true">#</a> 1.2. 源代码</h3><figure><img src="/cs-tips/assets/1718577572091-de402671.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span> <span class="token punctuation">{</span>
  
    <span class="token comment">// 类型，标识该对象是什么类型的对象（String 对象、 List 对象、Hash 对象、Set 对象和 Zset 对象）；</span>
    <span class="token keyword">unsigned</span> type<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token comment">// 编码方式</span>
    <span class="token keyword">unsigned</span> encoding<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token comment">// LRU - 24位, 记录最末一次访问时间（相对于lru_clock）; 或者 LFU（最少使用的数据：8位频率，16位访问时间）</span>
    <span class="token keyword">unsigned</span> lru<span class="token operator">:</span>LRU_BITS<span class="token punctuation">;</span> <span class="token comment">/* LRU time (relative to global lru_clock) or
                            * LFU data (least significant 8 bits frequency   LFU： Least Frequently Used， 最不频繁使用
                            * and most significant 16 bits access time). */</span>

    <span class="token comment">// 引用计数</span>
    <span class="token keyword">int</span> refcount<span class="token punctuation">;</span>

    <span class="token comment">// 指向底层数据结构实例</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>  
<span class="token punctuation">}</span> robj<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHUAAAD2CAYAAADoIMjKAAAOUElEQVR42u2d32sd1RbH5x/qQ1UuXPQ+GFtIsW1KvPhQLhfBIm1uaQtSTDkYSG+C1iIXlXCbFBJTiKCISgq2CSqkD0ViKkai9koVLNSi1YA+tKQv+87a82vtPXvP7JnMj3NyvgNfPGdmz5rJ+sxae++151RPYNtxmwcXACo2QMUGqNgAFRugAiq2Pod6/94v4sfF98Xq2VHxyXPPiMWnnxAfDDwqPnjyEcgm3z/kJ/IX+Y38R35sHeq99Rvi85dfFIv7HhernVPih7cviN8+vSLuf/WFePi/DV/fQFZtSD+Rv8hv5D/yI/mT/No41K0//xBrr4yJq8/uE9/PvCG2vv0akCoQ+ZH8SX4l/5KfG4H665er8qLrr46JhzcRjbXI9yv5l/xM/q4V6p1rn4kPn3pM/PTOLBzfgMjP5G/yey1Q6YmhC/z80XtweIMif5Pfi0Ss59qHUipAhLYXseR/1z7WCSp12rIPhYNbE/mfOFQClYbX9JRgUNT+4Ik4uEx3cqHSvImG2e3/YQti3PPE+Lv+55XXxCHvhLjmct67J4Tnnxfp0OsrybEsO3Te4Gvidul73SsurVTrA+JAPLYFlSocNCHujnkog+p4zu3X9/ogObQVcWnQh3tyIR/qtu+1eqjEgXjkVZ4yocrSX+dUtX+wjIC9vjO9JBJ4NCnREUKg/SdPWCKVtVEi0eZYtj+0c0nCp/NZeyVS1WuoD1bwsAXH6J542+rBEg/iUhoq1SSphFU5VP7HSsdG39VIunYyDV6HKqMxijzp4BC2NX0G15DwpZ3ketIWv174Wd5HdA3l/gNbEeTkXuqJVJIsKfpcSkOlYjPVJquHmqQ8xZGKM1WHKQ60QnXrEwlSApU7n8GIz9fTvvk+mki/JOJBXEpDpVWEoDhfdfpNnH07Tn1c5Ch3Z8pI0lOjM1QOxQ5Vv0d5vvaANgGVeBCX0lBpeajy1RYTVFOkOUaq3ZmufaqlK1CgWgC1EKnEg7iUh/rkI9XflB5BmmN5P5rq4wx9ahx1ep/qPPpNznfqU8NzgodNzSbJ+XVC/UZy6W6oqbmkAUI4Kr500hSpanpMTXkc5qnJ6JddO2P0m7ah33vUvh6w3Qe1V7St4kO9AtQSigZeRQodgAoBKgSogAqogAoBKgSoEKACKqACKqACKgSoEKBCgAqogAqoEKBCgAoBKqACKqA6QL1w7hxUk1qD+pe//k28+dYUVLHIr61C3dzchCoWoAIqoAJqr0LdmBEHvI5YauBaNy8eEN7QjLgJqDtHgJql5Y7iHOmsM0v+55tiZsgTnTOd5Ndrcn/QbumMl96vRaq0Jdsc8O242Q1sRLa1qF/uqPYAtRzU+Jh06AExs6GfQ+3C/Ryq/Bzu31wSnRheht2wXWeZPThRuxB2cEyzAajFoB64eDNsSw43QTX3qYmdgnZ5dPKHRL+m7R4A1SH9Lm+mna+kVgaIQZBRlgHVaHe5Y/h3KIJjqT4UUN2hJjCyoSZi7QpEqhWqDRQitSDUjL7P5HwVWLk+1fywqH1qkA2idMyPoU/NVTKS7YgZp/QbOjUj/aop2tWuPvrVMgNLz52LfjtAbVP64AgVpd6Eqg96+FwUUFFRAlQIUCFABdTehmorNtR9TT7dAdSehxrNlwG1xnllXABY0EpyG9HEPywkXEwKBspc1LaMZlpMpynQmY4aqQ0uuvdhpKaL+QG8CL69NGhcRrNeC+m30fRLUJK6q1ou5NFJ7eT3rGU0w1sMgQ1AbbZPlelxiaXeTUMdV4dqXkZLrcHG9gC14YESfQ8K80lk6pHKvjsujfF1Wa42wPbl6DcYnfJ92hJYRp+qLqNhStMS1GgQpKVgJfrSL5EpQGzLaNb+dQmj36YV95emtx5quyag1hu1qT6ybqh+5Da4ZIfaL2q/gAqoDlCPvHAMqlitQ/3vhSmoYrUOdevB71DFAlRABVRA7VWot6bFIa8jVhq41u35/cIbnha3AXXnCFCztNJRnCOdNXbV//ydmB/2xPgYW0KT+4N2K2Neer8WqdKWbLPft+NmN7CRvC2xot8rtweo5aDGx6RD94v5W/o51C7cz6HKz+H+B1eD/9dqnt2w3fgKe3CidiHs4JhmA1CLQT00/13YlhxugmruUxM7Be3y6OQPiX5N2z0AqkP6Xfk97XwltTJADIKMsgyoRrsrprclgmOpPhRQ3aEmMLKhJmLtCkSqFaoNFCK1INSMvs/kfBVYuT7V/LCofWqQDaJ0zI+hT81VMpLtiHmn9Bs6NSP9qina1a4++tUyA0vP4/N+O0BtU/rgCBWl3oSqD3r4XBRQUVECVAhQIUAF1L6Hyst+NRQLth6k57aA2iTUmhTNsfsTqm1JS0ZQR4wPmyf8fIktcZxafFAcyq4TLK/pkZqz9MYLDGMdbZXGsBTnt1EidRsL9T0GNWNJK3SiUn4LnayUA/VifcbSWVRkCB4IM9T8pbe8UmBUierX9Ju3pKWX9ozlPEMBX68W6VFiXDorsKSX0Q/TfQY2+hqqeUnLvvRmc1Z6P0WkdLDTemjOQoEL1Fu87tvPUB2XtJqKVKelN8t987Vcru2C7ek+VVnSskLVFrrZUpq9T1VTa1afmr/05rq81s9TGtuSVgZU+yjXbfR7aH7ad3gRqOrLZfPzOaNfE9T+Gf32pvRXYtzPA9Quexmc9ZOlKlB+5JZc5gNU1H4BFVAdoL5w7BhUsVqHevHf/4IqVutQxdo0VLEAFVABFVB7FerHz4thb0hcb+Badyd3C2/P8+IuoO4cAWqW5oYU50hnHX3J/3xeLOzxxMTRoaTCI/cH7a4f9dL7tUiVtmSb3b4dN7uBjci2FvVzQ6o9QC0HNT4mHbpbLHysn0Ptwv0cqvwc7l97SUzE8DLshu0m5tiDE7ULYQfHNBuAWgzq8OT5sC053ATV3Kcmdgra5dHJHxL9mrZ7AFSH9Ds3nXa+kloZIAZBRlkGVKPduSHD4ndwLNWHAqo71ARGNtRErF2BSLVCtYFCpBaEmtH3mZyvAivXp5ofFrVPDbJBlI75MfSpuUpGskNiwSn9hk7NSL9qina1q49+tczA0vPEpN8OUNuUPjhCRak3oeqDHj4XBVRUlAAVAlQIUAG196Hq04/tTpkMRXqlJGgqbgBq90GlUbC+upMaCUfzXkBtFmoYScN7wmjTF8R52S5rsVwv2odFiuGjQ0qkEvym57V9CpVFbRbUIovbkR2k3/YiVS3nFYRqAEcRabQPqE1Btax1ukDVI13vbwG1+6BmvjOkrATZRsWWIj6gNg3VYSnMNQIRqV0AVXuxbGHSPPrlb0hkzlU1qBj97kT5kCcAdae91zvUeCoGVNR+ARVQHaAe/effoYrVOtTx/8xCFat1qGt3BFSxABVQARVQARVQIUCFABVQARVQARVQARVQY12eEN7+BbGU2e66GPGGxcTaNp1D15IL4RXYctXaghjwJsQsIrUeqEtTw2Jg6m6zUdaXUONIvSsm9nti5PRE8mrJ6et+m2C/NcLk+T4sOh5F/GVmI9xHQFW7kcPVdmuW86P7GLlseNBCcCOnk9dignbUJtpHYMs/nD0NVQUTOSDDGUq7yMHR99BmCFGCjYBqNmd9IDKKQ9ABFH5+HlQvzgJkK/47EKkeS4/c6XlQE6dJcHrU8WiNoNr6cn1/bD8PKrs/bgNQLU7Lg8ogKGlWSX0q1BR820MRQ8lPv7N3ALU+qHGKNQCrKlJ5dAJqvVD1VMj7NwWqqR0dy+lTlUgH1O1AjUbAttGvFnF89Kr3tzyKjaPcjP1stDwwteCWfuMRcD+NfvtMS1MTgLqz5Gec03nVM0BF7RdQARVQARVQARUCVEAFVEAFVEAFVECFdgTUfxw5AVWs1qGeffMIVLFah3rj3nmoYgEqoAIqoAIqoEKACgEqoAIqoAIqoAIqoNam9cNiwBsUc4Zjy9O7hHfwsFi2nTd63OEax8WIt0tMrgNqV8gGdW7U84EOihFftgcCUKv6Y64MqhCUKBwTkwfZj3yvWCKVbMg2u3xo9khVgQe2R6YPJz+zmB7Trklgg+8DB3fF9yAfENkWUJ2iQjo+TJHkvBiCBBe241DXAygB8BCICSqdT3aj/8bwuJ3oPvg9he2c0jaghgojgUUJBxRHJ2/HoeqRrn93ui5L0fJ7Gmodkbmj+9Q4OpW0elz+kiyBypzO2qX60IJQjfYNUHk7QC0ymo1TYxuRyr8DamUp2DNEZm6fqkR0Rp9qu2bUNqdPBdSyKTg11Sg6+g1Hs0XS7+hg2n583WT0a07TgNpl2kYE+g/VCKDuLKjL04O1FCYAFbVfQAVUQAVUCFAhQAVUQAVUQAVUQAVUqMeg4vekO+z3qRfOnYNqUmtQoXYEqIAKqIAKASoEqBCgAqob1IFHfSMbcGRXaUNyKQ118eknxP2vvoAju0jEg7iUhvrJc8+I3z69Amd2kYgHcSkNdfXsqPjh7QtwZheJeBCX0lB/XHxfrHZOwZldJOJBXEpDvX/vF7G473Gx9e3XcGgXiDgQD+JSGiptn7/8ovh+5g04tQtEHIhH3pYL9d76DXH12X3i4U1MbVqV73/iQDy2DZW2tVfGxPqrY3BsiyL/EweXzQnq1p9/yKfkp3dm4eAWRH4n/xOHyqDS9uuXq+LDpx4TP3/0HhzdoMjf5Hfyv+vmDJW2O9c+kxdAxDYXoeRv8nuRrRDUKGIpFcg+FoOn2gZF5F/yc5EILQ016mOp06aL0jAb89jq5qHkT/Ir+de1D60EKp/u0LyJJsRU6aASFtUmg0UARHHeagv5ifwlS3++/8iP5E+XaUttUHnlSZYUz47KYjOtItDyEK37QRb5/iE/kb/Ib+S/vEpRo1CxddcGqICKDVCxASo2QMUGqICKrYe3/wMSCNbXOr4WQAAAAABJRU5ErkJggg==" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAApQAAABtCAYAAAAfzfHEAAAKeElEQVR42u3dzW8c5QGA8fmHOHCp1EiO4oRIFc0HdQkEQpxUtmhjaKuiIBE5sRTjoKqookpkQWLkyAfnH0CCODcryFzSAxISEXBAsZAP2FxyQD293Xd2Znd2d7z+yHj9sb9HeoRnd2aXvODXz74z4yQBAAAAeAYSQwAAAABBCQAAAEEJAAAAQQkAAABBCQAAAAhKAAAACEoAAAAISgAAAAhKAAAAQFACAABAUAIAAEBQAgAAQFACAAAAghIAAACCEgAAAIISAAAAgnK3WJpMQjK5VN9Yng9DyVRYKtvxq6mQnJkPK9kxQ/dW/Nc2fgCqmkeS3HXmkHR+GQrzy3FjJcyfScLUV+vtl71GtzkJgKCsjBg5ySaDqG3yE0TGD0BF88jkUvmH1Ab1gEw2E5TrxSUAQblDn4nDVG2imSpZYZu/N5R9Us4nr9BYYfu68Vy/R5HxA7BTH1RbI3ClNm8MTU51rlDei3NO23zSiMg4R22w6glAUD5zDmWrZJ2nbJvbcRLLT9M6ZWv8AOw8LfNGMRBLTnknLae2s+ec8gYEZc+Ik0whblqDqLCqln7CzbYFkfEDsPNzS8scUp8v0lPbJUFZnEca84qgBARljz7/1iai5oTV/aYSQWT8APQuJtuuiyxeX7nBTTmCEhCUuzJpJe3GSav903FxWxAZPwA7Q3rdZOvKZOMDa8d8E/drX6EsbAtKQFDuBmXXAOaTlGsAjR+AXnxI7YzJ7vtl11Dm84trKAFBufeCqHiXcmEiKgTRSva8KDJ+AJ6NlcJvfuj6uyjLTnkX7vJunP5uicj8Tm9RCQhKAAAACEoAAABAUAIAAEBQAgAAQFACAABAUAIAAACCEgAAAIISAAAAghIAAACCEgAAAHimoPzi/kKY+XSWmzSOl/EzfiRJ7uefv5UF5erqWhi+OBL+/s7lcPPWNDdpHK84bt9//0MY/tNIeOfy5fDxJ9PcpHG84rjF8bswPBwuX7oQZt5/iyRJ7qDx5238uRv7r9KgvDpxPQ2kX375hVs0jtuZs+fSQPrfr2vconHcXnn1tfR/8PDoNkmS7IHx5+61a1erDcrDg8fD8vKyQNyGcdwODQyGtZ+fCMRtGMft0MCR8PThLd/gJEn2yPhz9/CRY9UG5W9+OyAOn8E4fuJw+8bx881NkmRvTX/+CkpBKShJkmR/B+U3d8LJZDwsCMpd88nciZAM3Q5Pfv02zA0l4fqioCRZ5odh/oUkTN01FqSgFJSCct2gtEJJUlCSgnLfBeVCGE+SkKSOh/9cScLJmceN5x/PnKxvZ9F5p7Zd3/dkuPNN4XUejGeP1zx9Jzzez0G5WPizNCIvWzmcKDw3cb9w3P1wvTCOi/njP9wOL5U93vI+J2qvW7JCmR47XnsuabxnceUyjdDi8S3/PoKSPPBB+flIGEqeD0MvxHngdFhKt2v/zPe9ezokL4yEFeNGCsqer1DGMGwE4eNw53QWjuk+tUnrykIjNBv7pc/lgRmPae6374IyjbgTYe6HZkTWQy37Og/MNAZb98tjLw299Jh6ZL409236+OJE4fgsNOvHFF+7PSi7HZ+/fxazgpLsw6AsrFYKSlJQ7p1T3nHFMvs6Pl4ajfl+9e2WuOyI0v0VlB2nnmM4FkIvj7t6xGVBl60kLpbGaftqZXZM43XL36cZlHk0th7TjNb2iBWUZL+tUM5/LihJQbkHr6FcuJKE8QeF092l11m2BWWStLk712RWEpQlf5bFjptlCkGZrlaWBGXH481jNgrX4invxV87gzJdrRSUpKAsBqSgJAXlnropJ64wXrnTPN1dtkJZ2E6DcpdOce9IUJaGWZeg3NEVyvKgtEJJCsqNgnLlxvOCkhSUu3mXd3ajTvG0dXYNZb5iuf41lPUVzv16yrv9NHPzusUuQZldw9hyDWV6TJdrKFuO6XYNZXlQuoaSFJTlQZlfU1nfT1CSgnIX7vRuPe1dvNs7j87xK+uc0i7e5b2Lv4Ko8ru8G0HXLSi73M29qbu8a687V9tvK0HZcnp+PMxZoSQFZb4qmc4Lz4f5G055k4JyV21eH7nffldlf/5NOe03DAlKkiQF5W5GWdupbUG5R21ZRa3mdLegJElSUNLf5S0oSZIUlCEcHjwelpeXxeE2jON2aGAwrP38RBxuwzhuhwaOhKcPb/nmJkmyR8afu4ePHKs2KK9OXA83b00LxG0Yx+3M2XPh40+mBeI2jOP2yquvhZn33/INTpJkj4w/d69du1ptUK6uroXhiyPh9fMXw+ibl7hJh155Lbx48qXwz3/9O/3ny7UwevPSJW7SOF6N8fv9yXDmD6fCX4ZfJkmSO+jw2T+GC8PDaf9VHpTnLoyGkbfeDdc/miVJkuQBNfZe7L7Kg3J8YjJ9g0c/BZIkSR5wY/fF/qs0KAcGj4eH3z01wCRJkn1g7L7Yf5X/2iCDS5Ik2T/uyO+hNLAkSZKCUlCSZObsu9nf6HRiPiz08D2PTq8Yf5KCkiT3vyth6sRQmHrU+4gVlCQFJUnu6UisBVstFOPK49hnzcfyv19+/ccKK5aFx9bb99Gj+XA0mQqz+Xt/NtVc6Uy/ngpjjePq4bowPdR4HVFJUlCS5B4OyuTdpdbT2vl2DL0kX5Ws75sHYhp7+X6FWEyPL4ZifvxGQdker9lrW6EkKSgNLMn9sELZCLalMFay2lgMvc6vO1+v/fj09TcMyuZzxVgVlCQFpYEluQ+CshmA9aBM2qwHXXHf9vAM6wRpIQg3POXdvNFHUJIUlIKS5L4OyvVuvKl2hTKNRkFJUlAKSpIHLSjbrqFMI7A8Ijv3q4do92so266TFJQkBaWgJHnwgrL9Lu1mzJWvPm76Lu+findt1yJzenOnvPNjRCVJQUmSJElBKShJkiQpKEmSJLl/gnJg8Hh4+N1Tg0uSJNkHxu6L/VdpUI5PTIbrH80aYJIkyT4wdl/sv0qDcnV1LZy7MBrOvDES3hj9G0mSJA+osfdi98X+qz4oL54PI389GyZvjpIkSfKAGnsvdl/lQTk+cTV9g//+/CFJkiQPuLH7Yv9VfFPOsfDljx8YYJIkyT4wdl/sv8p/bZDBJUmS7B935PdQGliSJElBKShJcqt+/Xo4mvwu3DUWJAWloCRJQUmSgpIkdzQab9x+LiRJUvO5cOPr+NzbYSzdjtaiMt3vuXD0VLZt7EgKSkFJks2grEXie2+n2w9iWJ56PTxoX6HM9hv7wpiRFJSCkiQ7gjJflcxXJrPtjqAs7keSglJQkmTpdZLdgtKpbpKCUlCS5EYrlMVtQUlSUApKktzsNZRHb09s4hpKQUlSUApKklznlPfYe4U7ultOfxfv8haUJAWloCTJDa+hJEkKSpIUlCQpKEmSJHmAgnJg8Fj48scPDC5JkmQfGLsv9l+lQTk+cTVM3hw1wCRJkn1g7L7Yf5UG5erqWjh38Xz48z/eSN+AJEmSB9PYe7H7Yv9VGpQ5X9xfCDOfzpIkSfKAGntvK2w5KAEAAABBCQAAAEEJAAAAQQkAAABBCQAAAEEJAAAACEoAAAAISgAAAAhKAAAACEoAAABAUAIAAKB3/B/n3QAobLhLvgAAAABJRU5ErkJggg==" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h4 id="_1-2-1-type-属性" tabindex="-1"><a class="header-anchor" href="#_1-2-1-type-属性" aria-hidden="true">#</a> 1.2.1. type 属性</h4><p>可以使用 type 命令获取，记录了对象 <code>所保存的值的类型</code>。</p><blockquote><p>type [key]</p></blockquote><p>其枚举值如下：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* A redis object, that is a type able to hold a string / list / set */</span>

<span class="token comment">/* The actual Redis Object */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_STRING</span> <span class="token expression"><span class="token number">0</span>    </span><span class="token comment">/* String object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_LIST</span> <span class="token expression"><span class="token number">1</span>      </span><span class="token comment">/* List object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_SET</span> <span class="token expression"><span class="token number">2</span>       </span><span class="token comment">/* Set object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ZSET</span> <span class="token expression"><span class="token number">3</span>      </span><span class="token comment">/* Sorted set object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_HASH</span> <span class="token expression"><span class="token number">4</span>      </span><span class="token comment">/* Hash object. */</span></span>

<span class="token comment">/* The &quot;module&quot; object type is a special one that signals that the object
 * is one directly managed by a Redis module. In this case the value points
 * to a moduleValue struct, which contains the object value (which is only
 * handled by the module itself) and the RedisModuleType struct which lists
 * function pointers in order to serialize, deserialize, AOF-rewrite and
 * free the object.
 *
 * Inside the RDB file, module types are encoded as OBJ_MODULE followed
 * by a 64 bit module type ID, which has a 54 bits module-specific signature
 * in order to dispatch the loading to the right module, plus a 10 bits
 * encoding version. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_MODULE</span> <span class="token expression"><span class="token number">5</span>    </span><span class="token comment">/* Module object. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_STREAM</span> <span class="token expression"><span class="token number">6</span>    </span><span class="token comment">/* Stream object. */</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-2-encoding-属性" tabindex="-1"><a class="header-anchor" href="#_1-2-2-encoding-属性" aria-hidden="true">#</a> 1.2.2. encoding 属性</h4><p>可以使用 object encoding 命令获取，记录了对象 <code>所保存的值的编码</code>。</p><blockquote><p>object encoding [key]</p></blockquote><p>其枚举值如下：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* Objects encoding. Some kind of objects like Strings and Hashes can be
 * internally represented in multiple ways. The &#39;encoding&#39; field of the object
 * is set to one of this fields for this object. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_RAW</span> <span class="token expression"><span class="token number">0</span>     </span><span class="token comment">/* Raw representation */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_INT</span> <span class="token expression"><span class="token number">1</span>     </span><span class="token comment">/* Encoded as integer */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_HT</span> <span class="token expression"><span class="token number">2</span>      </span><span class="token comment">/* Encoded as hash table */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_ZIPMAP</span> <span class="token expression"><span class="token number">3</span>  </span><span class="token comment">/* Encoded as zipmap */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_LINKEDLIST</span> <span class="token expression"><span class="token number">4</span> </span><span class="token comment">/* No longer used: old list encoding. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_ZIPLIST</span> <span class="token expression"><span class="token number">5</span> </span><span class="token comment">/* Encoded as ziplist */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_INTSET</span> <span class="token expression"><span class="token number">6</span>  </span><span class="token comment">/* Encoded as intset */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_SKIPLIST</span> <span class="token expression"><span class="token number">7</span>  </span><span class="token comment">/* Encoded as skiplist */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_EMBSTR</span> <span class="token expression"><span class="token number">8</span>  </span><span class="token comment">/* Embedded sds string encoding */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_QUICKLIST</span> <span class="token expression"><span class="token number">9</span> </span><span class="token comment">/* Encoded as linked list of ziplists */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_STREAM</span> <span class="token expression"><span class="token number">10</span> </span><span class="token comment">/* Encoded as a radix tree of listpacks */</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 object encoding 命令输出的结果有： raw、int、embstr、hashtable、quicklist、ziplist、intset、skiplist 等， OBJ_ENCODING_XXX 为代码中使用，它与输出结果的转化代码如下：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strEncoding</span><span class="token punctuation">(</span><span class="token keyword">int</span> encoding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> OBJ_ENCODING_RAW<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;raw&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_INT<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;int&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_HT<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;hashtable&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_QUICKLIST<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;quicklist&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_ZIPLIST<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;ziplist&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_INTSET<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;intset&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_SKIPLIST<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;skiplist&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> OBJ_ENCODING_EMBSTR<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;embstr&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis objects can be encoded in different ways:</p><ul><li>Strings can be encoded as: <ul><li><strong>raw</strong>, normal string encoding.</li><li><strong>int</strong>, strings representing integers in a 64-bit signed interval, encoded in this way to save space.</li><li><strong>embstr</strong>, an embedded string, which is an object where the internal simple dynamic string, <strong>sds</strong>, is an unmodifiable string allocated in the same chuck as the object itself. <strong>embstr</strong> can be strings with lengths up to the hardcoded limit of <strong>OBJ_ENCODING_EMBSTR_SIZE_LIMIT</strong> or 44 bytes.</li></ul></li><li>Lists can be encoded as: <ul><li><strong>linkedlist</strong>, simple list encoding. No longer used, an old list encoding.</li><li><strong>ziplist</strong>, Redis &lt;= 6.2, a space-efficient encoding used for small lists.</li><li><strong>listpack</strong>, Redis &gt;= 7.0, a space-efficient encoding used for small lists.</li><li><strong>quicklist</strong>, encoded as linkedlist of ziplists or listpacks.</li></ul></li><li>Sets can be encoded as: <ul><li><strong>hashtable</strong>, normal set encoding.</li><li><strong>intset</strong>, a special encoding used for small sets composed solely of integers.</li><li><strong>listpack</strong>, Redis &gt;= 7.2, a space-efficient encoding used for small sets.</li></ul></li><li>Hashes can be encoded as: <ul><li><strong>zipmap</strong>, no longer used, an old hash encoding.</li><li><strong>hashtable</strong>, normal hash encoding.</li><li><strong>ziplist</strong>, Redis &lt;= 6.2, a space-efficient encoding used for small hashes.</li><li><strong>listpack</strong>, Redis &gt;= 7.0, a space-efficient encoding used for small hashes.</li></ul></li><li>Sorted Sets can be encoded as: <ul><li><strong>skiplist</strong>, normal sorted set encoding.</li><li><strong>ziplist</strong>, Redis &lt;= 6.2, a space-efficient encoding used for small sorted sets.</li><li><strong>listpack</strong>, Redis &gt;= 7.0, a space-efficient encoding used for small sorted sets.</li></ul></li><li>Streams can be encoded as: <ul><li><strong>stream</strong>, encoded as a radix tree of listpacks.</li></ul></li></ul><p>All the specially encoded types are automatically converted to the general type once you perform an operation that makes it impossible for Redis to retain the space saving encoding.</p><p>Returns the string representation of the type of the value stored at <strong>key</strong>. The different types that can be returned are: <strong>string</strong>, <strong>list</strong>, <strong>set</strong>, <strong>zset</strong>, <strong>hash</strong> and <strong>stream</strong>.</p><h4 id="_1-2-3-lru-属性" tabindex="-1"><a class="header-anchor" href="#_1-2-3-lru-属性" aria-hidden="true">#</a> 1.2.3. lru 属性</h4><p><strong>lru属性</strong>: 记录了对象最后一次被命令程序访问的时间 <strong>空转时长</strong>：当前时间减去键的值对象的lru时间，就是该键的空转时长。Object idletime命令可以打印出给定键的空转时长 如果服务器打开了maxmemory选项，并且服务器用于回收内存的算法为volatile-lru或者allkeys-lru，那么当服务器占用的内存数超过了maxmemory选项所设置的上限值时，空转时长较高的那部分键会优先被服务器释放，从而回收内存</p><h4 id="_1-2-4-refcount-属性" tabindex="-1"><a class="header-anchor" href="#_1-2-4-refcount-属性" aria-hidden="true">#</a> 1.2.4. refcount 属性</h4><p><strong>refcount 属性</strong>：关系着对象引用计数以及对象的消毁 redisObject中有refcount属性，是对象的引用计数，显然计数0那么就是可以回收。</p><ul><li>每个redisObject结构都带有一个refcount属性，指示这个对象被引用了多少次；</li><li>当新创建一个对象时，它的refcount属性被设置为1；</li><li>当对一个对象进行共享时，redis将这个对象的refcount加一；</li><li>当使用完一个对象后，或者消除对一个对象的引用之后，程序将对象的refcount减一；</li><li>当对象的refcount降至0 时，这个RedisObject结构，以及它引用的数据结构的内存都会被释放。</li></ul><h4 id="_1-2-5-ptr-属性" tabindex="-1"><a class="header-anchor" href="#_1-2-5-ptr-属性" aria-hidden="true">#</a> 1.2.5. ptr 属性</h4><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> TODO</label></li></ul><h3 id="_1-3-一个对象在内存中的存储示意" tabindex="-1"><a class="header-anchor" href="#_1-3-一个对象在内存中的存储示意" aria-hidden="true">#</a> 1.3. 一个对象在内存中的存储示意</h3><figure><img src="/cs-tips/assets/1716343090690-0a6a4bcc.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; set str1 abcdefghijklmnopqrstuvwxyz1234
[@sjs_73_171 WEB-INF]$ redis-memory-for-key -s b.redis -p 1959 str1
Key                             str1
Bytes                           80
Type                            string

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出 str1 在内存中所占的大小为： 80 字节。</p><blockquote><p>参考： <a href="https://www.cnblogs.com/wangcp-2014/p/15702410.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/wangcp-2014/p/15702410.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h3 id="_1-4-内建对象" tabindex="-1"><a class="header-anchor" href="#_1-4-内建对象" aria-hidden="true">#</a> 1.4. 内建对象</h3><p>redis一般会把一些常见的值放到一个共享对象中，这样可使程序避免了重复分配的麻烦，也节约了一些CPU时间。</p><p>redis预分配的值对象如下：</p><ul><li>各种命令的返回值，比如成功时返回的OK，错误时返回的ERROR，命令入队事务时返回的QUEUE，等等</li><li>包括0 在内，小于REDIS_SHARED_INTEGERS的所有整数（REDIS_SHARED_INTEGERS的默认值是10000）</li></ul><p>为什么redis不共享列表对象、哈希对象、集合对象、有序集合对象，只共享字符串对象？</p><ul><li>列表对象、哈希对象、集合对象、有序集合对象，本身可以包含字符串对象，复杂度较高。</li><li>如果共享对象是保存字符串对象，那么验证操作的复杂度为O(1)</li><li>如果共享对象是保存字符串值的字符串对象，那么验证操作的复杂度为O(N)</li><li>如果共享对象是包含多个值的对象，其中值本身又是字符串对象，即其它对象中嵌套了字符串对象，比如列表对象、哈希对象，那么验证操作的复杂度将会是O(N的平方)</li></ul><p>如果对复杂度较高的对象创建共享对象，需要消耗很大的CPU，用这种消耗去换取内存空间，是不合适的</p><h3 id="命令的类型检查和多态" tabindex="-1"><a class="header-anchor" href="#命令的类型检查和多态" aria-hidden="true">#</a> 命令的类型检查和多态</h3><p><strong>当执行一个处理数据类型命令的时候，redis执行以下步骤</strong></p><ul><li>根据给定的key，在数据库字典中查找和他相对应的redisObject，如果没找到，就返回NULL；</li><li>检查redisObject的type属性和执行命令所需的类型是否相符，如果不相符，返回类型错误；</li><li>根据redisObject的encoding属性所指定的编码，选择合适的操作函数来处理底层的数据结构；</li><li>返回数据结构的操作结果作为命令的返回值。</li></ul><figure><img src="/cs-tips/assets/1726156365855-8c0a38a7.png" alt="1726156365855" tabindex="0" loading="lazy"><figcaption>1726156365855</figcaption></figure><h3 id="_1-5-总结" tabindex="-1"><a class="header-anchor" href="#_1-5-总结" aria-hidden="true">#</a> 1.5. 总结</h3><ul><li>redis使用自己实现的对象机制（redisObject)来实现类型判断、命令多态和基于引用次数的垃圾回收；</li><li>redis会预分配一些常用的数据对象，并通过共享这些对象来减少内存占用，和避免频繁的为小对象分配内存</li></ul><h2 id="_2-数据类型" tabindex="-1"><a class="header-anchor" href="#_2-数据类型" aria-hidden="true">#</a> 2. 数据类型</h2><p>这里说的数据类型是指实际开发过程中，保存到 redis 的数据的类型，也就是 value 的类型，key 的类型是 string。</p><p>Redis使用对象来表示每一个键值对，在Redis中创建的每一个键值对，Redis都会为我们创建至少两个RedisObject对象，一个是键对象，即key，一个是值对象，即value。键对象的数据结构为字符串，而值对象因其保存的数据内容不一样，因而其使用的数据结构也不一样。<code></code>事实上，数据库中的每个键、值, 以及 Redis 本身处理的参数, 都表示为这种数据类型.</p><h3 id="_2-1-redis-中的数据结构" tabindex="-1"><a class="header-anchor" href="#_2-1-redis-中的数据结构" aria-hidden="true">#</a> 2.1. redis 中的数据结构</h3><p>也可以说是 redis 的编码。</p><h4 id="_2-1-1-sds" tabindex="-1"><a class="header-anchor" href="#_2-1-1-sds" aria-hidden="true">#</a> 2.1.1. SDS</h4><figure><img src="/cs-tips/assets/1716336438254-ad8cc121.png" alt="int" tabindex="0" loading="lazy"><figcaption>int</figcaption></figure><figure><img src="/cs-tips/assets/1716336490499-e9db092a.png" alt="embstr" tabindex="0" loading="lazy"><figcaption>embstr</figcaption></figure><figure><img src="/cs-tips/assets/1716336513073-2ffe7bbb.png" alt="raw" tabindex="0" loading="lazy"><figcaption>raw</figcaption></figure><figure><img src="/cs-tips/assets/1726157109543-63ec6abc.png" alt="1726157109543" tabindex="0" loading="lazy"><figcaption>1726157109543</figcaption></figure><h4 id="_2-1-2-ziplist" tabindex="-1"><a class="header-anchor" href="#_2-1-2-ziplist" aria-hidden="true">#</a> 2.1.2. ziplist</h4><figure><img src="/cs-tips/assets/1718579791006-020a4729.png" alt="ziplist" tabindex="0" loading="lazy"><figcaption>ziplist</figcaption></figure><figure><img src="/cs-tips/assets/1718579798628-b7d6ca9b.png" alt="ziplist" tabindex="0" loading="lazy"><figcaption>ziplist</figcaption></figure><h4 id="_2-1-3-quicklist" tabindex="-1"><a class="header-anchor" href="#_2-1-3-quicklist" aria-hidden="true">#</a> 2.1.3. quicklist</h4><figure><img src="/cs-tips/assets/1718579993174-79f6ec88.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="/cs-tips/assets/1726157193589-35476b56.png" alt="1726157193589" tabindex="0" loading="lazy"><figcaption>1726157193589</figcaption></figure><h4 id="_2-1-4-hashtable" tabindex="-1"><a class="header-anchor" href="#_2-1-4-hashtable" aria-hidden="true">#</a> 2.1.4. hashtable</h4><figure><img src="/cs-tips/assets/1718580012849-2faa680f.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="/cs-tips/assets/1726157340991-c896b035.png" alt="1726157340991" tabindex="0" loading="lazy"><figcaption>1726157340991</figcaption></figure><h4 id="_2-1-5-skiplist" tabindex="-1"><a class="header-anchor" href="#_2-1-5-skiplist" aria-hidden="true">#</a> 2.1.5. skiplist</h4><figure><img src="/cs-tips/assets/1718580114392-3c778c13.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="其他" tabindex="-1"><a class="header-anchor" href="#其他" aria-hidden="true">#</a> 其他</h4><figure><img src="/cs-tips/assets/1726157437779-e4664766.png" alt="1726157437779" tabindex="0" loading="lazy"><figcaption>1726157437779</figcaption></figure><figure><img src="/cs-tips/assets/1726157424386-ef582a82.png" alt="1726157424386" tabindex="0" loading="lazy"><figcaption>1726157424386</figcaption></figure><h3 id="_2-2-基本数据类型" tabindex="-1"><a class="header-anchor" href="#_2-2-基本数据类型" aria-hidden="true">#</a> 2.2. 基本数据类型</h3><h4 id="_2-2-1-字符串-string" tabindex="-1"><a class="header-anchor" href="#_2-2-1-字符串-string" aria-hidden="true">#</a> 2.2.1. 字符串 string</h4><ol><li><p><strong>应用场景</strong></p><ul><li>任何需要存储字符串的场景都可以</li><li>特殊场景：会话信息的存储、token 的存储、</li></ul></li><li><p><strong>命令</strong></p><ul><li>单键操作：get、getrange、getset、set、setrange、setnx、append、strlen</li><li>多键操作：mset、msetnx、mget</li><li>数字操作：incr、decr、incrby、decrby、incrbyfloat、decrbyfloat</li></ul><table><thead><tr><th>命令</th><th>描述</th><th>时间复杂度</th></tr></thead><tbody><tr><td>set key value [ex seconds] [px milliseconds] [nx xx]</td><td>设置值</td><td>O(1)</td></tr><tr><td>get key</td><td>获取值</td><td>O(1)</td></tr><tr><td>del key [key ...]</td><td>删除key</td><td>O(N)(N是键的个数)</td></tr><tr><td>mset key [key value ...]</td><td>批量设置值</td><td>O(N)(N是键的个数)</td></tr><tr><td>mget key [key ...]</td><td>批量获取值</td><td>O(N)(N是键的个数)</td></tr><tr><td>incr key</td><td>将 key 中储存的数字值增一</td><td>O(1)</td></tr><tr><td>decr key</td><td>将 key 中储存的数字值减一</td><td>O(1)</td></tr><tr><td>incrby key increment</td><td>将 key 所储存的值加上给定的增量值（increment）</td><td>O(1)</td></tr><tr><td>decrby key increment key</td><td>所储存的值减去给定的减量值（decrement）</td><td>O(1)</td></tr><tr><td>incrbyfloat key increment</td><td>将 key 所储存的值加上给定的浮点增量值（increment）</td><td>O(1)</td></tr><tr><td>append key value</td><td>如果 key 已经存在并且是一个字符串， APPEND 命令将指定的 value 追加到该 key 原来值（value）的末尾</td><td>O(1)</td></tr><tr><td>strlen key</td><td>返回 key 所储存的字符串值的长度。</td><td>O(1)</td></tr><tr><td>setrange key offset value</td><td>用 value 参数覆写给定 key 所储存的字符串值，从偏移量 offset 开始</td><td>O(1)</td></tr><tr><td>getrange key start end</td><td>返回 key 中字符串值的子字符</td><td>O(N)(N是字符串的长度)</td></tr></tbody></table><details class="hint-container details"><summary>string实战</summary><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> set hello world
OK
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> get hello
<span class="token string">&quot;world&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> del hello
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> get hello
<span class="token operator">(</span>nil<span class="token operator">)</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> set counter <span class="token number">2</span>
OK
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> get counter
<span class="token string">&quot;2&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> incr counter
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">3</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> get counter
<span class="token string">&quot;3&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> incrby counter <span class="token number">100</span>
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">103</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> get counter
<span class="token string">&quot;103&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> decr counter
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">102</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> get counter
<span class="token string">&quot;102&quot;</span>


\xe7\xbb\x83\xe6\xb0\x94\xe5\x8a\x9f\xe4\xb8\xba\xe4\xba\x86\xe5\xba\xb7\xe5\xa4\x8d\xe4\xbd\x93\xe8\xb4\xa8\xef\xbc\x8c\xe7\x99\xbe\xe7\x97\x85\xe4\xb8\x8d\xe7\x94\x9f\xef\xbc\x8c\xe5\x8f\xaf\xe6\x98\xaf\xe5\x90\x84\xe4\xba\xba\xe7\xbb\x83\xe5\x8a\x9f\xe5\x8a\x9f\xe6\x95\x88\xe6\x9c\x89\xe5\x88\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xba\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe5\xbf\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xb1\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe6\x85\xa2\xe3\x80\x82\xe5\x9b\xa0\xe6\xad\xa4\xef\xbc\x8c\xe4\xb8\x8d\xe9\xa1\xbb\xe6\x80\xa5\xe4\xba\x8e\xe6\xb1\x82\xe6\x95\x88\xef\xbc\x8c\xe5\x8f\xaa\xe6\x9c\x89\xe6\x8a\x8a\xe7\xad\x91\xe5\x9f\xba\xe5\x8a\x9f\xe5\xa4\xab\xe7\xbb\x83\xe6\x88\x90\xef\xbc\x8c\xe6\x89\x8d\xe6\x9c\x89\xe6\x97\xa5\xe6\x96\xb0\xe6\x9c\x88\xe5\xbc\x82\xe7\x9a\x84\xe6\x95\x88\xe6\x9e\x9c\xe3\x80\x82\xef\xbc\x88\xe3\x80\x8a\xe6\x82\x9f\xe7\x9c\x9f\xe7\xaf\x87\xe3\x80\x8b\xef\xbc\x9a\xe3\x80\x8c\xe8\xa6\x81\xe5\xbe\x97\xe8\xb0\xb7\xe6\x9f\x9b\xe9\x95\xbf\xe4\xb8\x8d\xe6\xad\xbb\xef\xbc\x8c\xe9\xa1\xbb\xe5\x87\xad\xe7\x8e\x84\xe7\x89\x9d\xe7\xab\x8b\xe6\xa0\xb9\xe5\x9f\xba\xe3\x80\x82\xe3\x80\x8d\xef\xbc\x89\xe6\xaf\x8f\xe4\xba\x8e\xe9\x9d\x99\xe5\x9d\x90\xe4\xb9\x8b\xe5\x89\x8d\xef\xbc\x8c\xe5\x8a\xa1\xe8\xa6\x81\xe6\x89\xab\xe9\x99\xa4\xe4\xb8\x80\xe5\x88\x87\xe6\x9d\x82\xe5\xbf\xb5\xef\xbc\x8c\xe5\xae\xbd\xe8\xa1\xa3\xe6\x9d\xbe\xe5\xb8\xa6\xef\xbc\x8c\xe8\xba\xab\xe4\xbd\x93\xe4\xb8\x8d\xe5\x8f\x97\xe6\x9d\x9f\xe7\xbc\x9a\xef\xbc\x8c\xe7\xab\xaf\xe5\x9d\x90\xe5\x9c\xa8\xe6\xa4\x85\xe5\xad\x90\xe4\xb8\x8a\xef\xbc\x8c\xe4\xb8\xa4\xe8\x85\xbf\xe5\x9e\x82\xe5\x9c\xb0\xef\xbc\x8c\xe4\xb8\xa4\xe6\x89\x8b\xe6\x94\xbe\xe5\x9c\xa8\xe8\x86\x9d\xe7\x9b\x96\xe4\xb8\x8a\xe3\x80\x82\xe6\x8a\x8a\xe4\xb8\xa4\xe7\x9b\xae\xe5\xbc\xa0\xe5\xbc\x80\xef\xbc\x8c\xe5\x90\x91\xe5\x89\x8d\xe5\xb9\xb3\xe8\xa7\x86\xef\xbc\x8c\xe6\x8a\x8a\xe7\x9b\xae\xe5\x85\x89\xe5\x87\x9d\xe8\xa7\x86\xe4\xba\x8e\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb9\x8b\xe5\x89\x8d\xe7\x9a\x84\xe6\xad\xa3\xe4\xb8\xad\xe5\xa4\x84\xef\xbc\x8c\xe7\x9c\xbc\xe7\x8f\xa0\xe5\xb0\xbd\xe9\x87\x8f\xe4\xbf\x9d\xe6\x8c\x81\xe4\xb8\x8d\xe5\x8a\xa8\xef\xbc\x8c\xe6\x85\xa2\xe6\x85\xa2\xe5\x9c\xb0\xe6\x94\xb6\xe5\x9b\x9e\xe7\x9b\xae\xe5\x85\x89\xef\xbc\x8c\xe4\xb8\x8d\xe5\x81\x8f\xe4\xb8\x8d\xe4\xbe\x9d\xe5\x9c\xb0\xe9\x9a\x8f\xe5\xbf\x83\xe6\x84\x8f\xe6\x94\xbe\xe5\x9c\xa8\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb8\xad\xe9\x97\xb4\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe9\x87\x8c\xef\xbc\x8c\xe5\x8d\x8a\xe7\x9d\x81\xe5\x8d\x8a\xe9\x97\xad\xef\xbc\x8c\xe5\xa4\x96\xe9\x97\xad\xe5\x86\x85\xe7\x9d\x81\xe8\xa7\x82\xe7\x9c\x8b\xe9\xbc\xbb\xe7\xab\xaf\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe5\x86\x85\xe7\x9a\x84\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xef\xbc\x8c\xe7\x94\xa8\xe6\x84\x8f\xe4\xb8\x8d\xe7\x94\xa8\xe5\x8a\x9b\xe3\x80\x81\xe4\xbc\xbc\xe8\xa7\x82\xe9\x9d\x9e\xe8\xa7\x82\xef\xbc\x8c\xe8\xa7\x82\xe5\x88\xb0\xe8\xa2\x93\xe7\xaa\x8d\xe5\x86\x85\xe5\x8f\x91\xe8\x83\x80\xe3\x80\x81\xe5\x8f\x91\xe7\xb4\xa7\xe3\x80\x81\xe6\x84\x9f\xe5\x88\xb0\xe6\xb8\xa9\xe6\x9a\x96\xef\xbc\x8c\xe8\xbe\xbe\xe5\x88\xb0\xe8\xbf\x99\xe4\xb8\xaa\xe7\x9a\x84\xe6\xa0\x87\xe5\x87\x86\xe6\x97\xb6\xef\xbc\x8c\xe5\x86\x8d\xe7\x94\xa8\xe6\x84\x8f\xe5\xbf\xb5\xe8\xbd\xbb\xe8\xbd\xbb\xe5\x9c\xb0\xe5\xbc\x95\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xe5\x90\x91\xe8\x84\x90\xe4\xb8\x8b\xe4\xb8\xb9\xe7\x94\xb0\xe7\x85\xa7\xe8\xa7\x86\xef\xbc\x8c\xe5\x86\x85\xe8\xa7\x86\xe8\x85\xb9\xe4\xb8\xad\xe4\xb8\x80\xe4\xb8\xaa\xe8\x99\x9a\xe7\xa9\xba\xe5\xa2\x83\xe5\x9c\xb0\xef\xbc\x8c\xe8\xa6\x81\xe6\x9c\x97\xe5\xbd\xbb\xe5\x85\xb6\xe5\x85\x89\xef\xbc\x8c\xe5\xa6\x82\xe5\x90\x8c\xe5\xa4\xa9\xe7\xa9\xba\xe6\x97\xa0\xe4\xba\x91\xe9\x81\xae\xe8\x94\xbd\xe6\x97\xb6\xe5\xa4\xaa\xe9\x98\xb3\xe7\x85\xa7\xe5\xb0\x84\xe5\xa4\xa7\xe5\x9c\xb0\xe4\xb8\x80\xe6\xa0\xb7\xe3\x80\x82\xe9\x9d\x99\xe8\x87\xb3\xe4\xba\x8e\xe6\x9e\x81\xef\xbc\x8c\xe5\x88\xb0\xe6\x97\xa0\xe6\x88\x91\xe6\x97\xa0\xe7\x9b\xb8\xe6\x97\xb6\xef\xbc\x8c\xe5\xb0\xb1\xe4\xba
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></li><li><p><strong>存储结构</strong></p></li></ol><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code>  <span class="token operator">/</span><span class="token operator">/</span> int
  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> set k1 <span class="token number">1</span>
  OK
  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding k1
  <span class="token string">&quot;int&quot;</span>
  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type k1
  string

  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> set k2 abcdefghijklmnopqrstuvwxyz123456789012345678
  OK
  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> strlen k2
  <span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">44</span>
  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding k2
  <span class="token string">&quot;embstr&quot;</span>
  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type k2
  string

  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> set k3 abcdefghijklmnopqrstuvwxyz1234567890123456789
  OK
  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> strlen k3
  <span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">45</span>
  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding k3
  <span class="token string">&quot;raw&quot;</span>
  <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type k3
  string

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>底层数据结构为SDS，但是根据保存的数据的类型以及数据长度，分为三种：</p><ul><li><strong>int 编码</strong>：保存的是可以用 long 类型表示的整数值。</li><li><strong>embstr 编码</strong>：保存长度小于等于44字节的字符串（redis3.2版本之前是39字节，之后是44字节）。</li><li><strong>raw 编码</strong>：保存长度大于44字节的字符串（redis3.2版本之前是39字节，之后是44字节）。</li><li>int： 存储的是整数且长度小于20字节，保存的是可以用 long 类型表示的整数值。</li><li>embstr： 存储的是字符串且长度小于等于44字节【redis3.2版本之前是39字节，之后是44字节】</li><li>raw： 存储的是动态字符串，且长度大于44字节且小于512Mb <ul><li>redis 2.+ 是 32 字节</li><li>redis 3.0-4.0 是 39 字节</li><li>redis 5.0 是 44 字节</li></ul></li></ul><p>其实 embstr 编码是专门用来保存短字符串的一种优化编码，raw 和 embstr 的区别： embstr与raw都使用redisObject和sds保存数据，区别在于，embstr的使用只分配一次内存空间（因此redisObject和sds是连续的），而raw需要分配两次内存空间（分别为redisObject和sds分配空间）。因此与raw相比，embstr的好处在于创建时少分配一次空间，删除时少释放一次空间，以及对象的所有数据连在一起，寻找方便。而embstr的坏处也很明显，如果字符串的长度增加需要重新分配内存时，整个redisObject和sds都需要重新分配空间，因此redis中的embstr实现为只读。</p><blockquote><p>ps： <strong>Redis中对于浮点数类型也是作为字符串保存的，在需要的时候再将其转换成浮点数类型</strong>。</p></blockquote><h4 id="_2-2-2-列表-list" tabindex="-1"><a class="header-anchor" href="#_2-2-2-列表-list" aria-hidden="true">#</a> 2.2.2. 列表 list</h4><p>List的数据结构，适合保存 <code>可以重复的、有序的数据集合</code>。</p><ol><li><p><strong>应用场景</strong></p><ul><li>lpush+lpop=Stack（栈）</li><li>lpush+rpop=Queue（队列）</li><li>lpush+ltrim=Capped Collection（有限集合）</li><li>lpush+brpop=Message Queue（消息队列）</li></ul></li><li><p><strong>命令</strong></p><ul><li>lpush</li><li>lrange</li><li>rpush</li><li>lpop</li><li>rpop</li><li>lindex</li><li>linsert</li><li>lset</li><li>ltrim</li><li>llen</li><li>lrem</li></ul><table><thead><tr><th>命令</th><th>描述</th><th>时间复杂度</th></tr></thead><tbody><tr><td>BLPOP key [key …] timeout</td><td>删除，并获得该列表中的第一元素，或阻塞，直到有一个可用</td><td>O(1)</td></tr><tr><td>BRPOP key [key …] timeout</td><td>删除，并获得该列表中的最后一个元素，或阻塞，直到有一个可用</td><td>O(1)</td></tr><tr><td>BRPOPLPUSH source destination timeout</td><td>弹出一个列表的值，将它推到另一个列表，并返回它;或阻塞，直到有一个可用</td><td>O(1)</td></tr><tr><td>LINDEX key index</td><td>获取一个元素，通过其索引列表</td><td>O(N)</td></tr><tr><td>LINSERT key BEFORE AFTER pivot value</td><td>在列表中的另一个元素之前或之后插入一个元素</td><td>O(N)</td></tr><tr><td>LLEN key</td><td>获得队列(List)的长度</td><td>O(1)</td></tr><tr><td>LPOP key</td><td>从队列的左边出队一个元素</td><td>O(1)</td></tr><tr><td>LPUSH key value [value …]</td><td>从队列的左边入队一个或多个元素</td><td>O(1)</td></tr><tr><td>LPUSHX key value</td><td>当队列存在时，从队到左边入队一个元素</td><td>O(1)</td></tr><tr><td>LRANGE key start stop</td><td>从列表中获取指定返回的元素</td><td>O(S+N)</td></tr><tr><td>LREM key count value</td><td>从列表中删除元素</td><td>O(N)</td></tr><tr><td>LSET key index value</td><td>设置队列里面一个元素的值</td><td>O(N)</td></tr><tr><td>LTRIM key start stop</td><td>修剪到指定范围内的清单</td><td>O(N)</td></tr><tr><td>RPOP key</td><td>从队列的右边出队一个元</td><td>O(1)</td></tr><tr><td>RPOPLPUSH source destination</td><td>删除列表中的最后一个元素，将其追加到另一个列表</td><td>O(1)</td></tr><tr><td>RPUSH key value [value …]</td><td>从队列的右边入队一个元素</td><td>O(1)</td></tr><tr><td>RPUSHX key value</td><td>从队列的右边入队一个元素，仅队列存在时有效</td><td>O(1)</td></tr></tbody></table></li><li><p><strong>存储结构</strong></p><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> lpush mylist <span class="token number">1</span> <span class="token number">2</span> ll ls mem
 <span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">5</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> lrange mylist <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
 <span class="token number">1</span><span class="token operator">)</span> <span class="token string">&quot;mem&quot;</span>
 <span class="token number">2</span><span class="token operator">)</span> <span class="token string">&quot;ls&quot;</span>
 <span class="token number">3</span><span class="token operator">)</span> <span class="token string">&quot;ll&quot;</span>
 <span class="token number">4</span><span class="token operator">)</span> <span class="token string">&quot;2&quot;</span>
 <span class="token number">5</span><span class="token operator">)</span> <span class="token string">&quot;1&quot;</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> lindex mylist <span class="token operator">-</span><span class="token number">1</span>
 <span class="token string">&quot;1&quot;</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> lindex mylist <span class="token number">10</span>        <span class="token operator">#</span> index不在 mylist 的区间范围内
 <span class="token operator">(</span>nil<span class="token operator">)</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> lpush mylist <span class="token number">1</span> <span class="token number">2</span> ll ls mem
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">5</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding mylist
<span class="token string">&quot;quicklist&quot;</span>

<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> lpush mylist \xe7\xbb\x83\xe6\xb0\x94\xe5\x8a\x9f\xe4\xb8\xba\xe4\xba\x86\xe5\xba\xb7\xe5\xa4\x8d\xe4\xbd\x93\xe8\xb4\xa8\xef\xbc\x8c\xe7\x99\xbe\xe7\x97\x85\xe4\xb8\x8d\xe7\x94\x9f\xef\xbc\x8c\xe5\x8f\xaf\xe6\x98\xaf\xe5\x90\x84\xe4\xba\xba\xe7\xbb\x83\xe5\x8a\x9f\xe5\x8a\x9f\xe6\x95\x88\xe6\x9c\x89\xe5\x88\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xba\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe5\xbf\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xb1\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe6\x85\xa2\xe3\x80\x82\xe5\x9b\xa0\xe6\xad\xa4\xef\xbc\x8c\xe4\xb8\x8d\xe9\xa1\xbb\xe6\x80\xa5\xe4\xba\x8e\xe6\xb1\x82\xe6\x95\x88\xef\xbc\x8c\xe5\x8f\xaa\xe6\x9c\x89\xe6\x8a\x8a\xe7\xad\x91\xe5\x9f\xba\xe5\x8a\x9f\xe5\xa4\xab\xe7\xbb\x83\xe6\x88\x90\xef\xbc\x8c\xe6\x89\x8d\xe6\x9c\x89\xe6\x97\xa5\xe6\x96\xb0\xe6\x9c\x88\xe5\xbc\x82\xe7\x9a\x84\xe6\x95\x88\xe6\x9e\x9c\xe3\x80\x82\xef\xbc\x88\xe3\x80\x8a\xe6\x82\x9f\xe7\x9c\x9f\xe7\xaf\x87\xe3\x80\x8b\xef\xbc\x9a\xe3\x80\x8c\xe8\xa6\x81\xe5\xbe\x97\xe8\xb0\xb7\xe6\x9f\x9b\xe9\x95\xbf\xe4\xb8\x8d\xe6\xad\xbb\xef\xbc\x8c\xe9\xa1\xbb\xe5\x87\xad\xe7\x8e\x84\xe7\x89\x9d\xe7\xab\x8b\xe6\xa0\xb9\xe5\x9f\xba\xe3\x80\x82\xe3\x80\x8d\xef\xbc\x89\xe6\xaf\x8f\xe4\xba\x8e\xe9\x9d\x99\xe5\x9d\x90\xe4\xb9\x8b\xe5\x89\x8d\xef\xbc\x8c\xe5\x8a\xa1\xe8\xa6\x81\xe6\x89\xab\xe9\x99\xa4\xe4\xb8\x80\xe5\x88\x87\xe6\x9d\x82\xe5\xbf\xb5\xef\xbc\x8c\xe5\xae\xbd\xe8\xa1\xa3\xe6\x9d\xbe\xe5\xb8\xa6\xef\xbc\x8c\xe8\xba\xab\xe4\xbd\x93\xe4\xb8\x8d\xe5\x8f\x97\xe6\x9d\x9f\xe7\xbc\x9a\xef\xbc\x8c\xe7\xab\xaf\xe5\x9d\x90\xe5\x9c\xa8\xe6\xa4\x85\xe5\xad\x90\xe4\xb8\x8a\xef\xbc\x8c\xe4\xb8\xa4\xe8\x85\xbf\xe5\x9e\x82\xe5\x9c\xb0\xef\xbc\x8c\xe4\xb8\xa4\xe6\x89\x8b\xe6\x94\xbe\xe5\x9c\xa8\xe8\x86\x9d\xe7\x9b\x96\xe4\xb8\x8a\xe3\x80\x82\xe6\x8a\x8a\xe4\xb8\xa4\xe7\x9b\xae\xe5\xbc\xa0\xe5\xbc\x80\xef\xbc\x8c\xe5\x90\x91\xe5\x89\x8d\xe5\xb9\xb3\xe8\xa7\x86\xef\xbc\x8c\xe6\x8a\x8a\xe7\x9b\xae\xe5\x85\x89\xe5\x87\x9d\xe8\xa7\x86\xe4\xba\x8e\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb9\x8b\xe5\x89\x8d\xe7\x9a\x84\xe6\xad\xa3\xe4\xb8\xad\xe5\xa4\x84\xef\xbc\x8c\xe7\x9c\xbc\xe7\x8f\xa0\xe5\xb0\xbd\xe9\x87\x8f\xe4\xbf\x9d\xe6\x8c\x81\xe4\xb8\x8d\xe5\x8a\xa8\xef\xbc\x8c\xe6\x85\xa2\xe6\x85\xa2\xe5\x9c\xb0\xe6\x94\xb6\xe5\x9b\x9e\xe7\x9b\xae\xe5\x85\x89\xef\xbc\x8c\xe4\xb8\x8d\xe5\x81\x8f\xe4\xb8\x8d\xe4\xbe\x9d\xe5\x9c\xb0\xe9\x9a\x8f\xe5\xbf\x83\xe6\x84\x8f\xe6\x94\xbe\xe5\x9c\xa8\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb8\xad\xe9\x97\xb4\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe9\x87\x8c\xef\xbc\x8c\xe5\x8d\x8a\xe7\x9d\x81\xe5\x8d\x8a\xe9\x97\xad\xef\xbc\x8c\xe5\xa4\x96\xe9\x97\xad\xe5\x86\x85\xe7\x9d\x81\xe8\xa7\x82\xe7\x9c\x8b\xe9\xbc\xbb\xe7\xab\xaf\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe5\x86\x85\xe7\x9a\x84\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xef\xbc\x8c\xe7\x94\xa8\xe6\x84\x8f\xe4\xb8\x8d\xe7\x94\xa8\xe5\x8a\x9b\xe3\x80\x81\xe4\xbc\xbc\xe8\xa7\x82\xe9\x9d\x9e\xe8\xa7\x82\xef\xbc\x8c\xe8\xa7\x82\xe5\x88\xb0\xe8\xa2\x93\xe7\xaa\x8d\xe5\x86\x85\xe5\x8f\x91\xe8\x83\x80\xe3\x80\x81\xe5\x8f\x91\xe7\xb4\xa7\xe3\x80\x81\xe6\x84\x9f\xe5\x88\xb0\xe6\xb8\xa9\xe6\x9a\x96\xef\xbc\x8c\xe8\xbe\xbe\xe5\x88\xb0\xe8\xbf\x99\xe4\xb8\xaa\xe7\x9a\x84\xe6\xa0\x87\xe5\x87\x86\xe6\x97\xb6\xef\xbc\x8c\xe5\x86\x8d\xe7\x94\xa8\xe6\x84\x8f\xe5\xbf\xb5\xe8\xbd\xbb\xe8\xbd\xbb\xe5\x9c\xb0\xe5\xbc\x95\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xe5\x90\x91\xe8\x84\x90\xe4\xb8\x8b\xe4\xb8\xb9\xe7\x94\xb0\xe7\x85\xa7\xe8\xa7\x86\xef\xbc\x8c\xe5\x86\x85\xe8\xa7\x86\xe8\x85\xb9\xe4\xb8\xad\xe4\xb8\x80\xe4\xb8\xaa\xe8\x99\x9a\xe7\xa9\xba\xe5\xa2\x83\xe5\x9c\xb0\xef\xbc\x8c\xe8\xa6\x81\xe6\x9c\x97\xe5\xbd\xbb\xe5\x85\xb6\xe5\x85\x89\xef\xbc\x8c\xe5\xa6\x82\xe5\x90\x8c\xe5\xa4\xa9\xe7\xa9\xba\xe6\x97\xa0\xe4\xba\x91\xe9\x81\xae\xe8\x94\xbd\xe6\x97\xb6\xe5\xa4\xaa\xe9\x98\xb3\xe7\x85\xa7\xe5\xb0\x84\xe5\xa4\xa7\xe5\x9c\xb0\xe4\xb8\x80\xe6\xa0\xb7\xe3\x80\x82\xe9\x9d\x99\xe8\x87\xb3\xe4\xba\x8e\xe6\x9e\x81\xef\xbc\x8c\xe5\x88\xb0\xe6\x97\xa0\xe6\x88\x91\xe6\x97\xa0\xe7\x9b\xb8\xe6\x97\xb6\xef\xbc\x8c\xe5\xb0\xb1\xe4\xba
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">6</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding mylist
<span class="token string">&quot;quicklist&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type mylist
list

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><ul><li>Redis3.2版本以前： 内部编码方式有两种 <ul><li><strong>ziplist</strong>（压缩列表）：当列表的元素个数小于 <code>list-max-ziplist-entries</code> 配置（<code>默认512个</code>），同时列表中每个元素的值都小于 <code>list-max-ziplist-value</code> 配置时（<code>默认64字节</code>），Redis会选用ziplist来作为列表的内部实现来减少内存的使用。</li><li><strong>linkedlist</strong>（链表）：当列表类型无法满足ziplist的条件时，Redis会使用linkedlist作为列表的内部实现。</li></ul></li><li>Redis3.2版本开始， 使用 quicklist 代替了 ziplist 和 linkedlist</li><li>Redis 5.0 设计了新的数据结构 listpack，沿用了压缩列表紧凑型的内存布局，最终在最新的 Redis 版本，将 Hash 对象和 Zset 对象的底层数据结构实现之一的压缩列表，替换成由 listpack 实现</li><li>进一步的, 目前Redis定义的10个对象编码方式宏名中, 有两个被完全闲置了, 分别是: OBJ_ENCODING_ZIPMAP与OBJ_ENCODING_LINKEDLIST。 从Redis的演进历史上来看, 前者是后续可能会得到支持的编码值（代码还在）, 后者则应该是被彻底淘汰了)</li></ul><ol start="4"><li><strong>其它</strong></li></ol><h4 id="_2-2-3-集合-set" tabindex="-1"><a class="header-anchor" href="#_2-2-3-集合-set" aria-hidden="true">#</a> 2.2.3. 集合 set</h4><p>保存不可重复的、无序的元素集合。</p><ol><li><p><strong>应用场景</strong></p><ul><li>任何用来去重的场景和保证数据唯一性的场景</li><li>求交差并补集合</li><li>我关注的、关注我的</li><li><strong>标签</strong>（tag）,给用户添加标签，或者用户给消息添加标签，这样有同一标签或者类似标签的可以给推荐关注的事或者关注的人。</li><li><strong>点赞，或点踩，收藏等</strong>，可以放到set中实现</li></ul></li><li><p><strong>命令</strong></p><ul><li>sadd</li><li>smembers</li><li>scard</li><li>sismember</li><li>smove</li><li>srem</li><li>spop</li><li>srandmember</li><li>sinter</li><li>sinterstore</li><li>sunion</li><li>sunionstore</li><li>sdiff</li><li>sdiffstore</li></ul></li></ol><table><thead><tr><th>命令</th><th>描述</th><th>时间复杂度</th></tr></thead><tbody><tr><td>SADD key member [member …]</td><td>添加一个或者多个元素到集合(set)里</td><td>O(N)</td></tr><tr><td>SCARD key</td><td>获取集合里面的元素数量</td><td>O(1)</td></tr><tr><td>SDIFF key [key …]</td><td>获得队列不存在的元素</td><td>O(N)</td></tr><tr><td>SDIFFSTORE destination key [key …]</td><td>获得队列不存在的元素，并存储在一个关键的结果集</td><td>O(N)</td></tr><tr><td>SINTER key [key …]</td><td>获得两个集合的交集</td><td>O(N*M)</td></tr><tr><td>SINTERSTORE destination key [key …]</td><td>获得两个集合的交集，并存储在一个关键的结果集</td><td>O(N*M)</td></tr><tr><td>SISMEMBER key member</td><td>确定一个给定的值是一个集合的成员</td><td>O(1)</td></tr><tr><td>SMEMBERS key</td><td>获取集合里面的所有元素</td><td>O(N)</td></tr><tr><td>SMOVE source destination member</td><td>移动集合里面的一个元素到另一个集合</td><td>O(1)</td></tr><tr><td>SPOP key [count]</td><td>删除并获取一个集合里面的元素</td><td>O(1)</td></tr><tr><td>SRANDMEMBER key [count]</td><td>从集合里面随机获取一个元素</td><td></td></tr><tr><td>SREM key member [member …]</td><td>从集合里删除一个或多个元素</td><td>O(N)</td></tr><tr><td>SUNION key [key …]</td><td>添加多个set元素</td><td>O(N)</td></tr><tr><td>SUNIONSTORE destination key [key …]</td><td>合并set元素，并将结果存入新的set里面</td><td>O(N)</td></tr><tr><td>SSCAN key cursor [MATCH pattern] [COUNT count]</td><td>迭代set里面的元素</td><td>O(1)</td></tr></tbody></table><ol start="3"><li><p><strong>存储结构</strong></p><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> sadd myset hao hao1 xiaohao hao
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">3</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding myset
<span class="token string">&quot;hashtable&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> sadd myset2 <span class="token number">12</span> <span class="token number">123</span> <span class="token number">432</span> <span class="token number">1235</span>
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">4</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding myset2
<span class="token string">&quot;intset&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type myset
set
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type myset2
set


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>intset</code> ： 当【**集合中的元素都是整数】**且【**元素个数小于 <strong><code>**set-maxintset-entries**</code></strong> 配置（默认512个）】**时，Redis会选用intset来作为集合的内部实现，从而减少内存的使用。</li><li><code>hashtable</code> ： 集合类型无法满足intset的条件时，Redis会使用hashtable作为集合的内部实现。</li></ul></li><li><p><strong>其它</strong></p></li></ol><h4 id="_2-2-4-有序集合-zset" tabindex="-1"><a class="header-anchor" href="#_2-2-4-有序集合-zset" aria-hidden="true">#</a> 2.2.4. 有序集合 zset</h4><p>保存 <code>不可重复、具有顺序</code>的元素集合，保存的元素不能重复，但是分数可以重复。</p><ol><li><p><strong>应用场景</strong></p><ul><li>微博中的热搜等场景</li><li>排行榜：有序集合经典使用场景。例如小说视频等网站需要对用户上传的小说视频做排行榜，榜单可以按照用户关注数，更新时间，字数等打分，做排行。</li></ul></li><li><p><strong>命令</strong></p><ul><li>zadd</li><li>zrange</li><li>zrem</li><li>zscore</li><li>zrangebyscore</li><li>zrank</li><li>zcard</li><li>zcount</li><li>zincrby</li><li>zrevrank</li><li>zremrangebyrank</li><li>zremrangebyscore</li><li>zinterstore</li><li>zunionstore</li></ul><table><thead><tr><th>命令</th><th>描述</th><th>时间复杂度</th></tr></thead><tbody><tr><td>BZPOPMAX key [key …] timeout</td><td>从一个或多个排序集中删除并返回得分最高的成员，或阻塞，直到其中一个可用为止</td><td>O(log(N))</td></tr><tr><td>BZPOPMIN key [key …] timeout</td><td>从一个或多个排序集中删除并返回得分最低的成员，或阻塞，直到其中一个可用为止</td><td>O(log(N))</td></tr><tr><td>ZADD key [NXXX] [CH] [INCR] score member [score member …]</td><td>添加到有序set的一个或多个成员，或更新的分数，如果它已经存在</td><td>O(log(N))</td></tr><tr><td>ZCARD key</td><td>获取一个排序的集合中的成员数量</td><td>O(1)</td></tr><tr><td>ZCOUNT key min max</td><td>返回分数范围内的成员数量</td><td>O(log(N))</td></tr><tr><td>ZINCRBY key increment member</td><td>增量的一名成员在排序设置的评分</td><td>O(log(N))</td></tr><tr><td>ZINTERSTORE</td><td>相交多个排序集，导致排序的设置存储在一个新的关键</td><td>O(NK)+O(Mlog(M))</td></tr><tr><td>ZLEXCOUNT key min max</td><td>返回成员之间的成员数量</td><td>O(log(N))</td></tr><tr><td>ZPOPMAX key [count]</td><td>删除并返回排序集中得分最高的成员</td><td>O(log(N)*M)</td></tr><tr><td>ZPOPMIN key [count]</td><td>删除并返回排序集中得分最低的成员</td><td>O(log(N)*M)</td></tr><tr><td>ZRANGE key start stop [WITHSCORES]</td><td>根据指定的index返回，返回sorted set的成员列表</td><td>O(log(N)+M)</td></tr><tr><td>ZRANGEBYLEX key min max [LIMIT offset count]</td><td>返回指定成员区间内的成员，按字典正序排列, 分数必须相同。</td><td>O(log(N)+M)</td></tr><tr><td>ZREVRANGEBYLEX key max min [LIMIT offset count]</td><td>返回指定成员区间内的成员，按字典倒序排列, 分数必须相同</td><td>O(log(N)+M)</td></tr><tr><td>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</td><td>返回有序集合中指定分数区间内的成员，分数由低到高排序。</td><td>O(log(N)+M)</td></tr><tr><td>ZRANK key member</td><td>确定在排序集合成员的索引</td><td>O(log(N))</td></tr><tr><td>ZREM key member [member …]</td><td>从排序的集合中删除一个或多个成员</td><td>O(M*log(N))</td></tr><tr><td>ZREMRANGEBYLEX key min max</td><td>删除名称按字典由低到高排序成员之间所有成员。</td><td>O(log(N)+M)</td></tr><tr><td>ZREMRANGEBYRANK key start stop</td><td>在排序设置的所有成员在给定的索引中删除</td><td>O(log(N)+M)</td></tr><tr><td>ZREMRANGEBYSCORE key min max</td><td>删除一个排序的设置在给定的分数所有成员</td><td>O(log(N)+M)</td></tr><tr><td>ZREVRANGE key start stop [WITHSCORES]</td><td>在排序的设置返回的成员范围，通过索引，下令从分数高到低</td><td>O(log(N)+M)</td></tr><tr><td>ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]</td><td>返回有序集合中指定分数区间内的成员，分数由高到低排序。</td><td>O(log(N)+M)</td></tr><tr><td>ZREVRANK key member</td><td>确定指数在排序集的成员，下令从分数高到低</td><td>O(log(N))</td></tr><tr><td>ZSCORE key member</td><td>获取成员在排序设置相关的比分</td><td>O(1)</td></tr><tr><td>ZUNIONSTORE</td><td>添加多个排序集和导致排序的设置存储在一个新的关键</td><td>O(N)+O(M log(M))</td></tr><tr><td>ZSCAN key cursor [MATCH pattern] [COUNT count]</td><td>迭代sorted sets里面的元素</td><td>O(1)</td></tr></tbody></table></li><li><p><strong>存储结构</strong></p><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> zadd myscoreset <span class="token number">100</span> hao <span class="token number">90</span> xiaohao
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">2</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding myscoreset
<span class="token string">&quot;ziplist&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> zadd myscoreset <span class="token number">80</span> \xe7\xbb\x83\xe6\xb0\x94\xe5\x8a\x9f\xe4\xb8\xba\xe4\xba\x86\xe5\xba\xb7\xe5\xa4\x8d\xe4\xbd\x93\xe8\xb4\xa8\xef\xbc\x8c\xe7\x99\xbe\xe7\x97\x85\xe4\xb8\x8d\xe7\x94\x9f\xef\xbc\x8c\xe5\x8f\xaf\xe6\x98\xaf\xe5\x90\x84\xe4\xba\xba\xe7\xbb\x83\xe5\x8a\x9f\xe5\x8a\x9f\xe6\x95\x88\xe6\x9c\x89\xe5\x88\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xba\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe5\xbf\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xb1\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe6\x85\xa2\xe3\x80\x82\xe5\x9b\xa0\xe6\xad\xa4\xef\xbc\x8c\xe4\xb8\x8d\xe9\xa1\xbb\xe6\x80\xa5\xe4\xba\x8e\xe6\xb1\x82\xe6\x95\x88\xef\xbc\x8c\xe5\x8f\xaa\xe6\x9c\x89\xe6\x8a\x8a\xe7\xad\x91\xe5\x9f\xba\xe5\x8a\x9f\xe5\xa4\xab\xe7\xbb\x83\xe6\x88\x90\xef\xbc\x8c\xe6\x89\x8d\xe6\x9c\x89\xe6\x97\xa5\xe6\x96\xb0\xe6\x9c\x88\xe5\xbc\x82\xe7\x9a\x84\xe6\x95\x88\xe6\x9e\x9c\xe3\x80\x82\xef\xbc\x88\xe3\x80\x8a\xe6\x82\x9f\xe7\x9c\x9f\xe7\xaf\x87\xe3\x80\x8b\xef\xbc\x9a\xe3\x80\x8c\xe8\xa6\x81\xe5\xbe\x97\xe8\xb0\xb7\xe6\x9f\x9b\xe9\x95\xbf\xe4\xb8\x8d\xe6\xad\xbb\xef\xbc\x8c\xe9\xa1\xbb\xe5\x87\xad\xe7\x8e\x84\xe7\x89\x9d\xe7\xab\x8b\xe6\xa0\xb9\xe5\x9f\xba\xe3\x80\x82\xe3\x80\x8d\xef\xbc\x89\xe6\xaf\x8f\xe4\xba\x8e\xe9\x9d\x99\xe5\x9d\x90\xe4\xb9\x8b\xe5\x89\x8d\xef\xbc\x8c\xe5\x8a\xa1\xe8\xa6\x81\xe6\x89\xab\xe9\x99\xa4\xe4\xb8\x80\xe5\x88\x87\xe6\x9d\x82\xe5\xbf\xb5\xef\xbc\x8c\xe5\xae\xbd\xe8\xa1\xa3\xe6\x9d\xbe\xe5\xb8\xa6\xef\xbc\x8c\xe8\xba\xab\xe4\xbd\x93\xe4\xb8\x8d\xe5\x8f\x97\xe6\x9d\x9f\xe7\xbc\x9a\xef\xbc\x8c\xe7\xab\xaf\xe5\x9d\x90\xe5\x9c\xa8\xe6\xa4\x85\xe5\xad\x90\xe4\xb8\x8a\xef\xbc\x8c\xe4\xb8\xa4\xe8\x85\xbf\xe5\x9e\x82\xe5\x9c\xb0\xef\xbc\x8c\xe4\xb8\xa4\xe6\x89\x8b\xe6\x94\xbe\xe5\x9c\xa8\xe8\x86\x9d\xe7\x9b\x96\xe4\xb8\x8a\xe3\x80\x82\xe6\x8a\x8a\xe4\xb8\xa4\xe7\x9b\xae\xe5\xbc\xa0\xe5\xbc\x80\xef\xbc\x8c\xe5\x90\x91\xe5\x89\x8d\xe5\xb9\xb3\xe8\xa7\x86\xef\xbc\x8c\xe6\x8a\x8a\xe7\x9b\xae\xe5\x85\x89\xe5\x87\x9d\xe8\xa7\x86\xe4\xba\x8e\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb9\x8b\xe5\x89\x8d\xe7\x9a\x84\xe6\xad\xa3\xe4\xb8\xad\xe5\xa4\x84\xef\xbc\x8c\xe7\x9c\xbc\xe7\x8f\xa0\xe5\xb0\xbd\xe9\x87\x8f\xe4\xbf\x9d\xe6\x8c\x81\xe4\xb8\x8d\xe5\x8a\xa8\xef\xbc\x8c\xe6\x85\xa2\xe6\x85\xa2\xe5\x9c\xb0\xe6\x94\xb6\xe5\x9b\x9e\xe7\x9b\xae\xe5\x85\x89\xef\xbc\x8c\xe4\xb8\x8d\xe5\x81\x8f\xe4\xb8\x8d\xe4\xbe\x9d\xe5\x9c\xb0\xe9\x9a\x8f\xe5\xbf\x83\xe6\x84\x8f\xe6\x94\xbe\xe5\x9c\xa8\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb8\xad\xe9\x97\xb4\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe9\x87\x8c\xef\xbc\x8c\xe5\x8d\x8a\xe7\x9d\x81\xe5\x8d\x8a\xe9\x97\xad\xef\xbc\x8c\xe5\xa4\x96\xe9\x97\xad\xe5\x86\x85\xe7\x9d\x81\xe8\xa7\x82\xe7\x9c\x8b\xe9\xbc\xbb\xe7\xab\xaf\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe5\x86\x85\xe7\x9a\x84\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xef\xbc\x8c\xe7\x94\xa8\xe6\x84\x8f\xe4\xb8\x8d\xe7\x94\xa8\xe5\x8a\x9b\xe3\x80\x81\xe4\xbc\xbc\xe8\xa7\x82\xe9\x9d\x9e\xe8\xa7\x82\xef\xbc\x8c\xe8\xa7\x82\xe5\x88\xb0\xe8\xa2\x93\xe7\xaa\x8d\xe5\x86\x85\xe5\x8f\x91\xe8\x83\x80\xe3\x80\x81\xe5\x8f\x91\xe7\xb4\xa7\xe3\x80\x81\xe6\x84\x9f\xe5\x88\xb0\xe6\xb8\xa9\xe6\x9a\x96\xef\xbc\x8c\xe8\xbe\xbe\xe5\x88\xb0\xe8\xbf\x99\xe4\xb8\xaa\xe7\x9a\x84\xe6\xa0\x87\xe5\x87\x86\xe6\x97\xb6\xef\xbc\x8c\xe5\x86\x8d\xe7\x94\xa8\xe6\x84\x8f\xe5\xbf\xb5\xe8\xbd\xbb\xe8\xbd\xbb\xe5\x9c\xb0\xe5\xbc\x95\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xe5\x90\x91\xe8\x84\x90\xe4\xb8\x8b\xe4\xb8\xb9\xe7\x94\xb0\xe7\x85\xa7\xe8\xa7\x86\xef\xbc\x8c\xe5\x86\x85\xe8\xa7\x86\xe8\x85\xb9\xe4\xb8\xad\xe4\xb8\x80\xe4\xb8\xaa\xe8\x99\x9a\xe7\xa9\xba\xe5\xa2\x83\xe5\x9c\xb0\xef\xbc\x8c\xe8\xa6\x81\xe6\x9c\x97\xe5\xbd\xbb\xe5\x85\xb6\xe5\x85\x89\xef\xbc\x8c\xe5\xa6\x82\xe5\x90\x8c\xe5\xa4\xa9\xe7\xa9\xba\xe6\x97\xa0\xe4\xba\x91\xe9\x81\xae\xe8\x94\xbd\xe6\x97\xb6\xe5\xa4\xaa\xe9\x98\xb3\xe7\x85\xa7\xe5\xb0\x84\xe5\xa4\xa7\xe5\x9c\xb0\xe4\xb8\x80\xe6\xa0\xb7\xe3\x80\x82\xe9\x9d\x99\xe8\x87\xb3\xe4\xba\x8e\xe6\x9e\x81\xef\xbc\x8c\xe5\x88\xb0\xe6\x97\xa0\xe6\x88\x91\xe6\x97\xa0\xe7\x9b\xb8\xe6\x97\xb6\xef\xbc\x8c\xe5\xb0\xb1\xe4\xba
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding myscoreset
<span class="token string">&quot;skiplist&quot;</span>

<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type myscoreset
zset

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><ul><li><strong><code>ziplist</code></strong>： 当数据比较少时，有序集合使用的是 ziplist 存储的，有序集合使用 ziplist 格式存储必须满足以下两个条件： <ul><li>元素个数小于 <code>zset-max-ziplist-entries（默认 128个）</code></li><li>所有元素成员的长度要小于 <code>zset-max-ziplist-value（默认 64字节）</code></li></ul></li><li><strong><code>skiplist</code></strong>： 如果不能满足以上两个条件中的任意一个，有序集合将会使用 skiplist 结构进行存储。</li></ul><ol start="4"><li><strong>其它</strong></li></ol><h4 id="_2-2-5-散列-hash" tabindex="-1"><a class="header-anchor" href="#_2-2-5-散列-hash" aria-hidden="true">#</a> 2.2.5. 散列 hash</h4><ol><li><p><strong>应用场景</strong></p></li><li><p><strong>命令</strong></p><ul><li>hset</li><li>hsetnx</li><li>hmset</li><li>hget</li><li>hmget</li><li>hdel</li><li>hincrby</li><li>hkeys</li><li>hvals</li><li>hgetall</li><li>hincrbyfloat</li><li>hexists</li><li>hlen</li></ul><table><thead><tr><th>命令</th><th>描述</th><th>时间复杂度</th></tr></thead><tbody><tr><td>HDEL key field [field …]</td><td>删除一个或多个Hash的field</td><td>O(N) N是被删除的字段数量。</td></tr><tr><td>HEXISTS key field</td><td>判断field是否存在于hash中</td><td>O(1)</td></tr><tr><td>HGET key field</td><td>获取hash中field的值</td><td>O(1)</td></tr><tr><td>HGETALL key</td><td>从hash中读取全部的域和值</td><td>O(N) N是Hash的长度</td></tr><tr><td>HINCRBY key field increment</td><td>将hash中指定域的值增加给定的数字</td><td>O(1)</td></tr><tr><td>HINCRBYFLOAT key field increment</td><td>将hash中指定域的值增加给定的浮点数</td><td>O(1)</td></tr><tr><td>HKEYS key</td><td>获取hash的所有字段</td><td>O(N) N是Hash的长度</td></tr><tr><td>HLEN key</td><td>获取hash里所有字段的数量</td><td>O(1)</td></tr><tr><td>HMGET key field [field …]</td><td>获取hash里面指定字段的值</td><td>O(N) N是请求的字段数</td></tr><tr><td>HMSET key field value [field value …]</td><td>设置hash字段值</td><td>O(N) N是设置的字段数</td></tr><tr><td>HSET key field value</td><td>设置hash里面一个字段的值</td><td>O(1)</td></tr><tr><td>HSETNX key field value</td><td>设置hash的一个字段，只有当这个字段不存在时有效</td><td>O(1)</td></tr><tr><td>HSTRLEN key field</td><td>获取hash里面指定field的长度</td><td>O(1)</td></tr><tr><td>HVALS key</td><td>获得hash的所有值</td><td>O(N) N是Hash的长度</td></tr><tr><td>HSCAN key cursor [MATCH pattern] [COUNT count]</td><td>迭代hash里面的元素</td><td></td></tr></tbody></table></li><li><p><strong>存储结构</strong></p><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code> <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user name zhangshan
 <span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user email hao<span class="token operator">@</span>163<span class="token punctuation">.</span>com
 <span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hgetall user
 <span class="token number">1</span><span class="token operator">)</span> <span class="token string">&quot;name1&quot;</span>
 <span class="token number">2</span><span class="token operator">)</span> <span class="token string">&quot;hao&quot;</span>
 <span class="token number">3</span><span class="token operator">)</span> <span class="token string">&quot;email1&quot;</span>
 <span class="token number">4</span><span class="token operator">)</span> <span class="token string">&quot;hao@163.com&quot;</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hget user user
 <span class="token operator">(</span>nil<span class="token operator">)</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hget user name1
 <span class="token string">&quot;hao&quot;</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user name2 xiaohao
 <span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user email2 xiaohao<span class="token operator">@</span>163<span class="token punctuation">.</span>com
 <span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
 <span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hgetall user
 <span class="token number">1</span><span class="token operator">)</span> <span class="token string">&quot;name1&quot;</span>
 <span class="token number">2</span><span class="token operator">)</span> <span class="token string">&quot;hao&quot;</span>
 <span class="token number">3</span><span class="token operator">)</span> <span class="token string">&quot;email1&quot;</span>
 <span class="token number">4</span><span class="token operator">)</span> <span class="token string">&quot;hao@163.com&quot;</span>
 <span class="token number">5</span><span class="token operator">)</span> <span class="token string">&quot;name2&quot;</span>
 <span class="token number">6</span><span class="token operator">)</span> <span class="token string">&quot;xiaohao&quot;</span>
 <span class="token number">7</span><span class="token operator">)</span> <span class="token string">&quot;email2&quot;</span>
 <span class="token number">8</span><span class="token operator">)</span> <span class="token string">&quot;xiaohao@163.com&quot;</span>

<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user name zhangshan
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user email hao<span class="token operator">@</span>163<span class="token punctuation">.</span>com
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding user
<span class="token string">&quot;ziplist&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user say \xe7\xbb\x83\xe6\xb0\x94\xe5\x8a\x9f\xe4\xb8\xba\xe4\xba\x86\xe5\xba\xb7\xe5\xa4\x8d\xe4\xbd\x93\xe8\xb4\xa8\xef\xbc\x8c\xe7\x99\xbe\xe7\x97\x85\xe4\xb8\x8d\xe7\x94\x9f\xef\xbc\x8c\xe5\x8f\xaf\xe6\x98\xaf\xe5\x90\x84\xe4\xba\xba\xe7\xbb\x83\xe5\x8a\x9f\xe5\x8a\x9f\xe6\x95\x88\xe6\x9c\x89\xe5\x88\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xba\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe5\xbf\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xb1\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe6\x85\xa2\xe3\x80\x82\xe5\x9b\xa0\xe6\xad\xa4\xef\xbc\x8c\xe4\xb8\x8d\xe9\xa1\xbb\xe6\x80\xa5\xe4\xba\x8e\xe6\xb1\x82\xe6\x95\x88\xef\xbc\x8c\xe5\x8f\xaa\xe6\x9c\x89\xe6\x8a\x8a\xe7\xad\x91\xe5\x9f\xba\xe5\x8a\x9f\xe5\xa4\xab\xe7\xbb\x83\xe6\x88\x90\xef\xbc\x8c\xe6\x89\x8d\xe6\x9c\x89\xe6\x97\xa5\xe6\x96\xb0\xe6\x9c\x88\xe5\xbc\x82\xe7\x9a\x84\xe6\x95\x88\xe6\x9e\x9c\xe3\x80\x82\xef\xbc\x88\xe3\x80\x8a\xe6\x82\x9f\xe7\x9c\x9f\xe7\xaf\x87\xe3\x80\x8b\xef\xbc\x9a\xe3\x80\x8c\xe8\xa6\x81\xe5\xbe\x97\xe8\xb0\xb7\xe6\x9f\x9b\xe9\x95\xbf\xe4\xb8\x8d\xe6\xad\xbb\xef\xbc\x8c\xe9\xa1\xbb\xe5\x87\xad\xe7\x8e\x84\xe7\x89\x9d\xe7\xab\x8b\xe6\xa0\xb9\xe5\x9f\xba\xe3\x80\x82\xe3\x80\x8d\xef\xbc\x89\xe6\xaf\x8f\xe4\xba\x8e\xe9\x9d\x99\xe5\x9d\x90\xe4\xb9\x8b\xe5\x89\x8d\xef\xbc\x8c\xe5\x8a\xa1\xe8\xa6\x81\xe6\x89\xab\xe9\x99\xa4\xe4\xb8\x80\xe5\x88\x87\xe6\x9d\x82\xe5\xbf\xb5\xef\xbc\x8c\xe5\xae\xbd\xe8\xa1\xa3\xe6\x9d\xbe\xe5\xb8\xa6\xef\xbc\x8c\xe8\xba\xab\xe4\xbd\x93\xe4\xb8\x8d\xe5\x8f\x97\xe6\x9d\x9f\xe7\xbc\x9a\xef\xbc\x8c\xe7\xab\xaf\xe5\x9d\x90\xe5\x9c\xa8\xe6\xa4\x85\xe5\xad\x90\xe4\xb8\x8a\xef\xbc\x8c\xe4\xb8\xa4\xe8\x85\xbf\xe5\x9e\x82\xe5\x9c\xb0\xef\xbc\x8c\xe4\xb8\xa4\xe6\x89\x8b\xe6\x94\xbe\xe5\x9c\xa8\xe8\x86\x9d\xe7\x9b\x96\xe4\xb8\x8a\xe3\x80\x82\xe6\x8a\x8a\xe4\xb8\xa4\xe7\x9b\xae\xe5\xbc\xa0\xe5\xbc\x80\xef\xbc\x8c\xe5\x90\x91\xe5\x89\x8d\xe5\xb9\xb3\xe8\xa7\x86\xef\xbc\x8c\xe6\x8a\x8a\xe7\x9b\xae\xe5\x85\x89\xe5\x87\x9d\xe8\xa7\x86\xe4\xba\x8e\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb9\x8b\xe5\x89\x8d\xe7\x9a\x84\xe6\xad\xa3\xe4\xb8\xad\xe5\xa4\x84\xef\xbc\x8c\xe7\x9c\xbc\xe7\x8f\xa0\xe5\xb0\xbd\xe9\x87\x8f\xe4\xbf\x9d\xe6\x8c\x81\xe4\xb8\x8d\xe5\x8a\xa8\xef\xbc\x8c\xe6\x85\xa2\xe6\x85\xa2\xe5\x9c\xb0\xe6\x94\xb6\xe5\x9b\x9e\xe7\x9b\xae\xe5\x85\x89\xef\xbc\x8c\xe4\xb8\x8d\xe5\x81\x8f\xe4\xb8\x8d\xe4\xbe\x9d\xe5\x9c\xb0\xe9\x9a\x8f\xe5\xbf\x83\xe6\x84\x8f\xe6\x94\xbe\xe5\x9c\xa8\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb8\xad\xe9\x97\xb4\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe9\x87\x8c\xef\xbc\x8c\xe5\x8d\x8a\xe7\x9d\x81\xe5\x8d\x8a\xe9\x97\xad\xef\xbc\x8c\xe5\xa4\x96\xe9\x97\xad\xe5\x86\x85\xe7\x9d\x81\xe8\xa7\x82\xe7\x9c\x8b\xe9\xbc\xbb\xe7\xab\xaf\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe5\x86\x85\xe7\x9a\x84\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xef\xbc\x8c\xe7\x94\xa8\xe6\x84\x8f\xe4\xb8\x8d\xe7\x94\xa8\xe5\x8a\x9b\xe3\x80\x81\xe4\xbc\xbc\xe8\xa7\x82\xe9\x9d\x9e\xe8\xa7\x82\xef\xbc\x8c\xe8\xa7\x82\xe5\x88\xb0\xe8\xa2\x93\xe7\xaa\x8d\xe5\x86\x85\xe5\x8f\x91\xe8\x83\x80\xe3\x80\x81\xe5\x8f\x91\xe7\xb4\xa7\xe3\x80\x81\xe6\x84\x9f\xe5\x88\xb0\xe6\xb8\xa9\xe6\x9a\x96\xef\xbc\x8c\xe8\xbe\xbe\xe5\x88\xb0\xe8\xbf\x99\xe4\xb8\xaa\xe7\x9a\x84\xe6\xa0\x87\xe5\x87\x86\xe6\x97\xb6\xef\xbc\x8c\xe5\x86\x8d\xe7\x94\xa8\xe6\x84\x8f\xe5\xbf\xb5\xe8\xbd\xbb\xe8\xbd\xbb\xe5\x9c\xb0\xe5\xbc\x95\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xe5\x90\x91\xe8\x84\x90\xe4\xb8\x8b\xe4\xb8\xb9\xe7\x94\xb0\xe7\x85\xa7\xe8\xa7\x86\xef\xbc\x8c\xe5\x86\x85\xe8\xa7\x86\xe8\x85\xb9\xe4\xb8\xad\xe4\xb8\x80\xe4\xb8\xaa\xe8\x99\x9a\xe7\xa9\xba\xe5\xa2\x83\xe5\x9c\xb0\xef\xbc\x8c\xe8\xa6\x81\xe6\x9c\x97\xe5\xbd\xbb\xe5\x85\xb6\xe5\x85\x89\xef\xbc\x8c\xe5\xa6\x82\xe5\x90\x8c\xe5\xa4\xa9\xe7\xa9\xba\xe6\x97\xa0\xe4\xba\x91\xe9\x81\xae\xe8\x94\xbd\xe6\x97\xb6\xe5\xa4\xaa\xe9\x98\xb3\xe7\x85\xa7\xe5\xb0\x84\xe5\xa4\xa7\xe5\x9c\xb0\xe4\xb8\x80\xe6\xa0\xb7\xe3\x80\x82\xe9\x9d\x99\xe8\x87\xb3\xe4\xba\x8e\xe6\x9e\x81\xef\xbc\x8c\xe5\x88\xb0\xe6\x97\xa0\xe6\x88\x91\xe6\x97\xa0\xe7\x9b\xb8\xe6\x97\xb6\xef\xbc\x8c\xe5\xb0\xb1\xe4\xba\xa7\
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding user
<span class="token string">&quot;hashtable&quot;</span>

<span class="token operator">/</span><span class="token operator">/</span> 查看 user 的type
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type user
hash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>键值对数量小于512【hash-max-ziplist-entries配置（默认512个）】</code> &amp;&amp; <code>所有键值对的key和value的长度都小于64字节【所有值都小于hash-max-ziplist-value配置（默认64字节）】</code> 时使用<strong>ziplist</strong>；</li><li>否则就使用 <strong>hashtable</strong>【即 dict】</li></ul></li><li><p><strong>其它</strong></p></li></ol><div class="hint-container tip"><p class="hint-container-title">思考题</p><pre><code>1. redis中存储对象有几种方式？
  - 第一种：
    - set user:1:name zhangsan
    - set user:1:age 12
  - 第二种： value为序列化后的对象信息
    - set user:1 serialize(userInfo)
  - 第三种： 使用字典
    - hset user:1 name zhangsan age 12
2. 假如hashtable数组上的链表元素有很多，那么rehash过程中，这些链表元素是怎么rehash到ht[1]上的？
3. hashtable扩容时，为什么 BGSAVE 或 BGREWRITEAOF 命令执行时的负载因子要比没有执行这两个命令时的负载因子大？
</code></pre></div><h4 id="_2-2-6-流-stream" tabindex="-1"><a class="header-anchor" href="#_2-2-6-流-stream" aria-hidden="true">#</a> 2.2.6. 流 stream</h4><p>Redis5.0 中还增加了一个数据结构Stream，从字面上看是流类型，但其实从功能上看，应该是Redis对消息队列（MQ，Message Queue）的完善实现。<code></code>就是Redis实现的一种消息中间件的数据结构。先了解一下消息中间件的概念：</p><div class="hint-container tip"><p class="hint-container-title">消息中间件的准备知识</p><ol><li><p>为什么会有消息中间件？<code></code>解耦、削峰、异步、高性能；</p></li><li><p>有哪些概念？<code></code>消息、生产者、消费者、主题、channel等；<code></code>:::</p></li><li><p><strong>应用场景</strong></p></li><li><p><strong>命令</strong></p><ul><li>xadd</li><li>xread： 循环阻塞读取消息</li><li>xrange</li><li>xlen</li><li>xdel</li><li>del</li><li>xgroup <ul><li>xgroup delconsumer</li><li>xgroup destroy</li></ul></li><li>xreadgroup</li><li>xack</li><li>xpending</li><li>xinfo <ul><li>xinfo stream</li><li>xinfo groups</li><li>xinfo consumers</li></ul></li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 往消息队列中插入消息
&gt; XADD mymsgqueue * name zeanzai 
&quot;1654254953808-0&quot;


● XADD 中的 * 表示让 Redis 为插入的数据自动生成一个全局唯一的 ID
● XADD 中的 name 表示键， zeanzai 表示值
● XADD 的输出结果中，1654254953808为以毫秒为单位计算的当前服务器的时间；-0表示第1条消息信息；

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 单个消费者消费
// 消费消息队列中的消息， 消费 1654254953807-0 后续的所有消息
&gt; XREAD STREAMS mymsgqueue 1654254953807-0
1) 1) &quot;mymsgqueue&quot;
  1) 1) 1) &quot;1654254953808-0&quot;
        1) 1) &quot;name&quot;
            1) &quot;zeanzai&quot;

// 阻塞消费消息队列中的消息， $ 表示读取最新的消息
&gt; XREAD BLOCK 10000 STREAMS mymsgqueue $
(nil)
(10.00s)



● XREAD 中的 1654254953807-0 表示从这条信息的下条信息开始消费
● XREAD BLOCK 10000 中的 block 10000 表示在消费时，阻塞10s时间。


// 多个消费者形成一个消费组进行消费
// 为某一个消息流设置多个消费组，并标识消费消息的位置
// 创建一个名为 group1 的消费组，0-0 表示从第一条消息开始读取。
&gt; XGROUP CREATE mymsgqueue group1 0-0
OK

// 创建一个名为 group2 的消费组，0-0 表示从第一条消息开始读取。
&gt; XGROUP CREATE mymsgqueue group2 0-0
OK

// 让消费组里面的某一个消费者消费消息
// 注意： 一个消息只能由消费者组内的一个消费者消费；但是可以由多个消费组的多个消费者消费；
// 消费组 group1 内的消费者 consumer1 从 mymq 消息队列中读取所有消息的命令如下：
// 命令最后的参数“&gt;”，表示从第一条尚未被消费的消息开始读取。
&gt; XREADGROUP GROUP group1 consumer1 STREAMS mymsgqueue &gt;
1) 1) &quot;mymq&quot;
  2) 1) 1) &quot;1654254953808-0&quot;
        2) 1) &quot;name&quot;
            2) &quot;zeanzai&quot;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt; XACK mymsgqueue group2 1654254953808-0
(integer) 1

// 查看某一个消费组已经消费，但是还没有确认的消息列表
&gt; XPENDING mymsgqueue group2
1) (integer) 3
2) &quot;1654254953808-0&quot;  # 表示 group2 中所有消费者读取的消息最小 ID
3) &quot;1654256271337-0&quot;  # 表示 group2 中所有消费者读取的消息最大 ID
4) 1) 1) &quot;consumer1&quot;
      2) &quot;1&quot;
  2) 1) &quot;consumer2&quot;
      2) &quot;1&quot;
  3) 1) &quot;consumer3&quot;
      2) &quot;1&quot;


消息确认消费的原理： Redis会把每一个消费过的消息保存到PENDING list中，直到消费者使用XACK命令确认消息消费成功。  

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code> # <span class="token operator">*</span>号表示服务器自动生成ID，后面顺序跟着一堆key<span class="token operator">/</span>value
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xadd codehole <span class="token operator">*</span> name laoqian age <span class="token number">30</span>  #  名字叫laoqian，年龄<span class="token number">30</span>岁
 <span class="token number">1527849609889</span><span class="token operator">-</span><span class="token number">0</span>  # 生成的消息ID
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xadd codehole <span class="token operator">*</span> name xiaoyu age <span class="token number">29</span>
 <span class="token number">1527849629172</span><span class="token operator">-</span><span class="token number">0</span>
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xadd codehole <span class="token operator">*</span> name xiaoqian age <span class="token number">1</span>
 <span class="token number">1527849637634</span><span class="token operator">-</span><span class="token number">0</span>
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xlen <span class="token function">codehole</span>
 <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xrange codehole <span class="token operator">-</span> <span class="token operator">+</span>  # <span class="token operator">-</span>表示最小值<span class="token punctuation">,</span> <span class="token operator">+</span>表示最大值
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xrange codehole <span class="token operator">-</span> <span class="token operator">+</span>
 <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1527849609889</span><span class="token operator">-</span><span class="token number">0</span>
   <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
       <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;laoqian&quot;</span>
       <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
       <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;30&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1527849629172</span><span class="token operator">-</span><span class="token number">0</span>
   <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
       <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xiaoyu&quot;</span>
       <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
       <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;29&quot;</span>
 <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1527849637634</span><span class="token operator">-</span><span class="token number">0</span>
   <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
       <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xiaoqian&quot;</span>
       <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
       <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xrange codehole <span class="token number">1527849629172</span><span class="token operator">-</span><span class="token number">0</span> <span class="token operator">+</span>  # 指定最小消息ID的列表
 <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1527849629172</span><span class="token operator">-</span><span class="token number">0</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
       <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;xiaoyu&quot;</span>
       <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
       <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;29&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1527849637634</span><span class="token operator">-</span><span class="token number">0</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
       <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;xiaoqian&quot;</span>
       <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
       <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xrange codehole <span class="token operator">-</span> <span class="token number">1527849629172</span><span class="token operator">-</span><span class="token number">0</span>  # 指定最大消息ID的列表
 <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1527849609889</span><span class="token operator">-</span><span class="token number">0</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
       <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;laoqian&quot;</span>
       <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
       <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;30&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1527849629172</span><span class="token operator">-</span><span class="token number">0</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
       <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;xiaoyu&quot;</span>
       <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
       <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;29&quot;</span>
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xdel codehole <span class="token number">1527849609889</span><span class="token operator">-</span><span class="token number">0</span>
 <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xlen codehole  # 长度不受影响
 <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> xrange codehole <span class="token operator">-</span> <span class="token operator">+</span>  # 被删除的消息没了
 <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1527849629172</span><span class="token operator">-</span><span class="token number">0</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
       <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;xiaoyu&quot;</span>
       <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
       <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;29&quot;</span>
 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1527849637634</span><span class="token operator">-</span><span class="token number">0</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;name&quot;</span>
       <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;xiaoqian&quot;</span>
       <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;age&quot;</span>
       <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;1&quot;</span>
 <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> del codehole  # 删除整个<span class="token function">Stream</span>
 <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>存储结构</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>127.0.0.1:6379&gt; XADD mymsgqueue * name zeanzai
&quot;1716282237930-0&quot;
127.0.0.1:6379&gt; type mymsgqueue
stream


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>其它</strong></p></li></ol><p>Stream与主流MQ对比</p><p>可从消息的可靠性、持久性、有序性、解决重复消费、高可用、消息积压等方面去理解。</p><ul><li>有序性： 单个消费者时，消费顺序天然有序；多个消费组时，在消费组内有序，消费组间无序；</li><li>持久性： Redis对Stream具有有序性；</li><li>解决重复消费问题： Stream为每一个消息都设置了全局唯一id，保证消息的唯一性，重复消费问题可以通过ack机制及消费端应用自行处理；</li><li>高可用问题（消息丢失问题）： 生产者由生产者端应用自行处理；消息队列则由Redis保证，可能会出现消息丢失问题，因为AOF每秒写盘、主从切换时也可能会丢失部分数据；消费者可以通过确认机制达到高可用性；</li><li>消息积压问题： Stream可以设置固定长度，当消息队列超过最大长度后，redis会删除旧消息数据，这样是有可能造成消息丢失的；</li></ul><p>选择Redis作为消息中间件的应用场景：业务比较简单、对丢失数据不够敏感、且消息积压概率较小，可以使用Redis作为消息中间件。其他情况，还是建议使用专门的消息中间件产品。</p><p>使用Redis早期版本作为消息中间件</p><ul><li>发布订阅机制 <ul><li>publish <ul><li>返回0~n的整数，表示有多少个消费者接收到了消息</li></ul></li><li>subscribe <ul><li>可以订阅多个channel</li><li>命令会一直阻塞，等待接收消息</li></ul></li><li>psubscribe <ul><li>可以订阅主题，只能订阅一个主题</li><li>发布订阅模式，</li></ul></li><li>这种方式有两个问题 <ul><li>无法持久化消息，Redis重启后，消息会丢失；</li><li>发后即忘的，如果消费者没有收到消息，就会再也接受不到消息了；</li></ul></li></ul></li><li>List ： 就是使用lpush+rpop来完成 <ul><li>比发布订阅机制的： <ul><li>优点 <ul><li>可以持久化消息</li><li>可以积压消息</li></ul></li><li>缺点 <ul><li>不能重复消费</li><li>消费时还需要遍历所有的消息列表</li><li>没有主题订阅的功能</li><li>不支持多播、分组消费等</li></ul></li></ul></li></ul></li><li>ZSet <ul><li>比发布订阅机制的： <ul><li>优点 <ul><li>支持持久化</li><li>比list查询更方便，可以使用score属性来完成遍历</li></ul></li><li>缺点 <ul><li>不能存储相同消息，也就是消息不能重复</li><li>不能完成消息队列的有序性</li><li>没有弹出功能</li></ul></li></ul></li></ul></li></ul><p><a href="https://tech.meituan.com/2016/07/01/mq-design.html" target="_blank" rel="noopener noreferrer">消息队列设计精要<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_2-3-高级数据类型" tabindex="-1"><a class="header-anchor" href="#_2-3-高级数据类型" aria-hidden="true">#</a> 2.3. 高级数据类型</h3><h4 id="_2-3-1-geo" tabindex="-1"><a class="header-anchor" href="#_2-3-1-geo" aria-hidden="true">#</a> 2.3.1. geo</h4><ol><li><p><strong>应用场景</strong></p><p>可以 <code>保存地理位置信息</code>并 <code>对地理位置信息进行操作</code>，是<strong>3.2以后提供的新特性</strong>。可以完成类似于“搜索附近”的功能，如在地图上定位到某一个景点，GEO这种数据结构可以完成搜索附近美食的功能。</p></li><li><p><strong>命令</strong></p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> geoadd china<span class="token operator">:</span>city <span class="token number">118.76</span> <span class="token number">32.04</span> manjing <span class="token number">112.55</span> <span class="token number">37.86</span> taiyuan <span class="token number">123.43</span> <span class="token number">41.80</span> <span class="token function">shenyang</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> geoadd china<span class="token operator">:</span>city <span class="token number">144.05</span> <span class="token number">22.52</span> shengzhen <span class="token number">120.16</span> <span class="token number">30.24</span> hangzhou <span class="token number">108.96</span> <span class="token number">34.26</span> <span class="token function">xian</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>

两级无法直接添加，我们一般会下载城市数据<span class="token punctuation">(</span>这个网址可以查询 GEO： http<span class="token operator">:</span><span class="token comment">//www.jsons.cn/lngcode)！</span>
  有效的经度从<span class="token operator">-</span><span class="token number">180</span>度到<span class="token number">180</span>度。
  有效的纬度从<span class="token operator">-</span><span class="token number">85.05112878</span>度到<span class="token number">85.05112878</span>度。


# 当坐标位置超出上述指定范围时，该命令将会返回一个错误。
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> geoadd china<span class="token operator">:</span>city <span class="token number">39.90</span> <span class="token number">116.40</span> <span class="token function">beijin</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR invalid longitude<span class="token punctuation">,</span>latitude pair <span class="token number">39.900000</span><span class="token punctuation">,</span><span class="token number">116.400000</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>获取指定的成员的经度和纬度

<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> geopos china<span class="token operator">:</span>city taiyuan manjing
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;112.54999905824661255&quot;</span>
  <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;37.86000073876942196&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;118.75999957323074341&quot;</span>
  <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;32.03999960287850968&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>如果不存在<span class="token punctuation">,</span> 返回空
m
km
mi 英里
ft 英尺

<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> geodist china<span class="token operator">:</span>city taiyuan shenyang m
<span class="token string">&quot;1026439.1070&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> geodist china<span class="token operator">:</span>city taiyuan shenyang km
<span class="token string">&quot;1026.4391&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>以 <span class="token number">110</span><span class="token punctuation">,</span><span class="token number">30</span> 这个坐标为中心<span class="token punctuation">,</span> 寻找半径为<span class="token number">1000</span>km的城市
参数 key 经度 纬度 半径 单位 <span class="token punctuation">[</span>显示结果的经度和纬度<span class="token punctuation">]</span> <span class="token punctuation">[</span>显示结果的距离<span class="token punctuation">]</span> <span class="token punctuation">[</span>显示的结果的数量<span class="token punctuation">]</span>

<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> georadius china<span class="token operator">:</span>city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;hangzhou&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;manjing&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;taiyuan&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> georadius china<span class="token operator">:</span>city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> georadius china<span class="token operator">:</span>city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">500</span> km withdist
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
  <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;483.8340&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> georadius china<span class="token operator">:</span>city <span class="token number">110</span> <span class="token number">30</span> <span class="token number">1000</span> km withcoord withdist count <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
  <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;483.8340&quot;</span>
  <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;108.96000176668167114&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;34.25999964418929977&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;manjing&quot;</span>
  <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;864.9816&quot;</span>
  <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;118.75999957323074341&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;32.03999960287850968&quot;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>显示与指定成员一定半径范围内的其他成员

<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> georadiusbymember china<span class="token operator">:</span>city taiyuan <span class="token number">1000</span> km
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;manjing&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;taiyuan&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> georadiusbymember china<span class="token operator">:</span>city taiyuan <span class="token number">1000</span> km withcoord withdist count <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;taiyuan&quot;</span>
  <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;0.0000&quot;</span>
  <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;112.54999905824661255&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;37.86000073876942196&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
  <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;514.2264&quot;</span>
  <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;108.96000176668167114&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;34.25999964418929977&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> geohash china<span class="token operator">:</span>city taiyuan shenyang
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;ww8p3hhqmp0&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;wxrvb9qyxk0&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>geo底层的实现原理实际上就是Zset<span class="token punctuation">,</span> 我们可以通过Zset命令来操作geo
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type china<span class="token operator">:</span>city
zset
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> zrange china<span class="token operator">:</span>city <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span> withscores
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;4040115445396757&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;hangzhou&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;4054133997236782&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;manjing&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;4066006694128997&quot;</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">&quot;taiyuan&quot;</span>
<span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">&quot;4068216047500484&quot;</span>
<span class="token number">9</span><span class="token punctuation">)</span> <span class="token string">&quot;shenyang&quot;</span>
<span class="token number">1</span><span class="token punctuation">)</span>  <span class="token string">&quot;4072519231994779&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span>  <span class="token string">&quot;shengzhen&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span>  <span class="token string">&quot;4154606886655324&quot;</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> zrem china<span class="token operator">:</span>city <span class="token function">manjing</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> zrange china<span class="token operator">:</span>city <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;xian&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;hangzhou&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;taiyuan&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;shenyang&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;shengzhen&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>geoadd</li><li>geopos： 获取指定的成员的经度和纬度</li><li>geodist： 如果不存在, 返回空</li><li>georadius： 附近的人 ==&gt; 获得所有附近的人的地址, 定位, 通过半径来查询</li><li>geohash： 该命令返回11个字符的hash字符串，将二维的经纬度转换为一维的字符串, 如果两个字符串越接近, 则距离越近</li><li>georadisubymember： 显示与指定成员一定半径范围内的其他成员</li><li>zrem</li></ul></li><li><p><strong>存储结构</strong></p><ul><li>并没有设计新的底层数据结构，而是直接使用SortedSet作为底层实现；</li><li>具体实现： <ul><li>先对二维地图做区间划分，并对区间进行编码；之后判断实际的地理位置在哪一个区间上，然后使用这个区间的编码作为SortedSet的权重信息；</li><li>举例说明： 如 某一个地理位置为（112.23E，32.89N），它在划分后的编码为5的区间上，那么就把5作为SortedSet的权重；</li></ul></li></ul></li><li><p>其它</p></li></ol><h4 id="_2-3-2-hyperloglog" tabindex="-1"><a class="header-anchor" href="#_2-3-2-hyperloglog" aria-hidden="true">#</a> 2.3.2. hyperloglog</h4><ol><li><p><strong>应用场景</strong></p><p>HyperLogLog 是 Redis 2.8.9 版本添加的数据结构，它用于高性能的基数（去重）统计功能，也就是说，这种数据结构<strong>可以统计一个集合内所有不重复的元素个数</strong>。它的缺点就是存在0.81% 的误差。但是误差可以通过设置辅助计算因子进行降低。</p><blockquote><p>什么是基数？ 举个例子，A = {1, 2, 3, 4, 5}， B = {3, 5, 6, 7, 9}；那么基数（不重复的元素）= 1, 2, 4, 6, 7, 9； （允许容错，即可以接受一定误差）</p></blockquote></li><li><p><strong>命令</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 添加元素
127.0.0.1:6379&gt; pfadd key &quot;redis&quot;
(integer) 1
127.0.0.1:6379&gt; pfadd key &quot;java&quot; &quot;sql&quot;
(integer) 1

// 统计不重复的元素
127.0.0.1:6379&gt; pfadd key &quot;redis&quot;
(integer) 1
127.0.0.1:6379&gt; pfadd key &quot;sql&quot;
(integer) 1
127.0.0.1:6379&gt; pfadd key &quot;redis&quot;
(integer) 0
127.0.0.1:6379&gt; pfcount key
(integer) 2

// 合并
127.0.0.1:6379&gt; pfadd k &quot;java&quot; &quot;sql&quot;
(integer) 1
127.0.0.1:6379&gt; pfadd k2 &quot;redis&quot; &quot;sql&quot;
(integer) 1
127.0.0.1:6379&gt; pfmerge k3 k k2
OK
127.0.0.1:6379&gt; pfcount k3
(integer) 3

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>存储结构</strong></p><p>HyperLogLog存储数据时，相当于使用一个或多个hash算法，把计算出的hash值保存成类似位图的数据结构，然后在使用时，只需要利用同样的算法计算出所有的key即可。使用位图的方式让Redis使用更少的内存空间来存储大量的key。这种方式比使用set、list等要非常节省空间。</p></li><li><p><strong>其它</strong></p><p>可以用于统计诸如PV、UV的业务场景中。</p><p>一个大型的网站，每天 IP 比如有 100 万，粗算一个 IP 消耗 15 字节，那么 100 万个 IP 就是 15M。而 HyperLogLog 在 Redis 中每个键占用的内容都是 12K，理论存储近似接近 2^64 个值，不管存储的内容是什么，它一个基于基数估算的算法，只能比较准确的估算出基数，可以使用少量固定的内存去存储并识别集合中的唯一元素。而且这个估算的基数并不一定准确，是一个带有 0.81% 标准错误的近似值（对于可以接受一定容错的业务场景，比如IP数统计，UV等，是可以忽略不计的）。</p></li></ol><h4 id="_2-3-3-bitmap" tabindex="-1"><a class="header-anchor" href="#_2-3-3-bitmap" aria-hidden="true">#</a> 2.3.3. bitmap</h4><p>Bitmap即位图，是一串连续的二进制数组（只有0和1），可以通过偏移量定位元素。适用于数据量大且使用二值统计的场景。是基于String类型实现的，只不过是String的值为二进制字节数组。</p><ol><li><p>统计考勤</p><p>比如有这么几个业务场景：</p><ul><li>需要统计某一用户在某一月份的出勤情况；</li><li>统计某一用户的全年出勤情况</li></ul><p>具体实现可能是这样的： 以具有月份意义的字符串作为key，然后以这个月份具有的天数作为偏移量，出勤为1，缺勤为0。这样就相当于为每一个用户都创建12个key，每一个key所使用的Bit位不超过31个（一个月份最多有31天），也就是说最多使用365个bit位就可以表示一个用户的全年出勤情况。如下图表示用户id=28的用户全年的出勤情况：</p><figure><img src="/cs-tips/assets/1699927569604-ae8a9236.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>下图表示用户id=32的用户的全年出勤情况：</p><figure><img src="/cs-tips/assets/1699927602387-84cc1847.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>如，id=13的用户在202206月份的25日出勤了，那么就可以：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SETBIT uuid:sign:13:202206 24 1

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>同样地，id=26的用户在202207月份的18日缺勤，则可以记录为：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SETBIT uuid:sign:26:202207 17 0

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>那么获取id=20的用户在202209月份8日的出勤情况，则可以使用命令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GETBIT uuid:sign:20:202209 7

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以统计id=20的用户在202209月份的出勤天数：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>BITCOUNT uuid:sign:20:202209

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>甚至可以统计id=100的用户在202206月份的首次打卡情况【1表示弹出第一个元素】：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>BITPOS uuid:sign:100:202206 1

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>统计某一用户的全年出勤情况，则可以通过分别获取每一月的出勤情况，然后做一个汇总即可。</p></li><li><p>统计登陆情况</p><p>在很多web应用中，有时会遇到要统计用户登陆情况的业务场景，我们就可以把日期作为key，把用户的id作为偏移量。</p><figure><img src="/cs-tips/assets/1699927635027-eaa03c52.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>例如，userid=4的用户在20220521这一天登陆了，就使用下面的命令在Redis中记录一下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SETBIT 20220521 3 1

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ul><li>20220521 为key；</li><li>3为偏移量，具有业务意义，表示userid=4的偏移量；</li><li>1为字节数组中的元素，表示登陆；</li></ul><p>同样的，可以使用下面命令获取userid=6的用户在20220522这一天的登陆情况：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GETBIT 20220522 5

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>比如统计id=45的用户，在七日内的登陆情况，就相当于统计七个bitmap中偏移量为45的位置上的值，我们只需要把这七个bitmap中偏移量为45的bit值统计出来，然后再创建一个bitmap专门存放这个结果即可实现业务需求。</p></li></ol><h3 id="_2-4-总结" tabindex="-1"><a class="header-anchor" href="#_2-4-总结" aria-hidden="true">#</a> 2.4. 总结</h3><figure><img src="/cs-tips/assets/1700743659736-c8ab3d0b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><details class="hint-container details"><summary>总结</summary><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code>debug object mylist

<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token operator">#</span><span class="token operator">#</span> <span class="token number">1</span><span class="token operator">-</span>string
<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token operator">/</span><span class="token operator">/</span> int
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> set k1 <span class="token number">1</span>
OK
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding k1
<span class="token string">&quot;int&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type k1
string

<span class="token operator">/</span><span class="token operator">/</span> embstr
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> set k2 abcdefghijklmnopqrstuvwxyz123456789012345678
OK
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> strlen k2
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">44</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding k2
<span class="token string">&quot;embstr&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type k2
string

<span class="token operator">/</span><span class="token operator">/</span> raw
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> set k3 abcdefghijklmnopqrstuvwxyz1234567890123456789
OK
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> strlen k3
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">45</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding k3
<span class="token string">&quot;raw&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type k3
string




<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token operator">#</span><span class="token operator">#</span> <span class="token number">2</span><span class="token operator">-</span>list
<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> lpush mylist <span class="token number">1</span> <span class="token number">2</span> ll ls mem
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">5</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding mylist
<span class="token string">&quot;quicklist&quot;</span>

<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> lpush mylist \xe7\xbb\x83\xe6\xb0\x94\xe5\x8a\x9f\xe4\xb8\xba\xe4\xba\x86\xe5\xba\xb7\xe5\xa4\x8d\xe4\xbd\x93\xe8\xb4\xa8\xef\xbc\x8c\xe7\x99\xbe\xe7\x97\x85\xe4\xb8\x8d\xe7\x94\x9f\xef\xbc\x8c\xe5\x8f\xaf\xe6\x98\xaf\xe5\x90\x84\xe4\xba\xba\xe7\xbb\x83\xe5\x8a\x9f\xe5\x8a\x9f\xe6\x95\x88\xe6\x9c\x89\xe5\x88\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xba\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe5\xbf\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xb1\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe6\x85\xa2\xe3\x80\x82\xe5\x9b\xa0\xe6\xad\xa4\xef\xbc\x8c\xe4\xb8\x8d\xe9\xa1\xbb\xe6\x80\xa5\xe4\xba\x8e\xe6\xb1\x82\xe6\x95\x88\xef\xbc\x8c\xe5\x8f\xaa\xe6\x9c\x89\xe6\x8a\x8a\xe7\xad\x91\xe5\x9f\xba\xe5\x8a\x9f\xe5\xa4\xab\xe7\xbb\x83\xe6\x88\x90\xef\xbc\x8c\xe6\x89\x8d\xe6\x9c\x89\xe6\x97\xa5\xe6\x96\xb0\xe6\x9c\x88\xe5\xbc\x82\xe7\x9a\x84\xe6\x95\x88\xe6\x9e\x9c\xe3\x80\x82\xef\xbc\x88\xe3\x80\x8a\xe6\x82\x9f\xe7\x9c\x9f\xe7\xaf\x87\xe3\x80\x8b\xef\xbc\x9a\xe3\x80\x8c\xe8\xa6\x81\xe5\xbe\x97\xe8\xb0\xb7\xe6\x9f\x9b\xe9\x95\xbf\xe4\xb8\x8d\xe6\xad\xbb\xef\xbc\x8c\xe9\xa1\xbb\xe5\x87\xad\xe7\x8e\x84\xe7\x89\x9d\xe7\xab\x8b\xe6\xa0\xb9\xe5\x9f\xba\xe3\x80\x82\xe3\x80\x8d\xef\xbc\x89\xe6\xaf\x8f\xe4\xba\x8e\xe9\x9d\x99\xe5\x9d\x90\xe4\xb9\x8b\xe5\x89\x8d\xef\xbc\x8c\xe5\x8a\xa1\xe8\xa6\x81\xe6\x89\xab\xe9\x99\xa4\xe4\xb8\x80\xe5\x88\x87\xe6\x9d\x82\xe5\xbf\xb5\xef\xbc\x8c\xe5\xae\xbd\xe8\xa1\xa3\xe6\x9d\xbe\xe5\xb8\xa6\xef\xbc\x8c\xe8\xba\xab\xe4\xbd\x93\xe4\xb8\x8d\xe5\x8f\x97\xe6\x9d\x9f\xe7\xbc\x9a\xef\xbc\x8c\xe7\xab\xaf\xe5\x9d\x90\xe5\x9c\xa8\xe6\xa4\x85\xe5\xad\x90\xe4\xb8\x8a\xef\xbc\x8c\xe4\xb8\xa4\xe8\x85\xbf\xe5\x9e\x82\xe5\x9c\xb0\xef\xbc\x8c\xe4\xb8\xa4\xe6\x89\x8b\xe6\x94\xbe\xe5\x9c\xa8\xe8\x86\x9d\xe7\x9b\x96\xe4\xb8\x8a\xe3\x80\x82\xe6\x8a\x8a\xe4\xb8\xa4\xe7\x9b\xae\xe5\xbc\xa0\xe5\xbc\x80\xef\xbc\x8c\xe5\x90\x91\xe5\x89\x8d\xe5\xb9\xb3\xe8\xa7\x86\xef\xbc\x8c\xe6\x8a\x8a\xe7\x9b\xae\xe5\x85\x89\xe5\x87\x9d\xe8\xa7\x86\xe4\xba\x8e\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb9\x8b\xe5\x89\x8d\xe7\x9a\x84\xe6\xad\xa3\xe4\xb8\xad\xe5\xa4\x84\xef\xbc\x8c\xe7\x9c\xbc\xe7\x8f\xa0\xe5\xb0\xbd\xe9\x87\x8f\xe4\xbf\x9d\xe6\x8c\x81\xe4\xb8\x8d\xe5\x8a\xa8\xef\xbc\x8c\xe6\x85\xa2\xe6\x85\xa2\xe5\x9c\xb0\xe6\x94\xb6\xe5\x9b\x9e\xe7\x9b\xae\xe5\x85\x89\xef\xbc\x8c\xe4\xb8\x8d\xe5\x81\x8f\xe4\xb8\x8d\xe4\xbe\x9d\xe5\x9c\xb0\xe9\x9a\x8f\xe5\xbf\x83\xe6\x84\x8f\xe6\x94\xbe\xe5\x9c\xa8\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb8\xad\xe9\x97\xb4\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe9\x87\x8c\xef\xbc\x8c\xe5\x8d\x8a\xe7\x9d\x81\xe5\x8d\x8a\xe9\x97\xad\xef\xbc\x8c\xe5\xa4\x96\xe9\x97\xad\xe5\x86\x85\xe7\x9d\x81\xe8\xa7\x82\xe7\x9c\x8b\xe9\xbc\xbb\xe7\xab\xaf\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe5\x86\x85\xe7\x9a\x84\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xef\xbc\x8c\xe7\x94\xa8\xe6\x84\x8f\xe4\xb8\x8d\xe7\x94\xa8\xe5\x8a\x9b\xe3\x80\x81\xe4\xbc\xbc\xe8\xa7\x82\xe9\x9d\x9e\xe8\xa7\x82\xef\xbc\x8c\xe8\xa7\x82\xe5\x88\xb0\xe8\xa2\x93\xe7\xaa\x8d\xe5\x86\x85\xe5\x8f\x91\xe8\x83\x80\xe3\x80\x81\xe5\x8f\x91\xe7\xb4\xa7\xe3\x80\x81\xe6\x84\x9f\xe5\x88\xb0\xe6\xb8\xa9\xe6\x9a\x96\xef\xbc\x8c\xe8\xbe\xbe\xe5\x88\xb0\xe8\xbf\x99\xe4\xb8\xaa\xe7\x9a\x84\xe6\xa0\x87\xe5\x87\x86\xe6\x97\xb6\xef\xbc\x8c\xe5\x86\x8d\xe7\x94\xa8\xe6\x84\x8f\xe5\xbf\xb5\xe8\xbd\xbb\xe8\xbd\xbb\xe5\x9c\xb0\xe5\xbc\x95\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xe5\x90\x91\xe8\x84\x90\xe4\xb8\x8b\xe4\xb8\xb9\xe7\x94\xb0\xe7\x85\xa7\xe8\xa7\x86\xef\xbc\x8c\xe5\x86\x85\xe8\xa7\x86\xe8\x85\xb9\xe4\xb8\xad\xe4\xb8\x80\xe4\xb8\xaa\xe8\x99\x9a\xe7\xa9\xba\xe5\xa2\x83\xe5\x9c\xb0\xef\xbc\x8c\xe8\xa6\x81\xe6\x9c\x97\xe5\xbd\xbb\xe5\x85\xb6\xe5\x85\x89\xef\xbc\x8c\xe5\xa6\x82\xe5\x90\x8c\xe5\xa4\xa9\xe7\xa9\xba\xe6\x97\xa0\xe4\xba\x91\xe9\x81\xae\xe8\x94\xbd\xe6\x97\xb6\xe5\xa4\xaa\xe9\x98\xb3\xe7\x85\xa7\xe5\xb0\x84\xe5\xa4\xa7\xe5\x9c\xb0\xe4\xb8\x80\xe6\xa0\xb7\xe3\x80\x82\xe9\x9d\x99\xe8\x87\xb3\xe4\xba\x8e\xe6\x9e\x81\xef\xbc\x8c\xe5\x88\xb0\xe6\x97\xa0\xe6\x88\x91\xe6\x97\xa0\xe7\x9b\xb8\xe6\x97\xb6\xef\xbc\x8c\xe5\xb0\xb1\xe4\xba
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">6</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding mylist
<span class="token string">&quot;quicklist&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type mylist
list

<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token operator">#</span><span class="token operator">#</span> <span class="token number">3</span><span class="token operator">-</span>set
<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> sadd myset hao hao1 xiaohao hao
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">3</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding myset
<span class="token string">&quot;hashtable&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> sadd myset2 <span class="token number">12</span> <span class="token number">123</span> <span class="token number">432</span> <span class="token number">1235</span>
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">4</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding myset2
<span class="token string">&quot;intset&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type myset
set
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type myset2
set

<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token operator">#</span><span class="token operator">#</span> <span class="token number">4</span><span class="token operator">-</span>zset
<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> zadd myscoreset <span class="token number">100</span> hao <span class="token number">90</span> xiaohao
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">2</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding myscoreset
<span class="token string">&quot;ziplist&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> zadd myscoreset <span class="token number">80</span> \xe7\xbb\x83\xe6\xb0\x94\xe5\x8a\x9f\xe4\xb8\xba\xe4\xba\x86\xe5\xba\xb7\xe5\xa4\x8d\xe4\xbd\x93\xe8\xb4\xa8\xef\xbc\x8c\xe7\x99\xbe\xe7\x97\x85\xe4\xb8\x8d\xe7\x94\x9f\xef\xbc\x8c\xe5\x8f\xaf\xe6\x98\xaf\xe5\x90\x84\xe4\xba\xba\xe7\xbb\x83\xe5\x8a\x9f\xe5\x8a\x9f\xe6\x95\x88\xe6\x9c\x89\xe5\x88\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xba\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe5\xbf\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xb1\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe6\x85\xa2\xe3\x80\x82\xe5\x9b\xa0\xe6\xad\xa4\xef\xbc\x8c\xe4\xb8\x8d\xe9\xa1\xbb\xe6\x80\xa5\xe4\xba\x8e\xe6\xb1\x82\xe6\x95\x88\xef\xbc\x8c\xe5\x8f\xaa\xe6\x9c\x89\xe6\x8a\x8a\xe7\xad\x91\xe5\x9f\xba\xe5\x8a\x9f\xe5\xa4\xab\xe7\xbb\x83\xe6\x88\x90\xef\xbc\x8c\xe6\x89\x8d\xe6\x9c\x89\xe6\x97\xa5\xe6\x96\xb0\xe6\x9c\x88\xe5\xbc\x82\xe7\x9a\x84\xe6\x95\x88\xe6\x9e\x9c\xe3\x80\x82\xef\xbc\x88\xe3\x80\x8a\xe6\x82\x9f\xe7\x9c\x9f\xe7\xaf\x87\xe3\x80\x8b\xef\xbc\x9a\xe3\x80\x8c\xe8\xa6\x81\xe5\xbe\x97\xe8\xb0\xb7\xe6\x9f\x9b\xe9\x95\xbf\xe4\xb8\x8d\xe6\xad\xbb\xef\xbc\x8c\xe9\xa1\xbb\xe5\x87\xad\xe7\x8e\x84\xe7\x89\x9d\xe7\xab\x8b\xe6\xa0\xb9\xe5\x9f\xba\xe3\x80\x82\xe3\x80\x8d\xef\xbc\x89\xe6\xaf\x8f\xe4\xba\x8e\xe9\x9d\x99\xe5\x9d\x90\xe4\xb9\x8b\xe5\x89\x8d\xef\xbc\x8c\xe5\x8a\xa1\xe8\xa6\x81\xe6\x89\xab\xe9\x99\xa4\xe4\xb8\x80\xe5\x88\x87\xe6\x9d\x82\xe5\xbf\xb5\xef\xbc\x8c\xe5\xae\xbd\xe8\xa1\xa3\xe6\x9d\xbe\xe5\xb8\xa6\xef\xbc\x8c\xe8\xba\xab\xe4\xbd\x93\xe4\xb8\x8d\xe5\x8f\x97\xe6\x9d\x9f\xe7\xbc\x9a\xef\xbc\x8c\xe7\xab\xaf\xe5\x9d\x90\xe5\x9c\xa8\xe6\xa4\x85\xe5\xad\x90\xe4\xb8\x8a\xef\xbc\x8c\xe4\xb8\xa4\xe8\x85\xbf\xe5\x9e\x82\xe5\x9c\xb0\xef\xbc\x8c\xe4\xb8\xa4\xe6\x89\x8b\xe6\x94\xbe\xe5\x9c\xa8\xe8\x86\x9d\xe7\x9b\x96\xe4\xb8\x8a\xe3\x80\x82\xe6\x8a\x8a\xe4\xb8\xa4\xe7\x9b\xae\xe5\xbc\xa0\xe5\xbc\x80\xef\xbc\x8c\xe5\x90\x91\xe5\x89\x8d\xe5\xb9\xb3\xe8\xa7\x86\xef\xbc\x8c\xe6\x8a\x8a\xe7\x9b\xae\xe5\x85\x89\xe5\x87\x9d\xe8\xa7\x86\xe4\xba\x8e\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb9\x8b\xe5\x89\x8d\xe7\x9a\x84\xe6\xad\xa3\xe4\xb8\xad\xe5\xa4\x84\xef\xbc\x8c\xe7\x9c\xbc\xe7\x8f\xa0\xe5\xb0\xbd\xe9\x87\x8f\xe4\xbf\x9d\xe6\x8c\x81\xe4\xb8\x8d\xe5\x8a\xa8\xef\xbc\x8c\xe6\x85\xa2\xe6\x85\xa2\xe5\x9c\xb0\xe6\x94\xb6\xe5\x9b\x9e\xe7\x9b\xae\xe5\x85\x89\xef\xbc\x8c\xe4\xb8\x8d\xe5\x81\x8f\xe4\xb8\x8d\xe4\xbe\x9d\xe5\x9c\xb0\xe9\x9a\x8f\xe5\xbf\x83\xe6\x84\x8f\xe6\x94\xbe\xe5\x9c\xa8\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb8\xad\xe9\x97\xb4\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe9\x87\x8c\xef\xbc\x8c\xe5\x8d\x8a\xe7\x9d\x81\xe5\x8d\x8a\xe9\x97\xad\xef\xbc\x8c\xe5\xa4\x96\xe9\x97\xad\xe5\x86\x85\xe7\x9d\x81\xe8\xa7\x82\xe7\x9c\x8b\xe9\xbc\xbb\xe7\xab\xaf\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe5\x86\x85\xe7\x9a\x84\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xef\xbc\x8c\xe7\x94\xa8\xe6\x84\x8f\xe4\xb8\x8d\xe7\x94\xa8\xe5\x8a\x9b\xe3\x80\x81\xe4\xbc\xbc\xe8\xa7\x82\xe9\x9d\x9e\xe8\xa7\x82\xef\xbc\x8c\xe8\xa7\x82\xe5\x88\xb0\xe8\xa2\x93\xe7\xaa\x8d\xe5\x86\x85\xe5\x8f\x91\xe8\x83\x80\xe3\x80\x81\xe5\x8f\x91\xe7\xb4\xa7\xe3\x80\x81\xe6\x84\x9f\xe5\x88\xb0\xe6\xb8\xa9\xe6\x9a\x96\xef\xbc\x8c\xe8\xbe\xbe\xe5\x88\xb0\xe8\xbf\x99\xe4\xb8\xaa\xe7\x9a\x84\xe6\xa0\x87\xe5\x87\x86\xe6\x97\xb6\xef\xbc\x8c\xe5\x86\x8d\xe7\x94\xa8\xe6\x84\x8f\xe5\xbf\xb5\xe8\xbd\xbb\xe8\xbd\xbb\xe5\x9c\xb0\xe5\xbc\x95\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xe5\x90\x91\xe8\x84\x90\xe4\xb8\x8b\xe4\xb8\xb9\xe7\x94\xb0\xe7\x85\xa7\xe8\xa7\x86\xef\xbc\x8c\xe5\x86\x85\xe8\xa7\x86\xe8\x85\xb9\xe4\xb8\xad\xe4\xb8\x80\xe4\xb8\xaa\xe8\x99\x9a\xe7\xa9\xba\xe5\xa2\x83\xe5\x9c\xb0\xef\xbc\x8c\xe8\xa6\x81\xe6\x9c\x97\xe5\xbd\xbb\xe5\x85\xb6\xe5\x85\x89\xef\xbc\x8c\xe5\xa6\x82\xe5\x90\x8c\xe5\xa4\xa9\xe7\xa9\xba\xe6\x97\xa0\xe4\xba\x91\xe9\x81\xae\xe8\x94\xbd\xe6\x97\xb6\xe5\xa4\xaa\xe9\x98\xb3\xe7\x85\xa7\xe5\xb0\x84\xe5\xa4\xa7\xe5\x9c\xb0\xe4\xb8\x80\xe6\xa0\xb7\xe3\x80\x82\xe9\x9d\x99\xe8\x87\xb3\xe4\xba\x8e\xe6\x9e\x81\xef\xbc\x8c\xe5\x88\xb0\xe6\x97\xa0\xe6\x88\x91\xe6\x97\xa0\xe7\x9b\xb8\xe6\x97\xb6\xef\xbc\x8c\xe5\xb0\xb1\xe4\xba
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding myscoreset
<span class="token string">&quot;skiplist&quot;</span>

<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type myscoreset
zset


c<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token operator">#</span><span class="token operator">#</span> <span class="token number">5</span><span class="token operator">-</span>hash
<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user name zhangshan
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user email hao<span class="token operator">@</span>163<span class="token punctuation">.</span>com
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding user
<span class="token string">&quot;ziplist&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> hset user say \xe7\xbb\x83\xe6\xb0\x94\xe5\x8a\x9f\xe4\xb8\xba\xe4\xba\x86\xe5\xba\xb7\xe5\xa4\x8d\xe4\xbd\x93\xe8\xb4\xa8\xef\xbc\x8c\xe7\x99\xbe\xe7\x97\x85\xe4\xb8\x8d\xe7\x94\x9f\xef\xbc\x8c\xe5\x8f\xaf\xe6\x98\xaf\xe5\x90\x84\xe4\xba\xba\xe7\xbb\x83\xe5\x8a\x9f\xe5\x8a\x9f\xe6\x95\x88\xe6\x9c\x89\xe5\x88\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xba\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe5\xbf\xab\xef\xbc\x8c\xe4\xbd\x93\xe8\xb4\xa8\xe5\xbc\xb1\xe8\x80\x85\xe5\x8a\x9f\xe6\x95\x88\xe6\x85\xa2\xe3\x80\x82\xe5\x9b\xa0\xe6\xad\xa4\xef\xbc\x8c\xe4\xb8\x8d\xe9\xa1\xbb\xe6\x80\xa5\xe4\xba\x8e\xe6\xb1\x82\xe6\x95\x88\xef\xbc\x8c\xe5\x8f\xaa\xe6\x9c\x89\xe6\x8a\x8a\xe7\xad\x91\xe5\x9f\xba\xe5\x8a\x9f\xe5\xa4\xab\xe7\xbb\x83\xe6\x88\x90\xef\xbc\x8c\xe6\x89\x8d\xe6\x9c\x89\xe6\x97\xa5\xe6\x96\xb0\xe6\x9c\x88\xe5\xbc\x82\xe7\x9a\x84\xe6\x95\x88\xe6\x9e\x9c\xe3\x80\x82\xef\xbc\x88\xe3\x80\x8a\xe6\x82\x9f\xe7\x9c\x9f\xe7\xaf\x87\xe3\x80\x8b\xef\xbc\x9a\xe3\x80\x8c\xe8\xa6\x81\xe5\xbe\x97\xe8\xb0\xb7\xe6\x9f\x9b\xe9\x95\xbf\xe4\xb8\x8d\xe6\xad\xbb\xef\xbc\x8c\xe9\xa1\xbb\xe5\x87\xad\xe7\x8e\x84\xe7\x89\x9d\xe7\xab\x8b\xe6\xa0\xb9\xe5\x9f\xba\xe3\x80\x82\xe3\x80\x8d\xef\xbc\x89\xe6\xaf\x8f\xe4\xba\x8e\xe9\x9d\x99\xe5\x9d\x90\xe4\xb9\x8b\xe5\x89\x8d\xef\xbc\x8c\xe5\x8a\xa1\xe8\xa6\x81\xe6\x89\xab\xe9\x99\xa4\xe4\xb8\x80\xe5\x88\x87\xe6\x9d\x82\xe5\xbf\xb5\xef\xbc\x8c\xe5\xae\xbd\xe8\xa1\xa3\xe6\x9d\xbe\xe5\xb8\xa6\xef\xbc\x8c\xe8\xba\xab\xe4\xbd\x93\xe4\xb8\x8d\xe5\x8f\x97\xe6\x9d\x9f\xe7\xbc\x9a\xef\xbc\x8c\xe7\xab\xaf\xe5\x9d\x90\xe5\x9c\xa8\xe6\xa4\x85\xe5\xad\x90\xe4\xb8\x8a\xef\xbc\x8c\xe4\xb8\xa4\xe8\x85\xbf\xe5\x9e\x82\xe5\x9c\xb0\xef\xbc\x8c\xe4\xb8\xa4\xe6\x89\x8b\xe6\x94\xbe\xe5\x9c\xa8\xe8\x86\x9d\xe7\x9b\x96\xe4\xb8\x8a\xe3\x80\x82\xe6\x8a\x8a\xe4\xb8\xa4\xe7\x9b\xae\xe5\xbc\xa0\xe5\xbc\x80\xef\xbc\x8c\xe5\x90\x91\xe5\x89\x8d\xe5\xb9\xb3\xe8\xa7\x86\xef\xbc\x8c\xe6\x8a\x8a\xe7\x9b\xae\xe5\x85\x89\xe5\x87\x9d\xe8\xa7\x86\xe4\xba\x8e\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb9\x8b\xe5\x89\x8d\xe7\x9a\x84\xe6\xad\xa3\xe4\xb8\xad\xe5\xa4\x84\xef\xbc\x8c\xe7\x9c\xbc\xe7\x8f\xa0\xe5\xb0\xbd\xe9\x87\x8f\xe4\xbf\x9d\xe6\x8c\x81\xe4\xb8\x8d\xe5\x8a\xa8\xef\xbc\x8c\xe6\x85\xa2\xe6\x85\xa2\xe5\x9c\xb0\xe6\x94\xb6\xe5\x9b\x9e\xe7\x9b\xae\xe5\x85\x89\xef\xbc\x8c\xe4\xb8\x8d\xe5\x81\x8f\xe4\xb8\x8d\xe4\xbe\x9d\xe5\x9c\xb0\xe9\x9a\x8f\xe5\xbf\x83\xe6\x84\x8f\xe6\x94\xbe\xe5\x9c\xa8\xe4\xb8\xa4\xe7\x9c\xbc\xe4\xb8\xad\xe9\x97\xb4\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe9\x87\x8c\xef\xbc\x8c\xe5\x8d\x8a\xe7\x9d\x81\xe5\x8d\x8a\xe9\x97\xad\xef\xbc\x8c\xe5\xa4\x96\xe9\x97\xad\xe5\x86\x85\xe7\x9d\x81\xe8\xa7\x82\xe7\x9c\x8b\xe9\xbc\xbb\xe7\xab\xaf\xe8\xa2\x93\xe7\xaa\x8d\xe7\xa9\xb4\xe5\x86\x85\xe7\x9a\x84\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xef\xbc\x8c\xe7\x94\xa8\xe6\x84\x8f\xe4\xb8\x8d\xe7\x94\xa8\xe5\x8a\x9b\xe3\x80\x81\xe4\xbc\xbc\xe8\xa7\x82\xe9\x9d\x9e\xe8\xa7\x82\xef\xbc\x8c\xe8\xa7\x82\xe5\x88\xb0\xe8\xa2\x93\xe7\xaa\x8d\xe5\x86\x85\xe5\x8f\x91\xe8\x83\x80\xe3\x80\x81\xe5\x8f\x91\xe7\xb4\xa7\xe3\x80\x81\xe6\x84\x9f\xe5\x88\xb0\xe6\xb8\xa9\xe6\x9a\x96\xef\xbc\x8c\xe8\xbe\xbe\xe5\x88\xb0\xe8\xbf\x99\xe4\xb8\xaa\xe7\x9a\x84\xe6\xa0\x87\xe5\x87\x86\xe6\x97\xb6\xef\xbc\x8c\xe5\x86\x8d\xe7\x94\xa8\xe6\x84\x8f\xe5\xbf\xb5\xe8\xbd\xbb\xe8\xbd\xbb\xe5\x9c\xb0\xe5\xbc\x95\xe3\x80\x8c\xe7\xa9\xba\xe8\x99\x9a\xe4\xb9\x8b\xe5\x85\x89\xe3\x80\x8d\xe5\x90\x91\xe8\x84\x90\xe4\xb8\x8b\xe4\xb8\xb9\xe7\x94\xb0\xe7\x85\xa7\xe8\xa7\x86\xef\xbc\x8c\xe5\x86\x85\xe8\xa7\x86\xe8\x85\xb9\xe4\xb8\xad\xe4\xb8\x80\xe4\xb8\xaa\xe8\x99\x9a\xe7\xa9\xba\xe5\xa2\x83\xe5\x9c\xb0\xef\xbc\x8c\xe8\xa6\x81\xe6\x9c\x97\xe5\xbd\xbb\xe5\x85\xb6\xe5\x85\x89\xef\xbc\x8c\xe5\xa6\x82\xe5\x90\x8c\xe5\xa4\xa9\xe7\xa9\xba\xe6\x97\xa0\xe4\xba\x91\xe9\x81\xae\xe8\x94\xbd\xe6\x97\xb6\xe5\xa4\xaa\xe9\x98\xb3\xe7\x85\xa7\xe5\xb0\x84\xe5\xa4\xa7\xe5\x9c\xb0\xe4\xb8\x80\xe6\xa0\xb7\xe3\x80\x82\xe9\x9d\x99\xe8\x87\xb3\xe4\xba\x8e\xe6\x9e\x81\xef\xbc\x8c\xe5\x88\xb0\xe6\x97\xa0\xe6\x88\x91\xe6\x97\xa0\xe7\x9b\xb8\xe6\x97\xb6\xef\xbc\x8c\xe5\xb0\xb1\xe4\xba\xa7\
<span class="token operator">(</span>integer<span class="token operator">)</span> <span class="token number">1</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> object encoding user
<span class="token string">&quot;hashtable&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type user
hash


<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token operator">#</span><span class="token operator">#</span> <span class="token number">6</span><span class="token operator">-</span>stream
<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> XADD mymsgqueue <span class="token operator">*</span> name zeanzai
<span class="token string">&quot;1716282237930-0&quot;</span>
<span class="token ip-address constant">127.0.0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> type mymsgqueue
stream
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></div><h3 id="_2-5-命令汇总" tabindex="-1"><a class="header-anchor" href="#_2-5-命令汇总" aria-hidden="true">#</a> 2.5. 命令汇总</h3><ul><li>针对 key 的</li><li>针对某一数据类型的</li><li>针对整个数据库</li><li>配置参数的查询 <ul><li>直接查看配置文件</li><li>使用 <code>config get #{key}</code> 命令查询</li></ul></li><li>修改配置文件方式 <ul><li>直接修改config文件，但是需要重启才可以生效，永远生效</li><li>使用 <code>config set #{key}</code> 命令进行修改，不需要重启即可生效，但是下次启动后失效</li></ul></li></ul><h2 id="_3-高级特性" tabindex="-1"><a class="header-anchor" href="#_3-高级特性" aria-hidden="true">#</a> 3. 高级特性</h2><h3 id="_3-1-事务" tabindex="-1"><a class="header-anchor" href="#_3-1-事务" aria-hidden="true">#</a> 3.1. 事务</h3><h3 id="_3-2-lua-脚本" tabindex="-1"><a class="header-anchor" href="#_3-2-lua-脚本" aria-hidden="true">#</a> 3.2. LUA 脚本</h3><h3 id="_3-3-消息队列-发布订阅" tabindex="-1"><a class="header-anchor" href="#_3-3-消息队列-发布订阅" aria-hidden="true">#</a> 3.3. 消息队列（发布订阅）</h3><h3 id="_3-4-搜索引擎" tabindex="-1"><a class="header-anchor" href="#_3-4-搜索引擎" aria-hidden="true">#</a> 3.4. 搜索引擎</h3><h3 id="_3-5-管道" tabindex="-1"><a class="header-anchor" href="#_3-5-管道" aria-hidden="true">#</a> 3.5. 管道</h3><p>-Pipeline</p><p>所谓管道技术，就是把之前的一次一个命令的执行方式，变成一次执行多个命令的方式。它本质上是客户端提供的特性，目的是提高客户端的利用效率。</p><p>但在使用时需要注意的是：</p><ol><li>发送的命令数量不会被限制，但是输入缓存区也就是命令的最大存储体积为1GB，当发送的命令超过此限制时，命令不会被执行，并且会被 Redis 服务器端断开此链接；</li><li>如果管道的数据过多可能会导致客户端的等待时间过长，导致网络阻塞；</li><li>部分客户端自己本身也有缓存区大小的设置，如果管道命令没有没执行或者是执行不完整，可以排查此情况或较少管道内的命令重新尝试执行。</li></ol><h3 id="_3-6-布隆过滤器" tabindex="-1"><a class="header-anchor" href="#_3-6-布隆过滤器" aria-hidden="true">#</a> 3.6. 布隆过滤器</h3><h3 id="_3-7-迭代器" tabindex="-1"><a class="header-anchor" href="#_3-7-迭代器" aria-hidden="true">#</a> 3.7. 迭代器</h3><h3 id="事件" tabindex="-1"><a class="header-anchor" href="#事件" aria-hidden="true">#</a> 事件</h3><h2 id="_4-内存管理" tabindex="-1"><a class="header-anchor" href="#_4-内存管理" aria-hidden="true">#</a> 4. 内存管理</h2><p>内存管理主要是指两部分内容：</p><ol><li>键的驱逐策略；</li><li>当内存不够用时，内存回收策略；</li></ol><h3 id="_4-1-键的驱逐策略-删除策略" tabindex="-1"><a class="header-anchor" href="#_4-1-键的驱逐策略-删除策略" aria-hidden="true">#</a> 4.1. 键的驱逐策略（删除策略）</h3><h4 id="_4-1-1-redis-中键的过期时间的管理" tabindex="-1"><a class="header-anchor" href="#_4-1-1-redis-中键的过期时间的管理" aria-hidden="true">#</a> 4.1.1. Redis 中键的过期时间的管理</h4><p>Redis提供了四个命令来设置过期时间（生存时间）。</p><ol><li><strong>EXPIRE <code>&lt;key&gt;</code> <code>&lt;ttl&gt;</code></strong> ：表示将键 key 的生存时间设置为 ttl 秒。</li><li><strong>PEXPIRE <code>&lt;key&gt;</code> <code>&lt;ttl&gt;</code></strong> ：表示将键 key 的生存时间设置为 ttl 毫秒。</li><li><strong>EXPIREAT <code>&lt;key&gt;</code> <code>&lt;timestamp&gt;</code></strong> ：表示将键 key 的生存时间设置为 timestamp 所指定的秒数时间戳。</li><li><strong>PEXPIREAT <code>&lt;key&gt;</code> <code>&lt;timestamp&gt;</code></strong> ：表示将键 key 的生存时间设置为 timestamp 所指定的毫秒数时间戳。</li></ol><blockquote><p>PS：在Redis内部实现中，前面三个设置过期时间的命令最后都会转换成最后一个 PEXPIREAT 命令来完成。</p></blockquote><p>移除过期时间：</p><ul><li><strong>PERSIST <code>&lt;key&gt;</code></strong> ：表示将key的过期时间移除。</li></ul><p>返回剩余生存时间：</p><ul><li><strong>TTL <code>&lt;key&gt;</code></strong> ：以秒的单位返回键 key 的剩余生存时间。</li><li><strong>PTTL <code>&lt;key&gt;</code></strong> ：以毫秒的单位返回键 key 的剩余生存时间。</li></ul><h4 id="_4-1-2-删除带过期时间的-key-的通用做法" tabindex="-1"><a class="header-anchor" href="#_4-1-2-删除带过期时间的-key-的通用做法" aria-hidden="true">#</a> 4.1.2. 删除带过期时间的 key 的通用做法</h4><p>软件工程学中，删除带过期时间的 key 的通用做法主要有以下三种：</p><ol><li><strong>定时删除</strong>： 设置过期时间时，创建一个定时器，过期时间一到，操作系统自动触发定时器，立马执行删除方法。 <ul><li>优点：定时删除对内存是最友好的，能够保证内存的key一旦过期就能立即从内存中删除。</li><li>缺点：对CPU最不友好，在过期键比较多的时候，删除过期键会占用一部分 CPU 时间，对服务器的响应时间和吞吐量造成影响。并且 key 很多时就需要很多的定时任务来完成，这个也是一个不小的性能开销；</li></ul></li><li><strong>惰性删除</strong>： 用到时，先判断一下是否过期了，没过期就允许操作，过期了就执行删除方法。 <ul><li>特点：这种删除方式有两种实现思路 <ul><li>同步删除： 即哪个线程用到，就由哪个线程来完成删除动作，这个过程是阻塞的；</li><li>异步删除： 即碰到过期情况时，用到这个 key 的线程会通知另外的删除线程，让另外的删除线程来完成删除动作，之后直接返回过期的响应结果；</li></ul></li><li>优点：对 CPU友好，我们只会在使用该键时才会进行过期检查，对于很多用不到的key不用浪费时间进行过期检查。</li><li>缺点：对内存不友好，如果一个键已经过期，但是一直没有使用，那么该键就会一直存在内存中，如果数据库中有很多这种使用不到的过期键，这些键便永远不会被删除，内存永远不会释放。从而造成内存泄漏。</li></ul></li><li><strong>定期删除</strong>： 并不是为每一个key都设置一个定时器，而是设置一个额外的定时器，这个定时器会<strong>定期扫描</strong>部分数据，然后删除过期的。 <ol><li>优点：可以通过限制删除操作执行的时长和频率来减少删除操作对 CPU 的影响。另外定期删除，也能有效释放过期键占用的内存。</li><li>缺点：难以确定删除操作执行的时长和频率。 <ol><li>如果执行的太频繁，定期删除策略变得和定时删除策略一样，对CPU不友好。</li><li>如果执行的太少，那又和惰性删除一样了，过期键占用的内存不会及时得到释放。</li><li>另外最重要的是，在获取某个键时，如果某个键的过期时间已经到了，但是还没执行定期删除，那么就会返回这个键的值，这是业务不能忍受的错误。</li></ol></li></ol></li></ol><h4 id="_4-1-3-redis-中的键的驱逐策略-删除策略" tabindex="-1"><a class="header-anchor" href="#_4-1-3-redis-中的键的驱逐策略-删除策略" aria-hidden="true">#</a> 4.1.3. redis 中的键的驱逐策略（删除策略）</h4><blockquote><p>eviction： 美: [ɪˈvɪkʃən]， 英: [ɪˈvɪkʃ(ə)n]， **n.**赶出；(租地,租房等的)收回；**网络释义：**驱逐；逐出；驱逐租客</p></blockquote><p>Redis 中键的驱逐策略（删除策略）是组合使用的，即使用「<strong>惰性删除+定期删除</strong>」两种策略配合使用的方式。</p><ol><li><p>键的过期的判断过程</p><p>在Redis内部，每当我们设置一个键的过期时间时，Redis就会将该键带上过期时间存放到一个过期字典中。当我们查询一个键时，Redis便首先检查该键是否存在过期字典中，如果存在，那就获取其过期时间。然后将过期时间和当前系统时间进行比对，比系统时间大，那就没有过期；反之判定该键过期。</p></li><li><p>惰性删除</p><p>惰性删除：Redis的惰性删除策略由 db.c/expireIfNeeded 函数实现，所有键读写命令执行之前都会调用 expireIfNeeded 函数对其进行检查，如果过期，则删除该键，然后执行键不存在的操作；未过期则不作操作，继续执行原有的命令。</p><p>大多情况下惰性删除都是阻塞式的，也就是说删除过程是由发起命令的线程来执行的，这就会出现另外一个问题，那就是有时候碰到大 key 时，可能会导致主线程秒级的阻塞，这对 redis 服务端的吞吐量是个巨大的影响；因此 redis 提供了另外一种删除方式：非阻塞式惰性删除，也可以称作异步删除，其大概原理是：在主线程的基础上再开启一个新线程来完成删除动作。</p><p>惰性删除是默认开启的，但是有一些业务场景中并不需要惰性删除，而是需要立即删除，例如：</p><ol><li>在为新的 key 分配内存空间时，发现内存空间不足以分配给新 key 了，那就不能够再使用惰性删除了，而是应该立刻删除；</li><li>使用 EXPIRE 命令让一个 key 过期时，也需要立刻删除这个 key；</li><li>再比如 RENAME 命令需要删除旧的键名，这个过程也是要立刻删除旧 key 的；</li><li>再比如，主从复制运行模式下，主节点执行了 flusdb 等清库的命令时，也是需要立刻同步到从库的；</li></ol><p>上面这四种情况下，是不需要惰性删除的，而是需要立即删除的，在配置文件中的<strong>LAZY FREEING</strong>部分，可以对这四种情况进行配置，使它们不使用惰性删除，no 表示不使用惰性删除：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">lazyfree-lazy-eviction</span> <span class="token value attr-value">no     # 表示键驱逐时，不使用惰性删除，而是直接删除；</span>
<span class="token key attr-name">lazyfree-lazy-expire</span> <span class="token value attr-value">no      # 表示使用一些过期命令时，不使用惰性删除；</span>
<span class="token key attr-name">lazyfree-lazy-server-del</span> <span class="token value attr-value">no    # 表示 当server发送一些删除式命令时，不使用惰性删除；【server和客户端是同一角色，它们都可以给存储引擎部分发送命令】</span>
<span class="token key attr-name">replica-lazy-flush</span> <span class="token value attr-value">no       # 表示主从运行模式下不会使用惰性删除；</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>定期删除</p><p>由redis.c/activeExpireCycle 函数实现，函数以一定的频率运行，每次运行时，都从一定数量的数据库中取出一定数量的随机键进行检查，并删除其中的过期键。</p><p>注意：并不是一次运行就检查所有的库，所有的键，而是随机检查一定数量的键。 定期删除函数的运行频率，在Redis2.6版本中，规定每秒运行10次，大概100ms运行一次。在Redis2.8版本后，可以通过修改配置文件redis.conf 的 hz 选项来调整这个次数。</p><p>看上面对这个参数的解释，建议不要将这个值设置超过 100，否则会对CPU造成比较大的压力。</p></li><li><p>键的驱逐策略的问题</p><p>我们看到，通过过期删除策略，对于某些永远使用不到的键，并且多次定期删除也没选定到并删除，那么这些键同样会一直驻留在内存中，又或者在Redis中存入了大量的键，这些操作可能会导致Redis内存不够用，这时候就需要Redis的内存淘汰策略了。</p></li></ol><h3 id="_4-2-内存回收机制" tabindex="-1"><a class="header-anchor" href="#_4-2-内存回收机制" aria-hidden="true">#</a> 4.2. 内存回收机制</h3><p>我们看到，通过过期删除策略，对于某些永远使用不到的键，并且多次定期删除也没选定到并删除，那么这些键同样会一直驻留在内存中，又或者在Redis中存入了大量的键，这些操作可能会导致Redis内存不够用，这时候就需要Redis的内存淘汰策略了。</p><p>这块对应于配置文件redis.conf 中的MEMORY MANAGEMENT部分。</p><ul><li><strong>maxmemory</strong>: <ul><li>描述：设置 Redis 使用的最大内存量。当 Redis 达到这个内存限制时，会触发内存淘汰策略。</li><li>语法：maxmemory <code>&lt;bytes&gt;</code></li><li>示例：maxmemory 256mb</li></ul></li><li><strong>maxmemory-policy</strong>: <ul><li>描述：设置 Redis 达到内存限制后，使用哪种内存淘汰策略。可能的值包括： <ul><li><strong>volatile-lru</strong>：从设置了过期时间的键值对集合中，淘汰 「<strong>最久未使用</strong>」的；</li><li><strong>allkeys-lru</strong>：从所有键值对集合中，淘汰「<strong>最久未使用</strong>」的；</li><li><strong>volatile-lfu</strong>：从设置了过期时间的键值对集合中，淘汰「<strong>最不常用到</strong>」的；</li><li><strong>allkeys-lfu</strong>：从所有键值对集合中，淘汰「<strong>最不常用到</strong>」的；</li><li><strong>volatile-random</strong>：从设置了过期时间的键值对集合中，「<strong>随机</strong>」淘汰；</li><li><strong>allkeys-random</strong>：从所有键值对集合中，「<strong>随机</strong>」淘汰；</li><li><strong>volatile-ttl</strong>：从设置了过期时间的键值对集合中，淘汰「<strong>即将过期</strong>」的；</li><li><strong>noeviction</strong>：不淘汰任何数据，当内存不足时，新增操作会报错，Redis 默认内存淘汰策略；redis只响应读命令，对需要申请内存的写命令回复error；</li></ul></li><li>语法：maxmemory-policy <code>&lt;policy&gt;</code></li><li>示例：maxmemory-policy allkeys-lru</li></ul></li><li><strong>maxmemory-samples</strong>: <ul><li>描述：设置 LRU 算法和最少频率使用（LFU）算法进行采样时的样本大小。较大的样本大小能提高精确度，但会增加 CPU 开销。</li><li>语法：maxmemory-samples <code>&lt;number&gt;</code></li><li>示例：maxmemory-samples 5</li></ul></li><li><strong>lfu-log-factor</strong>: <ul><li>描述：设置 LFU 算法的对数因子，控制访问频率计数的增加速度。较高的值会使计数增加速度变慢。</li><li>语法：lfu-log-factor <code>&lt;factor&gt;</code></li><li>示例：lfu-log-factor 10</li></ul></li><li><strong>lfu-decay-time</strong>: <ul><li>描述：设置 LFU 算法的衰减时间，以分钟为单位。计数会每隔这个时间减少一半。</li><li>语法：lfu-decay-time <code>&lt;minutes&gt;</code></li><li>示例：lfu-decay-time 1</li></ul></li></ul><blockquote><p>PS：</p><ol><li>volatile： 美: [ˈvɑlət(ə)l]， 英: [ˈvɒlətaɪl]， adj. ，易变的；无定性的；无常性的；可能急剧波动的； 网络释义：挥发性；挥发性的；不稳定的。<strong>这里表示设置了过期时间的 key</strong>。</li><li>其中 allkeys-xxx 表示： 从所有的键值中淘汰数据；而 volatile-xxx 表示： 从设置了过期键的键值中淘汰数据。</li><li>淘汰时要从圈定的 key 的集合中，选择一部分进行淘汰， 这个选择有三种算法： <ol><li><strong>LRU</strong>（<strong>L</strong>east <strong>R</strong>ecently <strong>U</strong>sed）： <strong>最近最少使用的、最久没有使用的</strong>；这种算法有一个缺点，比如说很久没有使用的一个键值，如果最近被访问了一次，那么它就不会被淘汰，即使它是使用次数最少的缓存，那它也不会被淘汰。</li><li><strong>LFU</strong>（<strong>L</strong>east <strong>F</strong>requently <strong>U</strong>sed）： <strong>使用频率最小的、最不常使用到的</strong>；这种算法弥补了 LRU 的弊端；</li><li><strong>random</strong>：随机的；</li></ol></li></ol></blockquote><h2 id="_5-持久化机制" tabindex="-1"><a class="header-anchor" href="#_5-持久化机制" aria-hidden="true">#</a> 5. 持久化机制</h2><p>所谓持久化机制就是把内存中的数据保存到磁盘上的过程。早期版本有两种持久化方式： RDB 持久化方式和 AOF 持久化方式。但这两种方式均有优劣，所以后来的版本中，redis 综合了两者优缺点，提出了混合持久化方式。</p><h3 id="_5-1-rdb-持久化方式" tabindex="-1"><a class="header-anchor" href="#_5-1-rdb-持久化方式" aria-hidden="true">#</a> 5.1. RDB 持久化方式</h3><p>RDB（<strong>R</strong>edis <strong>D</strong>ata <strong>B</strong>ase），就是某一时刻内存的快照，是一个二进制文件，属于内存紧凑型的文件。所谓 RDB 持久化方式，就是在某一时刻把 redis 内存的快照信息保存成 RDB 文件，并持久化到磁盘的过程。</p><blockquote><p>快照是一个非常重要的概念，在一些持久化的场景中应用非常广泛，如 MySQL 中的 MVVC。它出现的目标就是为了持久化内存数据，基本原理是设置一些内存中的指标，这些指标可以用来标识执行持久化时的具体现场。 内存中的指标： 比如要某一时刻内存中的数据不在发生变化，我们就可以取这个时刻来表明我们持久化时的现场。</p></blockquote><h4 id="_5-1-1-配置参数有哪些" tabindex="-1"><a class="header-anchor" href="#_5-1-1-配置参数有哪些" aria-hidden="true">#</a> 5.1.1. 配置参数有哪些？</h4><p>配置参数在 redis.conf 配置文件中的 <code>SNAPSHOTTING</code> 块。</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code># 周期性执行条件的设置格式为
save <span class="token operator">&lt;</span>seconds<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>changes<span class="token operator">&gt;</span>

# 默认的设置为：
save <span class="token number">900</span> <span class="token number">1</span>   # <span class="token number">900</span>s内有<span class="token number">1</span>个键发生了变更；
save <span class="token number">300</span> <span class="token number">10</span>  # <span class="token number">300</span>s内有<span class="token number">10</span>个键发生了变更；
save <span class="token number">60</span> <span class="token number">10000</span> # <span class="token number">60</span>s内有<span class="token number">10000</span>个键发生了变更；

# 以下设置方式为关闭RDB快照功能
save <span class="token string">&quot;&quot;</span>


# 文件名称
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">RDB文件在磁盘上的名称。</span></span>
dbfilename dump<span class="token punctuation">.</span>rdb

# 文件保存路径
# 默认设置为“<span class="token punctuation">.</span><span class="token operator">/</span>”，也就是Redis服务的主目录。
dir <span class="token operator">/</span>home<span class="token operator">/</span>work<span class="token operator">/</span>app<span class="token operator">/</span>redis<span class="token operator">/</span>data<span class="token operator">/</span>

# 如果持久化出错，主进程是否停止写入
# 上文提到的在快照进行过程中，主进程照样可以接受客户端的任何写操作的特性，是指在快照操作正常的情况下。
# 如果快照操作出现异常（例如操作系统用户权限不够、磁盘空间写满等等）时，Redis就会禁止写操作。
# 这个特性的主要目的是使运维人员在第一时间就发现Redis的运行错误，并进行解决。
# 一些特定的场景下，您可能需要对这个特性进行配置，这时就可以调整这个参数项。
# 该参数项默认情况下值为yes，如果要关闭这个特性，指定即使出现快照错误Redis一样允许写操作，则可以将该值更改为no。
stop<span class="token operator">-</span>writes<span class="token operator">-</span>on<span class="token operator">-</span>bgsave<span class="token operator">-</span>error yes

# 是否压缩<span class="token punctuation">,</span>该属性将在字符串类型的数据被快照到磁盘文件时，
# 启用LZF压缩算法。Redis官方的建议是请保持该选项设置为yes，因为“it’s almost always a win”。
rdbcompression yes

# 导入时是否检查
# 从RDB快照功能的version <span class="token number">5</span> 版本开始，一个<span class="token number">64</span>位的CRC冗余校验编码会被放置在RDB文件的末尾，以便对整个RDB文件的完整性进行验证。
# 这个功能大概会多损失<span class="token number">10</span><span class="token operator">%</span>左右的性能，但获得了更高的数据可靠性。所以如果您的Redis服务需要追求极致的性能，
# 就可以将这个选项设置为no。
rdbchecksum yes


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-1-2-触发条件有哪些" tabindex="-1"><a class="header-anchor" href="#_5-1-2-触发条件有哪些" aria-hidden="true">#</a> 5.1.2. 触发条件有哪些？</h4><blockquote><p>触发条件： redis 在什么情况下会进行 RDB 备份。</p></blockquote><p>RDB 持久化方式的触发条件主要分为两种，一种是执行特定命令时触发，另一种是达到配置文件中配置的条件时触发。</p><ul><li>特定的命令： <ul><li><code>save</code> 命令：触发阻塞式持久化方式；即主进程停止读写服务，直到完成持久化过程；</li><li><code>bgsave</code> 命令：触发非阻塞式持久化方式；即主进程先 fork 一个子进程，之后由 fork 出来的子进程完成持久化过程；</li><li><code>shutdown</code> 命令：默认情况下，如果没有开启 AOF 持久化的方式，执行此命令时会触发非阻塞式持久化方式；</li><li><code>debug reload</code> 命令：这个命令会重新加载 redis 的数据，也会触发非阻塞式持久化方式；</li><li><code>flushall</code> 命令：这个命令会清空 RDB 文件；</li></ul></li><li>配置的条件： <ul><li><code>save &lt;seconds&gt; &lt;changes&gt;</code> 参数： 如 <code>save m n</code> 表示 m 秒内有 n 个 key 发生了变化，就会自动触 <code>bgsave</code> 命令发生成RDB文件；</li></ul></li></ul><h4 id="_5-1-3-持久化原理" tabindex="-1"><a class="header-anchor" href="#_5-1-3-持久化原理" aria-hidden="true">#</a> 5.1.3. 持久化原理</h4><p>Redis 的 RDB 的持久化过程主要有两种方式，一种是<strong>阻塞式持久化方式</strong>，一种是<strong>非阻塞式持久化方式</strong>。 <strong>阻塞式持久化方式</strong>，达到触发条件后，主进程会停止对外服务，然后把内存中的数据全部写入 RDB 文件，在 RDB 文件写入完成之前，主进程不处理任何写入命令。 但是阻塞式持久化方式有个<strong>弊端</strong>，那就是： 如果需要内存中保存的数据很多，那么这个持久化方式就会持续很长时间，这对 redis 的性能造成很大影响，所以后续的版本中又实现了非阻塞式的持久化方式。 <strong>非阻塞式持久化方式</strong>，就是在达到触发条件后，主进程会判断是否存在持久化的子进程，如果不存在，就会先 fork 一个持久化子进程，之后，由这个持久化子进程进行持久化过程，而主进程继续响应客户端的命令。在子进程完成持久化之前，如果碰到写命令，主进程会先把对应的 key 复制一份到缓冲区，然后对这个缓冲区的数据进行写命令的执行。</p><p><strong>非阻塞式持久化方式</strong>的备份过程主要分为三个步骤：</p><ol><li><strong>Fork 子进程</strong>： 满足触发条件后，redis 的主进程会 fork 一个复制子进程；如果不存在正在执行的子进程，那么就fork一个新的子进程进行持久化数据，fork过程是阻塞的（这意味着主进程停止对外服务），并且需要备份的数据越多，主进程阻塞的时间越长，fork操作完成后主进程即可执行其他操作；</li><li><strong>生成快照</strong>： 复制子进程将内存中的数据保存到一个临时的 RDB 文件中；</li><li><strong>替换旧文件</strong>：复制子进程完成 RDB 文件的生成后，会使用新的 RDB 文件替换掉旧的 RDB 文件；</li></ol><blockquote><p>PS： fork 子进程的过程是阻塞的，阻塞原因是要复制虚拟页表，因此当需要备份的数据量很大时，fork 子进程的过程就会变的很漫长，这对 redis 整体的吞吐性能有很大影响。</p></blockquote><p>其他问题：</p><ol><li>Q：在非阻塞式持久化方式的备份过程中，如果有新的数据写入，会怎么样？「或者问： 增量数据会如何处理」</li></ol><p>A： Redis 会采用写时复制的方式来保证数据的完整性。假如，在 fork 子进程之前，内存中有 k1v1，fork 子进程之后，客户端需要把 k1v1 变更为： k1v2，那么主进程会在 fork 之后，把 k1v1 复制到一个额外的内存空间上，然后在这个新的内存空间上响应客户端的变更命令，持久化过程完成之后，RDB 文件中保存的是 k1v1，redis 内存中保存的是 k1v2。</p><blockquote><p><strong>写时复制</strong>（<strong>C</strong>opy-<strong>O</strong>n-<strong>W</strong>rite, <strong>COW</strong>）的技术要点就是：主线程在写数据时，会把原来的数据复制一份出来，等到备份完成之后，再把这个数据副本拷贝到新的RDB文件中。</p></blockquote><ol start="2"><li>Q：如果在 RDB 备份期间发生服务崩溃，会出现什么问题？</li></ol><p>A： 数据没有全部写入 RDB 文件，不算备份完成，会丢失上一次备份到崩溃期间的数据变更。崩溃恢复后，以上一次的 RDB 文件进行内存恢复。</p><ol start="3"><li>save 参数的设置要合理，避免出现「上次备份还未完成，下次备份就又开始了」的“恶性循环备份”问题。</li></ol><h4 id="_5-1-4-有什么优缺点" tabindex="-1"><a class="header-anchor" href="#_5-1-4-有什么优缺点" aria-hidden="true">#</a> 5.1.4. 有什么优缺点？</h4><ul><li>优点 <ul><li>相同数据内容的情况下， RDB 文件占用磁盘空间更小；</li><li>进行数据恢复时，RDB 的速度更快；</li></ul></li><li>缺点 <ul><li>RDB 每次备份时，都是备份全量数据，这就意味着： <ul><li>如果数据量过大，fork 子进程的过程会很耗时，这对 redis 的整体性能有很大影响；</li><li>备份频率【即： save <code>&lt;seconds&gt;</code> <code>&lt;changes&gt;</code> 参数】很难取舍，频率过大会出现「上次的备份还未完成，下次的备份就开始了」的“恶性循环”问题；频率过小，当两次备份期间发生宕机事件时，会导致数据丢失过多；</li></ul></li><li>这种持久化方式并不能记录数据的变更过程，比如 key1 的值为 value1，之后变更为 value2、value3、value4 等，最后 RDB 中保存的只是最终的值，其过程中的 value1、value2、value3 都不会被记录下来；</li></ul></li></ul><h3 id="_5-2-aof-持久化方式" tabindex="-1"><a class="header-anchor" href="#_5-2-aof-持久化方式" aria-hidden="true">#</a> 5.2. AOF 持久化方式</h3><p><strong>AOF</strong>（<strong>A</strong>ppend <strong>O</strong>nly <strong>F</strong>ile） 持久化方式，就是把客户端对 redis 的所有变更记录都保存到 AOF 文件中，在进行故障恢复时，只需要对这个 AOF 文件中的每一条记录进行还原执行即可。</p><h4 id="_5-2-1-配置参数有哪些" tabindex="-1"><a class="header-anchor" href="#_5-2-1-配置参数有哪些" aria-hidden="true">#</a> 5.2.1. 配置参数有哪些？</h4><p>配置参数为 redis.conf 文件中的 <code>APPEND ONLY MODE</code> 部分。具体参数有以下几项：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code># 是否开启 AOF，yes 为开启，默认是关闭
appendonly no
 
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">AOF持久化的文件名，默认是appendonly<span class="token punctuation">.</span>aof</span></span>
appendfilename <span class="token string">&quot;appendonly.aof&quot;</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">AOF文件的保存位置和RDB文件的位置相同，都是通过dir参数设置的</span></span>
dir <span class="token punctuation">.</span><span class="token operator">/</span>

# 同步策略
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">appendfsync</span> <span class="token expression">always # 同步写回：每个写命令执行完，立马同步地将日志写回磁盘；</span></span>
appendfsync everysec # 每秒写回：每个写命令执行完，只是先把日志写到 AOF 文件的内存缓冲区，每隔一秒把缓冲区中的内容写入磁盘；
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">appendfsync</span> <span class="token expression">no # 操作系统控制写回：每个写命令执行完，只是先把日志写到 AOF 文件的内存缓冲区，由操作系统决定何时将缓冲区内容写回磁盘。</span></span>
 
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">aof</span><span class="token expression">重写期间是否同步</span></span>
no<span class="token operator">-</span>appendfsync<span class="token operator">-</span>on<span class="token operator">-</span>rewrite no
 
# 重写触发配置
<span class="token keyword">auto</span><span class="token operator">-</span>aof<span class="token operator">-</span>rewrite<span class="token operator">-</span>percentage <span class="token number">100</span> # AOF 文件重写的大小比例，默认值是 <span class="token number">100</span>，表示 <span class="token number">100</span><span class="token operator">%</span>，也就是只有当前 AOF 文件，比最后一次的 AOF 文件大一倍时，才会启动 AOF 文件重写。
<span class="token keyword">auto</span><span class="token operator">-</span>aof<span class="token operator">-</span>rewrite<span class="token operator">-</span>min<span class="token operator">-</span>size <span class="token number">64</span>mb # 允许 AOF 重写的最小文件容量
 
# 加载aof出错如何处理
# 是否开启启动时加载 AOF 文件效验，默认值是 yes，表示尽可能的加载 AOF 文件，忽略错误部分信息，并启动 Redis 服务。
# 如果值为 no，则表示，停止启动 Redis，用户必须手动修复 AOF 文件才能正常启动 Redis 服务。
aof<span class="token operator">-</span>load<span class="token operator">-</span>truncated yes
 
# 文件重写策略
aof<span class="token operator">-</span>rewrite<span class="token operator">-</span>incremental<span class="token operator">-</span>fsync yes

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-2-触发条件有哪些" tabindex="-1"><a class="header-anchor" href="#_5-2-2-触发条件有哪些" aria-hidden="true">#</a> 5.2.2. 触发条件有哪些？</h4><p>AOF 持久化方式的触发条件也有两种，一种是达到配置文件中配置的写回策略和重写限制条件，另一种是执行相关命令。</p><ul><li>配置的触发条件 <ul><li>写回策略： appendfsync 配置项；</li><li>重写限制条件： <ul><li>auto-aof-rewrite-percentage 100</li><li>auto-aof-rewrite-min-size 64mb</li></ul></li></ul></li><li>执行相关命令： <ul><li>bgrewriteaof 命令、bgsave 命令</li></ul></li></ul><h4 id="_5-2-3-持久化原理" tabindex="-1"><a class="header-anchor" href="#_5-2-3-持久化原理" aria-hidden="true">#</a> 5.2.3. 持久化原理</h4><p>Redis 启动后会先判断配置文件中的 appendonly 项是否为 yes，如果为 yes，那么 redis 主进程在响应每一个变更数据的命令时，都会先去变更内存中的数据，之后再在内存中的一块缓冲区中记录变更的命令。我们所说的 AOF 持久化方式，<strong>就是把内存中命令缓冲区的命令写入磁盘文件的过程</strong>。</p><blockquote><p>PS：这种备份方式采用的是写后日志的方式，所谓写后日志就是：先执行命令，然后再记录命令。这样做的好处是：保证每一个记录下来的命令一定是语法正确的命令。</p></blockquote><p>为了深入了解内存中命令缓冲区写回磁盘文件的过程，我们要先了解一下操作系统的 IO 模型。</p><blockquote><p>PS： 操作系统的 IO 模型： 现代计算机，在实现磁盘文件的读写时，都是采用内核态（内核空间）和用户态（用户空间）的概念。 用户空间对数据所有写入操作，都是通过缓冲区来完成的。 如，用户读取磁盘上的某个文件的大概步骤如下：</p><ol><li>用户线程发起读取文件的请求给操作系统；</li><li>操作系统收到读取请求后，调用磁盘驱动读取文件内容，并把文件内容加载到内核态存储空间中；</li><li>加载完成后，操作系统会把内核态存储空间的数据内容拷贝到用户空间，供用户线程使用；</li></ol><p>再如，用户要把某个数据写入到文件的大概步骤如下：</p><ol><li>用户线程发起写入文件命令给到操作系统；</li><li>操作系统接收到写入命令后，会把用户线程对应的用户空间中的数据内容拷贝到内核空间；</li><li>拷贝完成后，操作系统调用磁盘驱动，把内核空间中的数据写入磁盘文件；</li></ol></blockquote><figure><img src="/cs-tips/assets/1719557409903-d55878ef.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><blockquote><p>如 MySQL 中的 Innodb 存储引擎的 IO 模型： <img src="/cs-tips/assets/1699925182407-4562d47a.png" alt="image.png" loading="lazy"></p><p>这样做的好处：</p><ol><li>操作系统会为每一个需要写入磁盘的上层应用都分配一个缓冲区，这样避免了多个上层应用争抢IO资源的发生；【这有点像Java的内存模型JMM】</li><li>缓冲区同步到磁盘的过程交由操作系统，方便统一管理；</li></ol><p>写回的频率可以有两种：</p><ol><li>一种方式是：用户的应用程序把写回的请求交给操作系统就算完成写回操作了，至于何时完成内存与磁盘的对齐过程，则完全交由操作系统负责；在 CentOS 和大多数 Linux 系统中，默认情况下内核每 5 秒钟（500 centiseconds）会检查一次并写回脏数据到磁盘。这个频率由 dirty_writeback_centisecs 参数控制，可以通过查看 /proc/sys/vm/dirty_writeback_centisecs 文件来确定当前设置，并根据需要进行调整。</li><li>另一种方式是：操作系统对齐的过程也暴露出去，相当于提供一个额外的参数，让用户的应用程序来传入这个参数，然后操作系统再根据这个参数的具体含义，来确定何时完成内存和磁盘的对齐；</li></ol></blockquote><p>根据操作系统 IO 模型可知，AOF 的命令缓冲区的数据同步到磁盘文件的频率也应该有至少两种。在 Redis 中，这个频率称为「 <strong>AOF 的写回策略</strong>」，对应于配置文件中的 <strong>appendfsync</strong> 配置项，即这个配置项规定了缓冲区到磁盘文件的同步写回策略，具体值有三个，分别是：</p><ul><li><code>appendfsync always</code>： 这种方式表示「<strong>同步写回</strong>」，意思是：数据变更类的命令执行完，立刻同步到磁盘文件；这种方式可能会产生大量的磁盘 IO，性能较差，但是最可靠，最多只丢失一条数据变更；</li><li><code>appendfsync everysec</code>： 这种方式表示「<strong>每秒写回</strong>」，意思是： 每隔 1s，就把缓冲区的变更命令同步到磁盘文件；这种方式最多丢失 1s 的数据变更；如果允许数据有一点丢失，又希望性能不受太大影响的话，那么就选择 Everysec 策略。</li><li><code>appendfsync no</code>： 这种方式表示「<strong>操作系统控制写回</strong>」，意思是： 把缓冲区到磁盘文件的同步过程交由操作系统自行控制；这种方式性能最高；</li></ul><h4 id="_5-2-4-重写原理" tabindex="-1"><a class="header-anchor" href="#_5-2-4-重写原理" aria-hidden="true">#</a> 5.2.4. 重写原理</h4><p>随着时间的推移， AOF 文件必然会越来越大。这个时候就需要对 AOF 文件进行瘦身，这个瘦身过程就是 AOF 的重写过程。所谓重写过程就是把多个命令合并成能表示终态的一个命令。</p><ol><li>触发条件</li></ol><p>AOF 文件的重写并不是一开始就要重写，而是达到一定触发条件之后才会重写，这个触发条件对应于配置文件中的 <code>**auto-aof-rewrite-min-size**</code> 项和 <code>**auto-aof-rewrite-pencentage**</code> 项，并且<strong>两个命令同时满足</strong>时才会触发重写。</p><ul><li><code>**auto-aof-rewrite-min-size**</code> ：重写的最小文件容量，默认是 64，表示 64MB，即 AOF 文件超过64MB时就触发重写</li><li><code>**auto-aof-rewrite-pencentage**</code> ：重写的大小比例，默认是 100，表示 100% ，即 AOF 文件大小超过了上次重写后文件的 100% （即一倍），就会触发重写</li><li>执行了 bgrewriteaof 命令也会触发</li></ul><ol start="2"><li>具体过程</li></ol><p>达到触发条件后，redis 主线程会 fork 一个 bgrewriteaof 子进程，然后 bgrewriteaof 子进程先生成一个新的文件，把当前 redis 中所有的数据使用最少命令方式保存到新文件中，当所有数据保存完成后， bgrewriteaof 子进程会替换旧的 aof 文件，并把最新的持久化命令追加到 aof 文件中。</p><p>其他问题</p><ol><li>Q： 如果在重写过程中涉及到数据的修改，会怎么样？</li></ol><p>A： 由于重写过程是通过主进程fork一个bgrewriteaof子进程，并由bgrewriteaof子进程来完成重写过程的，因此碰到数据修改时，redis会同时在主进程和bgrewriteaof子进程的缓冲区中写入数据变更，bgrewriteaof子进程完成原有数据的重写过程后，最后把数据变更追加到新的aof文件中。</p><ol start="2"><li>Q： 在重写日志整个过程时，主线程有哪些地方会被阻塞？</li></ol><p>A：</p><ol><li>fork子进程时，需要拷贝虚拟页表，会对主线程阻塞。</li><li>主进程有bigkey写入时，操作系统会创建页面的副本，并拷贝原有的数据，会对主线程阻塞。</li><li>子进程重写日志完成后，主进程追加aof重写缓冲区时可能会对主线程阻塞。</li><li>为什么AOF重写不复用原AOF日志？两方面原因：</li><li>父子进程写同一个文件会产生竞争问题，影响父进程的性能。</li><li>如果AOF重写过程中失败了，相当于污染了原本的AOF文件，无法做恢复数据使用</li></ol><h4 id="_5-2-5-恢复" tabindex="-1"><a class="header-anchor" href="#_5-2-5-恢复" aria-hidden="true">#</a> 5.2.5. 恢复</h4><p>如果开启了AOF备份功能，那么redis启动日志中会发现：</p><p>DB loaded from append only file......</p><p>过程就是读取AOF文件，然后依次执行读到的命令。</p><ul><li>异常文件处理 <ul><li>问题： <ul><li>如果服务器发生崩溃或者AOF存储已满时，AOF最后一条命令可能会被截断，造成aof文件异常；</li><li>也有可能aof文件中间的几条命令被中断，发生异常；</li></ul></li><li>解决方案 <ul><li>如果配置了 <code>aof-load-truncated yes</code> 参数，则会自动忽略最后一条命令后启动</li><li>使用 <code>redis-check-aof</code> 命令，定位到出现问题的命令后手动修复aof文件</li><li>使用 <code>redis-check-aof --fix</code> 命令，让redis自动修复aof文件</li></ul></li></ul></li></ul><h4 id="_5-2-6-有什么优缺点" tabindex="-1"><a class="header-anchor" href="#_5-2-6-有什么优缺点" aria-hidden="true">#</a> 5.2.6. 有什么优缺点</h4><ul><li>优点 <ul><li>AOF 文件的可读性更高一些，并且重写之前记录了 key 的变化过程；</li><li>默认的 AOF 持久化策略最多丢失 1s 的数据，保存的数据相对更加完成一些；</li></ul></li><li>缺点 <ul><li>相同数据下，AOF 文件要比 RDB 文件大一些；</li><li>相同负载下，AOF 方式的性能要比 RDB 稍差；</li></ul></li></ul><h3 id="_5-3-混合持久化方式" tabindex="-1"><a class="header-anchor" href="#_5-3-混合持久化方式" aria-hidden="true">#</a> 5.3. 混合持久化方式</h3><p>总结 RDB 和 AOF 两种持久化方式，发现二者各有千秋：RDB 具有快速恢复的特性，而 AOF 可以记录操作命令。于是，Redis 4.0 以后提供了「混合式持久化」方式。这种方式可以综合两种持久化方式的优缺点，颇有些“鱼和熊掌兼得”的意味。</p><ol><li>具体的原理是： 内存快照以一定的频率执行，在两次快照之间，使用 AOF 日志记录这期间的所有命令操作；</li><li>持久化文件保存的方式是：以 RDB 文件作为 AOF 文件的摘要，记录在 AOF 文件的开头。存到磁盘上的文件的后缀名为 .aof ；</li><li>配置参数为： <code>**aof-use-rdb-preamble yes|no**</code>，默认是 yes；</li><li>触发条件为： 执行 bgrewriteaof 命令，即：重写时，先把数据以RDB的方式写到AOF的开头，之后的数据以命令的形式，再追加到AOF的末尾；</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>
 ● 配置参数 
  ○ aof-use-rdb-preamble yes|no
# When rewriting the AOF file, Redis is able to use an RDB preamble in the
# AOF file for faster rewrites and recoveries. When this option is turned
# on the rewritten AOF file is composed of two different stanzas:
#
#   [RDB file][AOF tail]
#
# When loading Redis recognizes that the AOF file starts with the &quot;REDIS&quot;
# string and loads the prefixed RDB file, and continues loading the AOF
# tail.
aof-use-rdb-preamble yes

preamble 
美: [priˈæmb(ə)l] ， 英: [pri&#39;æmb(ə)l]
n.  序言；前言；绪论；导言
v.  作序言[绪论]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-持久化方式的最佳实践" tabindex="-1"><a class="header-anchor" href="#_5-4-持久化方式的最佳实践" aria-hidden="true">#</a> 5.4. 持久化方式的最佳实践</h3><p>Redis 提供了三种持久化方式，在生产实践中具体使用哪一种持久化方式，要根据我们具体的业务需求来确定。下面有一些个人经验：</p><ol><li><strong>关注业务需求</strong>：根据业务需求来判断是否需要配置持久化。有一些业务数据只是从数据库中读取到 Redis，目的是利用 Redis 的性能高于数据库的特点，可能并不需要对 Redis 执行写操作，如一些不变的数据字典数据等，此时就可以不用配置持久化机制；</li><li><strong>关注 fork 子进程的性能损耗</strong>：合理分配内存资源，控制Redis最大使用内存，防止fork耗时过长，也要避免因为物理内存不足导致 fork 失败；降低fork的频率，比如可以手动来触发RDB生成快照与AOF重写；</li><li><strong>关注运行模式</strong>：单机如果部署多个实例，要防止多个机器同时运行持久化、重写操作，防止出现内存、CPU、IO资源竞争，让持久化变为串行；</li><li>甚至可以配置自定义的持久化机制；</li></ol><h1 id="本地缓存与分布式缓存示例" tabindex="-1"><a class="header-anchor" href="#本地缓存与分布式缓存示例" aria-hidden="true">#</a> 本地缓存与分布式缓存示例</h1><h2 id="本地缓存" tabindex="-1"><a class="header-anchor" href="#本地缓存" aria-hidden="true">#</a> 本地缓存</h2><h3 id="spring-boot-本地缓存示例" tabindex="-1"><a class="header-anchor" href="#spring-boot-本地缓存示例" aria-hidden="true">#</a> Spring Boot 本地缓存示例</h3><p>使用 Spring Boot 和 <code>@Cacheable</code> 注解来实现本地缓存，可以使用如 <code>ConcurrentHashMap</code> 作为本地缓存存储。</p><h4 id="依赖配置" tabindex="-1"><a class="header-anchor" href="#依赖配置" aria-hidden="true">#</a> 依赖配置</h4><p>确保在 <code>pom.xml</code> 中引入 Spring 缓存依赖：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="配置类" tabindex="-1"><a class="header-anchor" href="#配置类" aria-hidden="true">#</a> 配置类</h4><p>启用缓存功能：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableCaching</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheConfig</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="服务类" tabindex="-1"><a class="header-anchor" href="#服务类" aria-hidden="true">#</a> 服务类</h4><p>示例服务类使用 <code>@Cacheable</code> 注解来缓存方法的返回值：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Cacheable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalCacheService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span><span class="token string">&quot;localCache&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 模拟耗时操作</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Data for key: &quot;</span> <span class="token operator">+</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="主应用类" tabindex="-1"><a class="header-anchor" href="#主应用类" aria-hidden="true">#</a> 主应用类</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalCacheApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">LocalCacheApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="springboot-guaua" tabindex="-1"><a class="header-anchor" href="#springboot-guaua" aria-hidden="true">#</a> SpringBoot+Guaua</h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> todo</label></li></ul><h3 id="springboot-ehcache" tabindex="-1"><a class="header-anchor" href="#springboot-ehcache" aria-hidden="true">#</a> SpringBoot+Ehcache</h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> todo</label></li></ul><h2 id="分布式缓存" tabindex="-1"><a class="header-anchor" href="#分布式缓存" aria-hidden="true">#</a> 分布式缓存</h2><h3 id="spring-boot-分布式缓存示例" tabindex="-1"><a class="header-anchor" href="#spring-boot-分布式缓存示例" aria-hidden="true">#</a> Spring Boot 分布式缓存示例</h3><p>使用 Spring Boot 和 Redis 实现分布式缓存。</p><h4 id="依赖配置-1" tabindex="-1"><a class="header-anchor" href="#依赖配置-1" aria-hidden="true">#</a> 依赖配置</h4><p>确保在 <code>pom.xml</code> 中引入 Spring Data Redis 和 Lettuce 依赖：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.lettuce.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lettuce-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="配置类-1" tabindex="-1"><a class="header-anchor" href="#配置类-1" aria-hidden="true">#</a> 配置类</h4><p>配置 Redis 连接：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableCaching</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">RedisConnectionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">GenericJackson2JsonRedisSerializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="服务类-1" tabindex="-1"><a class="header-anchor" href="#服务类-1" aria-hidden="true">#</a> 服务类</h4><p>示例服务类使用 <code>@Cacheable</code> 注解来缓存方法的返回值：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Cacheable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DistributedCacheService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span><span class="token string">&quot;distributedCache&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 模拟耗时操作</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Data for key: &quot;</span> <span class="token operator">+</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件" aria-hidden="true">#</a> 配置文件</h4><p>在 <code>application.properties</code> 中配置 Redis 连接信息：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token value attr-value">localhost</span>
<span class="token key attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="主应用类-1" tabindex="-1"><a class="header-anchor" href="#主应用类-1" aria-hidden="true">#</a> 主应用类</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DistributedCacheApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">DistributedCacheApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>通过上述示例，可以看到本地缓存和分布式缓存的实现有明显的区别。使用本地缓存时，数据存储在应用程序的内存中，而分布式缓存则依赖外部缓存服务器如 Redis。在实际应用中，选择哪种缓存方式取决于具体的应用需求和系统架构。</p><h2 id="_6-运行模式" tabindex="-1"><a class="header-anchor" href="#_6-运行模式" aria-hidden="true">#</a> 6. 运行模式</h2><h1 id="运行模式" tabindex="-1"><a class="header-anchor" href="#运行模式" aria-hidden="true">#</a> 运行模式</h1><h2 id="单机模式" tabindex="-1"><a class="header-anchor" href="#单机模式" aria-hidden="true">#</a> 单机模式</h2><h2 id="主从模式" tabindex="-1"><a class="header-anchor" href="#主从模式" aria-hidden="true">#</a> 主从模式</h2><p>三主三从。</p><ol><li>分别在三台主机上安装三个单机版 redis。</li><li></li></ol><h2 id="哨兵模式" tabindex="-1"><a class="header-anchor" href="#哨兵模式" aria-hidden="true">#</a> 哨兵模式</h2><ol><li>安装过程</li><li>哨兵节点异常示例</li></ol><h2 id="集群模式" tabindex="-1"><a class="header-anchor" href="#集群模式" aria-hidden="true">#</a> 集群模式</h2><ol><li>安装过程</li><li>增加节点</li><li>减少节点</li><li>客户端使用 redis 集群示例</li><li>故障转移示例</li></ol><h4 id="安装过程" tabindex="-1"><a class="header-anchor" href="#安装过程" aria-hidden="true">#</a> 安装过程</h4><ol><li>部署模型：3主3从</li><li>资源分配：安装到同一台主机上，端口分别为： 主（30001-30003），从（30004-30006）</li><li>安装过程</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>#配置端口
port ${port}
#以守护进程模式启动
daemonize yes
#pid的存放文件
pidfile /var/run/redis_${port}.pid
#日志文件名
logfile &quot;redis_${port}.log&quot;
#存放备份文件以及日志等文件的目录
dir &quot;/opt/redis/data&quot;  
#rdb备份文件名
dbfilename &quot;dump_${port}.rdb&quot;
#开启集群功能
cluster-enabled yes
#集群配置文件，节点自动维护
cluster-config-file nodes-${port}.conf
#集群能够运行不需要集群中所有节点都是成功的
cluster-require-full-coverage no

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动六个节点：配置完成后，通过 <strong>./redis-server redis.conf</strong> 命令依次启动这六个节点。</li><li>创建集群：输入命令 ./redis-cli --cluster create 127.0.0.1:30001 127.0.0.1:30002 127.0.0.1:30003 127.0.0.1:30004 127.0.0.1:30005 127.0.0.1:30006 --cluster-replicas 1</li></ul><p>①、${password} 表示连接Redis的密码，通常整个集群我们要么不设置密码，要么设置成一样的。 　　②、后面的六个ip:port，按照顺序，前面三个是主节点，后面三个是从节点，顺序不能错。 　　③、最后数字 1 表示一个主节点只有一个从节点。和前面的配置相对应。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">127.0</span>.0.1:30005 to <span class="token number">127.0</span>.0.1:30001
Adding replica <span class="token number">127.0</span>.0.1:30006 to <span class="token number">127.0</span>.0.1:30002
Adding replica <span class="token number">127.0</span>.0.1:30004 to <span class="token number">127.0</span>.0.1:30003
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Trying to optimize slaves allocation <span class="token keyword">for</span> anti-affinity
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Some slaves are <span class="token keyword">in</span> the same <span class="token function">host</span> as their master
M: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
M: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
M: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30004
   replicates bdd1c913f87eacbdfeabc71befd0d06c913c891c
S: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30005
   replicates bdd1c913f87eacbdfeabc71befd0d06c913c891c
S: bdd1c913f87eacbdfeabc71befd0d06c913c891c <span class="token number">127.0</span>.0.1:30006
   replicates bdd1c913f87eacbdfeabc71befd0d06c913c891c
Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">&#39;yes&#39;</span> to accept<span class="token punctuation">)</span>:  <span class="token function">yes</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each <span class="token function">node</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">127.0</span>.0.1:30001<span class="token punctuation">)</span>
M: 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 887397e6fefe8ad19ea7569e99f5eb8a803e3785
S: 1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates f5958382af41d4e1f5b0217c1413fe19f390b55f
S: dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 3da35c40c43b457a113b539259f17e7ed616d13d
M: 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.




</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="查看集群及节点信息" tabindex="-1"><a class="header-anchor" href="#查看集群及节点信息" aria-hidden="true">#</a> 查看集群及节点信息</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ ./redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-p</span> <span class="token number">30001</span> <span class="token comment"># 连接到集群</span>

// 查看集群信息
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster info <span class="token comment"># 查看集群信息</span>
cluster_state:ok <span class="token comment"># 状态正常</span>
cluster_slots_assigned:16384 <span class="token comment"># 槽位数</span>
cluster_slots_ok:16384 <span class="token comment"># 正常的槽位数</span>
cluster_slots_pfail:0 
cluster_slots_fail:0
cluster_known_nodes:6 <span class="token comment"># 集群的节点数</span>
cluster_size:3 <span class="token comment"># 集群主节点数</span>
cluster_current_epoch:6
cluster_my_epoch:1
cluster_stats_messages_ping_sent:130
cluster_stats_messages_pong_sent:127
cluster_stats_messages_sent:257
cluster_stats_messages_ping_received:122
cluster_stats_messages_pong_received:130
cluster_stats_messages_meet_received:5
cluster_stats_messages_received:257

// 查看节点信息
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster nodes
dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006@40006 slave 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">0</span> <span class="token number">1585143789940</span> <span class="token number">6</span> connected
f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003@40003 master - <span class="token number">0</span> <span class="token number">1585143791000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002@40002 master - <span class="token number">0</span> <span class="token number">1585143789000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005@40005 slave 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">0</span> <span class="token number">1585143789000</span> <span class="token number">5</span> connected
887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001@40001 myself,master - <span class="token number">0</span> <span class="token number">1585143786000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004@40004 slave f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">0</span> <span class="token number">1585143791945</span> <span class="token number">4</span> connected



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="部署视图" tabindex="-1"><a class="header-anchor" href="#部署视图" aria-hidden="true">#</a> 部署视图</h4><p>根据上面的安装过程，可以获知<strong>主从节点的对应关系</strong>以及<strong>数据槽的分配情况</strong>：</p><p>| <strong>主节点</strong> | 127.0.0.1:30001 节点ID： <strong>887397e6fefe8ad19ea7569e99f5eb8a803e3785</strong> | 127.0.0.1:30002 节点ID： <strong>3da35c40c43b457a113b539259f17e7ed616d13d</strong> | 127.0.0.1:30003 节点ID： <strong>f5958382af41d4e1f5b0217c1413fe19f390b55f</strong> | | --- | --- | --- | --- | | <strong>数据槽分配情况</strong> | slots:[<strong>0-5460</strong>] (5461 slots) | slots:[<strong>5461-10922</strong>] (5462 slots) | slots:[<strong>10923-16383</strong>] (5461 slots) | | <strong>从节点</strong> | 127.0.0.1:30005 节点ID： <strong>abec9f98f9c01208ba77346959bc35e8e274b6a3</strong> | 127.0.0.1:30006 节点ID： <strong>dc0702625743c48c75ea935c87813c4060547cef</strong> | 127.0.0.1:30004 节点ID： <strong>1a324d828430f61be6eaca7eb2a90728dd5049de</strong> |</p><p>对应的部署视图如下：</p><figure><img src="/cs-tips/assets/1726162366235-25569d04.png" alt="1726162366235" tabindex="0" loading="lazy"><figcaption>1726162366235</figcaption></figure><h4 id="增加节点" tabindex="-1"><a class="header-anchor" href="#增加节点" aria-hidden="true">#</a> 增加节点</h4><p>把某一节点加入集群有两种方式： cluster meet 和 add-node。</p><ol><li>方式一： 在某一节点上执行 cluster meet {ip}:{port} 命令，如把30007加入集群：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster meet <span class="token number">127.0</span>.0.1 <span class="token number">30007</span>
OK
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster nodes
dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006@40006 slave 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">0</span> <span class="token number">1585142916000</span> <span class="token number">6</span> connected
df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">127.0</span>.0.1:30007@40007 master - <span class="token number">0</span> <span class="token number">1585142917740</span> <span class="token number">0</span> connected
f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003@40003 master - <span class="token number">0</span> <span class="token number">1585142916738</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002@40002 master - <span class="token number">0</span> <span class="token number">1585142913000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005@40005 slave 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">0</span> <span class="token number">1585142917000</span> <span class="token number">5</span> connected
887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001@40001 myself,master - <span class="token number">0</span> <span class="token number">1585142915000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004@40004 slave f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">0</span> <span class="token number">1585142916000</span> <span class="token number">4</span> connected


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出已经把30007设置成了master。</p><ol start="2"><li>方式二：用 redis-cli --cluster add-node 添加节点{ip}:{port} 集群某节点{ip}:{port} 也可以把一个节点添加到集群中。如把30008加入集群：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ redis-cli <span class="token parameter variable">--cluster</span> add-node <span class="token number">127.0</span>.0.1:30008 <span class="token number">127.0</span>.0.1:30001
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Adding <span class="token function">node</span> <span class="token number">127.0</span>.0.1:30008 to cluster <span class="token number">127.0</span>.0.1:30001
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">127.0</span>.0.1:30001<span class="token punctuation">)</span>
M: 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 3da35c40c43b457a113b539259f17e7ed616d13d
M: df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">127.0</span>.0.1:30007
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> master
M: f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 1d09d26fd755298709efe60278457eaa09cefc26 <span class="token number">127.0</span>.0.1:30008
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> master
M: 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 887397e6fefe8ad19ea7569e99f5eb8a803e3785
S: 1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates f5958382af41d4e1f5b0217c1413fe19f390b55f
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
<span class="token punctuation">[</span>ERR<span class="token punctuation">]</span> Node <span class="token number">127.0</span>.0.1:30008 is not empty. Either the <span class="token function">node</span> already knows other nodes <span class="token punctuation">(</span>check with CLUSTER NODES<span class="token punctuation">)</span> or contains some key <span class="token keyword">in</span> database <span class="token number">0</span>.

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出把30008也设置成了master。</p><h4 id="变更节点角色" tabindex="-1"><a class="header-anchor" href="#变更节点角色" aria-hidden="true">#</a> 变更节点角色</h4><p>用 cluster replicate {nodeId} 命令可以把某个主节点变更为另外一个主节点的从节点，例如在30008上执行 cluster replicate {nodeId}命令就可以把30008设置成30007的从节点。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> cluster replicate df0190853a53d8e078205d0e2fa56046f20362a7
OK
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> cluster nodes
df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">127.0</span>.0.1:30007@40007 master - <span class="token number">0</span> <span class="token number">1585147827000</span> <span class="token number">0</span> connected
abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005@40005 slave 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">0</span> <span class="token number">1585147827000</span> <span class="token number">1</span> connected
1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004@40004 slave f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">0</span> <span class="token number">1585147823000</span> <span class="token number">3</span> connected
887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001@40001 master - <span class="token number">0</span> <span class="token number">1585147826000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006@40006 slave 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">0</span> <span class="token number">1585147826930</span> <span class="token number">2</span> connected
f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003@40003 master - <span class="token number">0</span> <span class="token number">1585147826000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
1d09d26fd755298709efe60278457eaa09cefc26 <span class="token number">127.0</span>.0.1:30008@40008 myself,slave df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">0</span> <span class="token number">1585147823000</span> <span class="token number">7</span> connected
3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002@40002 master - <span class="token number">0</span> <span class="token number">1585147827933</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="增加新节点后rehash" tabindex="-1"><a class="header-anchor" href="#增加新节点后rehash" aria-hidden="true">#</a> 增加新节点后rehash</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ redis-cli <span class="token parameter variable">--cluster</span> reshard <span class="token number">127.0</span>.0.1:30007
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">127.0</span>.0.1:30007<span class="token punctuation">)</span>
M: df0190853a53d8e078205d0e2fa56046f20362a7 <span class="token number">127.0</span>.0.1:30007
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-1332<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">5461</span>-6794<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">10923</span>-12255<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4000</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: dc0702625743c48c75ea935c87813c4060547cef <span class="token number">127.0</span>.0.1:30006
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 3da35c40c43b457a113b539259f17e7ed616d13d
M: 3da35c40c43b457a113b539259f17e7ed616d13d <span class="token number">127.0</span>.0.1:30002
   slots:<span class="token punctuation">[</span><span class="token number">6795</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4128</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 1a324d828430f61be6eaca7eb2a90728dd5049de <span class="token number">127.0</span>.0.1:30004
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates f5958382af41d4e1f5b0217c1413fe19f390b55f
S: 1d09d26fd755298709efe60278457eaa09cefc26 <span class="token number">127.0</span>.0.1:30008
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates df0190853a53d8e078205d0e2fa56046f20362a7
S: abec9f98f9c01208ba77346959bc35e8e274b6a3 <span class="token number">127.0</span>.0.1:30005
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 887397e6fefe8ad19ea7569e99f5eb8a803e3785
M: f5958382af41d4e1f5b0217c1413fe19f390b55f <span class="token number">127.0</span>.0.1:30003
   slots:<span class="token punctuation">[</span><span class="token number">12256</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4128</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 887397e6fefe8ad19ea7569e99f5eb8a803e3785 <span class="token number">127.0</span>.0.1:30001
   slots:<span class="token punctuation">[</span><span class="token number">1333</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4128</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
How many slots <span class="token keyword">do</span> you want to move <span class="token punctuation">(</span>from <span class="token number">1</span> to <span class="token number">16384</span><span class="token punctuation">)</span>? <span class="token number">4000</span>		<span class="token comment">### 这里输入要从原有的节点中迁移多少槽给30007</span>
What is the receiving <span class="token function">node</span> ID? df0190853a53d8e078205d0e2fa56046f20362a7  <span class="token comment">### 这里输入 30007 的 nodeid</span>
Please enter all the <span class="token builtin class-name">source</span> <span class="token function">node</span> IDs.
  Type <span class="token string">&#39;all&#39;</span> to use all the nodes as <span class="token builtin class-name">source</span> nodes <span class="token keyword">for</span> the <span class="token builtin class-name">hash</span> slots.
  Type <span class="token string">&#39;done&#39;</span> once you entered all the <span class="token builtin class-name">source</span> nodes IDs.
Source <span class="token function">node</span> <span class="token comment">#1: all  ### 这里输入 all， 表示从 30001、 30002、 30003 节点随机抽取</span>
 
<span class="token comment"># ......忽略其他</span>
Moving slot <span class="token number">2656</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2657</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2658</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2659</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2660</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2661</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2662</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2663</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2664</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Moving slot <span class="token number">2665</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
Do you want to proceed with the proposed reshard plan <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>


$ redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-p</span> <span class="token number">30001</span>
<span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster slots <span class="token comment"># 查看集群槽位信息</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1332</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30007</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;df0190853a53d8e078205d0e2fa56046f20362a7&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30008</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;1d09d26fd755298709efe60278457eaa09cefc26&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5461</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6794</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30007</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;df0190853a53d8e078205d0e2fa56046f20362a7&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30008</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;1d09d26fd755298709efe60278457eaa09cefc26&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">10923</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">12255</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30007</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;df0190853a53d8e078205d0e2fa56046f20362a7&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30008</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;1d09d26fd755298709efe60278457eaa09cefc26&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">12256</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">16383</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30003</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;f5958382af41d4e1f5b0217c1413fe19f390b55f&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30004</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;1a324d828430f61be6eaca7eb2a90728dd5049de&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6795</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">10922</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30002</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;3da35c40c43b457a113b539259f17e7ed616d13d&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30006</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;dc0702625743c48c75ea935c87813c4060547cef&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1333</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5460</span>
   <span class="token number">3</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30001</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;887397e6fefe8ad19ea7569e99f5eb8a803e3785&quot;</span>
   <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;127.0.0.1&quot;</span>
      <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">30005</span>
      <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;abec9f98f9c01208ba77346959bc35e8e274b6a3&quot;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>迁移完成之后发现： 30001、 30002、 30003 各迁移了一部分槽给 30007 。 部署视图变成：</p><figure><img src="/cs-tips/assets/1726162400771-6871a505.png" alt="1726162400771" tabindex="0" loading="lazy"><figcaption>1726162400771</figcaption></figure><h4 id="移除某节点" tabindex="-1"><a class="header-anchor" href="#移除某节点" aria-hidden="true">#</a> 移除某节点</h4><p>使用 cluster forget {nodeId} 命令就可以把一个节点从集群中移除。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:3000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster forget df0190853a53d8e078205d0e2fa56046f20362a7
OK

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><a href="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Redis%20%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e6%88%98/39%20%e5%ae%9e%e6%88%98%ef%bc%9aRedis%20%e9%9b%86%e7%be%a4%e6%a8%a1%e5%bc%8f%ef%bc%88%e4%b8%8a%ef%bc%89.md" target="_blank" rel="noopener noreferrer">39 实战：Redis 集群模式（上）<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h3 id="_6-1-单机模式" tabindex="-1"><a class="header-anchor" href="#_6-1-单机模式" aria-hidden="true">#</a> 6.1. 单机模式</h3><h4 id="_6-1-1-安装过程" tabindex="-1"><a class="header-anchor" href="#_6-1-1-安装过程" aria-hidden="true">#</a> 6.1.1. 安装过程</h4><ol><li>安装 gcc 编译工具等；</li><li>下载源代码；</li><li>make &amp; make install</li><li>redis-server redis.conf</li></ol><p>事件机制 IO 模型</p><h3 id="_6-2-主从模式" tabindex="-1"><a class="header-anchor" href="#_6-2-主从模式" aria-hidden="true">#</a> 6.2. 主从模式</h3><h4 id="_6-2-1-安装" tabindex="-1"><a class="header-anchor" href="#_6-2-1-安装" aria-hidden="true">#</a> 6.2.1. 安装</h4><ul><li>部署视图</li></ul><figure><img src="/cs-tips/assets/1719395107653-d87313a1.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ol><li>主从结构下，一般也是读写分离的模式，即主节点负责数据的写入和读取，从节点负责数据的读取；当然也可以让从节点也支持写入操作，可以在配置文件中进行设置 <code>slave-read-only yes|no</code>；</li><li>部署模型大概有两种**： 星状拓扑<strong>和</strong>树状拓扑**。即所有的从节点都从一个主节点上复制数据，和只有部分从节点从主节点复制数据，其余从节点再从已经同步完成的从节点复制数据。树状拓扑解决了主节点的复制压力，因为所有从节点从主节点复制时，都会把RDB文件赋值给从节点，从节点一多，主节点的压力可想而知。</li><li>主从结构下的数据复制分为两种**： 全量复制<strong>和</strong>增量复制** 当第一次复制时，采用是全量复制的方式； 之后采用的是增量复制的方式； 为了解决生成RDB文件时耗时过多，redis还提供了无盘复制的方式，即不生成RDB文件，在内存缓冲区就把数据通过socket发送给从节点了，从配置文件中得知，这种方式目前还处于实验阶段，可以通过repl-diskless-sync 设置成yes或no的方式配置，但是默认值是 no，即不开启<strong>无盘赋值</strong>方式；</li></ol><p>全量复制的过程：</p><ol><li>从节点执行psync命令发送给主节点；</li><li>主节点把主节点的实例id和复制进度标识响应给从节点，之后主节点开始执行bgsave命令，生成RDB文件；</li><li>主节点把生成好的RDB文件发送给从节点；</li><li>从节点接收到RDB文件之后，进行数据恢复； 【注意：从节点加载 RDB 文件期间是不能对外提供服务的】</li></ol><p>使用RDB而不是AOF的原因： RDB比AOF恢复起来快。</p><p>增量复制的出现是因为两点：</p><ol><li>主节点生成RDB文件以及传输RDB文件的过程中，并不会停止对外服务，也就是说主节点还有可能会有数据写入；这部分新写入的数据就是增量数据；</li><li>从节点完成首次全量同步后，可能会出现网络问题，导致主从失去联系，在从节点失联阶段，主节点也有可能会有数据写入；这部分新写入的数据也是增量数据；</li></ol><p>解决增量数据的同步问题： 主节点在执行bgsave命令生成RDB文件时，也会在内存中生成一个缓冲区，这个缓冲区就记录之后的新的写命令；事实上这个缓冲区是一个环形缓冲区，上面除了保存新的写入命令外，还保存着主从节点的复制标识位；这样两个复制标识位中间的写命令就是需要增量同步的内容。这个缓冲区的大小可以通过repl-backlog-size进行设置，默认是1MB。 但这种环形命令缓冲区还是有问题，如，主节点的复制标识位追上从节点的复制标识位了，那就需要增加这个环形缓冲区的大小；但是加多少依然是个问题，只能通过集群来解决。</p><p>主从复制下的问题：</p><ol><li><strong>主从数据不一致问题不可避免</strong>。虽然可以通过优化网络、升级硬件资源等手段改进，但依旧不可避免。主从不一致严重时，可以通过让从节点拒绝服务，配置参数为： slave-serve-stale-data yes|no ;</li><li><strong>键的过期问题</strong>。3.2之前客户端很容易从从节点读到过期的数据，3.2之后在读数据时，从节点会先判断过期时间，解决了这个问题；</li><li><strong>主从切换问题</strong>。并没有解决主从角色切换问题，只能通过客户端手动切换。</li></ol><p>最佳实践：</p><ol><li>优化从节点的角色，比如减少慢查询、不进行持久化等；再比如，把一部分从节点设置为只对外提供读写能力，一部分从节点只提供备份功能等；</li><li>使用哨兵模式配合主从模式，提高整体可用性，减少对应用的侵入；</li></ol><p>在主从复制期间，从节点与主节点突然断开连接，会出现什么情况？【主从不一致，增量数据通过环形缓冲区记录下来，等到从节点再次重连后，主节点会把环形缓冲区的写命令重新发送给从节点】 当主节点挂掉后会出现什么情况？【停止对外服务】</p><h3 id="_6-3-哨兵模式" tabindex="-1"><a class="header-anchor" href="#_6-3-哨兵模式" aria-hidden="true">#</a> 6.3. 哨兵模式</h3><figure><img src="/cs-tips/assets/1719395007430-6ed1f629.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>主要目的： 解决主从架构的遗留问题，主要还是用来搞定高可用的需求。 主从架构中没有解决节点异常后无法对外提供服务的问题。</p><p>具体一点有以下几个功能点：</p><ol><li>监控：监控所配置的主从集群中的节点健康状况；</li><li>故障转移：当主从节点出现异常时会自动化切换主从点的角色，以保证整个集群的正常运行；</li><li>配置：简单主从架构在使用时，要在客户端配置所有的节点信息，用了哨兵模式之后，只需要配置哨兵的连接信息即可；</li><li>通知： 主从节点出现异常时，哨兵负责把异常信息和故障转移后的新信息传给通知到客户端。</li></ol><p>哨兵组网</p><p>sentinel monitor <code>&lt;master-name&gt;</code> <code>&lt;ip&gt;</code> <code>&lt;redis-port&gt;</code> <code>&lt;quorum&gt;</code> 在哨兵的安装的过程中，每个节点中的配置文件中都有一项：sentinel monitor mymaster 192.168.14.101 6379 2 这一配置项表明每个哨兵都启动时都要先与主节点进行通信。</p><p>事实上，主从结构部署完成之后，主节点会会初始化一个 <strong>sentinel</strong>:hello 的频道，当哨兵接入主从架构后，哨兵会把自身的连接信息发布到这个频道上，并从这个频道上读取其它的哨兵信息。</p><p>总结： 哨兵集群是通过主节点上，名为 <strong>sentinel</strong>:hello 的频道的发布订阅机制完成各个哨兵节点的信息交互的。</p><p>主要作用是配合主从架构使用，主要用来保证高可用性，但是还包括其它特性，比如监控、故障转移、配置中心、消息通知等。</p><p>在主从模式中，并没有解决主节点异常而导致的无法对外提供服务时，主从节点切换问题。 主要用来无人值守运维，保证高可用，主要用于主从切换，提高可用性。</p><ul><li><p>其它特性？【监控、故障转移、配置中心、消息通知】</p></li><li><p>部署模型（3+3）</p></li><li><p>原理</p><ul><li>哨兵组网</li><li>监控主库下线【客观下线、主观下线】</li><li>故障转移（选出主库）【选出兵王、选出主库、通知客户端、主库再次上线】</li></ul></li><li><p>最佳实践</p></li></ul><ol><li>哨兵模式的部署视图大概是怎样的？</li><li>哨兵模式有什么作用？</li><li>当节点出现异常时，会出现什么情况？ <ol><li>要分节点角色到底是哨兵节点还是数据节点？</li></ol></li></ol><p>问题是哨兵也可以监控多个主数据节点，这也是数据节点的集群啊？为什么还需要cluster这种集群解决方案呢？ cluster有分片/槽算法，把请求尽量平均的负载均衡到各个机器。</p><h3 id="_6-4-集群模式" tabindex="-1"><a class="header-anchor" href="#_6-4-集群模式" aria-hidden="true">#</a> 6.4. 集群模式</h3><p>三种运行模式的对比</p><ul><li>主从模式主要解决单机模式下无法实现读写分离的问题；</li><li>哨兵模式主要解决主从模式下无法实现故障快速恢复的问题，也可以理解为哨兵模式主要解决了主从模式下的高可用问题；</li><li>集群模式主要解决了哨兵模式下无法实现负载均衡的问题，有些说法是集群模式解决了哨兵模式的高可扩的问题，事实上这种说法是不严谨的，因为哨兵模式事实上也是可以完成高可扩的，只需要配置多个 <code>sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</code>即可。哨兵模式的问题在于它监控的每一个主从集群的数据分布不均匀，并且还依赖于使用这种运行模式的 smartClient，而集群模式则解决了哨兵模式下的这两个问题。</li></ul><h2 id="_7-生产运维" tabindex="-1"><a class="header-anchor" href="#_7-生产运维" aria-hidden="true">#</a> 7. 生产运维</h2><h1 id="基准测试示例" tabindex="-1"><a class="header-anchor" href="#基准测试示例" aria-hidden="true">#</a> 基准测试示例</h1><p>好的，这里是一个简单的 Redis 基准测试案例，可以帮助你评估 Redis 在你的环境中的性能。我们将使用 Redis 自带的 <code>redis-benchmark</code> 工具。假设你已经安装并运行了 Redis 服务器，以下是基准测试的步骤：</p><ol><li><strong>启动 Redis 服务器</strong>：</li></ol><p>确保 Redis 服务器已经在运行，默认情况下，它运行在端口 6379 上。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-server

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>运行基准测试</strong>：</li></ol><p>使用 <code>redis-benchmark</code> 工具进行基准测试。以下命令将测试 Redis 的性能，执行 100000 个请求，使用 50 个并发连接。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-benchmark <span class="token parameter variable">-n</span> <span class="token number">100000</span> <span class="token parameter variable">-c</span> <span class="token number">50</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>你会看到类似以下的输出：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> PING_INLINE <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
  <span class="token number">100000</span> requests completed <span class="token keyword">in</span> <span class="token number">1.32</span> seconds
  <span class="token number">50</span> parallel clients
  <span class="token number">3</span> bytes payload
  keep alive: <span class="token number">1</span>

<span class="token number">99.94</span>% <span class="token operator">&lt;=</span> <span class="token number">1</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">2</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">3</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">4</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">5</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">6</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">6</span> milliseconds

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> PING_BULK <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
  <span class="token number">100000</span> requests completed <span class="token keyword">in</span> <span class="token number">1.32</span> seconds
  <span class="token number">50</span> parallel clients
  <span class="token number">3</span> bytes payload
  keep alive: <span class="token number">1</span>

<span class="token number">99.96</span>% <span class="token operator">&lt;=</span> <span class="token number">1</span> milliseconds
<span class="token number">99.97</span>% <span class="token operator">&lt;=</span> <span class="token number">2</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">3</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">4</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">5</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">6</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">6</span> milliseconds

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> SET <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
  <span class="token number">100000</span> requests completed <span class="token keyword">in</span> <span class="token number">1.34</span> seconds
  <span class="token number">50</span> parallel clients
  <span class="token number">3</span> bytes payload
  keep alive: <span class="token number">1</span>

<span class="token number">99.94</span>% <span class="token operator">&lt;=</span> <span class="token number">1</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">2</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">3</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">4</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">5</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">6</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">6</span> milliseconds

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> GET <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
  <span class="token number">100000</span> requests completed <span class="token keyword">in</span> <span class="token number">1.35</span> seconds
  <span class="token number">50</span> parallel clients
  <span class="token number">3</span> bytes payload
  keep alive: <span class="token number">1</span>

<span class="token number">99.93</span>% <span class="token operator">&lt;=</span> <span class="token number">1</span> milliseconds
<span class="token number">99.98</span>% <span class="token operator">&lt;=</span> <span class="token number">2</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">3</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">4</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">5</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">6</span> milliseconds
<span class="token number">100.00</span>% <span class="token operator">&lt;=</span> <span class="token number">6</span> milliseconds

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>解释结果</strong>：以上输出结果表示不同命令的性能统计，例如 PING_INLINE、PING_BULK、SET、GET 等。每个部分显示了执行这些命令所花的时间和各百分位的响应时间。</li><li><strong>更多选项</strong>：你可以通过 <code>redis-benchmark --help</code> 查看更多选项和参数。例如，你可以指定不同的数据大小、命令类型和测试的键数等。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>redis-benchmark <span class="token parameter variable">--help</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过以上步骤，你可以基本了解 Redis 在你的环境中的性能表现。根据你的需求和测试结果，进一步优化 Redis 配置或硬件环境。</p><h3 id="_7-1-基准测试" tabindex="-1"><a class="header-anchor" href="#_7-1-基准测试" aria-hidden="true">#</a> 7.1. 基准测试</h3><h3 id="_7-2-慢查询" tabindex="-1"><a class="header-anchor" href="#_7-2-慢查询" aria-hidden="true">#</a> 7.2. 慢查询</h3><h3 id="_7-3-监控和报警" tabindex="-1"><a class="header-anchor" href="#_7-3-监控和报警" aria-hidden="true">#</a> 7.3. 监控和报警</h3><h3 id="_7-4-性能优化" tabindex="-1"><a class="header-anchor" href="#_7-4-性能优化" aria-hidden="true">#</a> 7.4. 性能优化</h3><h2 id="_8-生产实践" tabindex="-1"><a class="header-anchor" href="#_8-生产实践" aria-hidden="true">#</a> 8. 生产实践</h2><h3 id="_8-1-生产场景" tabindex="-1"><a class="header-anchor" href="#_8-1-生产场景" aria-hidden="true">#</a> 8.1. 生产场景</h3><ul><li>分布式 session</li><li>分布式锁</li><li>多级缓存（本地缓存+分布式缓存）</li><li></li></ul><h3 id="_8-2-问题及解决" tabindex="-1"><a class="header-anchor" href="#_8-2-问题及解决" aria-hidden="true">#</a> 8.2. 问题及解决</h3><p>缓存雪崩</p><p>缓存击穿</p><p>缓存穿透</p><p>双写一致性</p><p>热 key</p><p>大 key</p><p>分布式锁</p><h2 id="资料" tabindex="-1"><a class="header-anchor" href="#资料" aria-hidden="true">#</a> 资料</h2><ul><li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98" target="_blank" rel="noopener noreferrer">Redis 核心原理与实战<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98" target="_blank" rel="noopener noreferrer">Redis 核心技术与实战<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://pdai.tech/md/db/nosql-redis/db-redis-overview.html" target="_blank" rel="noopener noreferrer">Redis教程<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://xiaolincoding.com/redis/" target="_blank" rel="noopener noreferrer">图解Redis<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.cnblogs.com/xiaoyuxixi/p/15483837.html" target="_blank" rel="noopener noreferrer">Redis简介及常见问题处理（转） - 小雨淅淅o0 - 博客园<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://mp.weixin.qq.com/s/OHNkUBSFy00jQwoqrmwSwg" target="_blank" rel="noopener noreferrer">图文并貌，最强Redis详解分析<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://mp.weixin.qq.com/s/RnSokJxYxYDeenOP_JE3fQ" target="_blank" rel="noopener noreferrer">Redis分布式锁到底安全吗？<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://mp.weixin.qq.com/s/GWHXjVIohkK8BgW3vIUT1Q" target="_blank" rel="noopener noreferrer">Redis 10 大性能优化策略<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://mp.weixin.qq.com/s/OHNkUBSFy00jQwoqrmwSwg" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/OHNkUBSFy00jQwoqrmwSwg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><ol><li><a href="https://mp.weixin.qq.com/s/mGUPW9PNFi6bRqsxGpxHbQ" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/mGUPW9PNFi6bRqsxGpxHbQ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://mp.weixin.qq.com/s/jNVJHJOPUv6V9cRU8M75Hw" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/jNVJHJOPUv6V9cRU8M75Hw<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li></li><li><a href="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Redis%20%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e6%88%98/16%20Redis%20%e4%ba%8b%e5%8a%a1%e6%b7%b1%e5%85%a5%e8%a7%a3%e6%9e%90.md" target="_blank" rel="noopener noreferrer">https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Redis%20%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e6%88%98/16%20Redis%20%e4%ba%8b%e5%8a%a1%e6%b7%b1%e5%85%a5%e8%a7%a3%e6%9e%90.md<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://mp.weixin.qq.com/s/6C0DtcJvDDd2qXvCbqi8UA" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/6C0DtcJvDDd2qXvCbqi8UA<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/suprezheng/article/details/124560313?spm=1001.2014.3001.5501" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/suprezheng/article/details/124560313?spm=1001.2014.3001.5501<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.yuque.com/zeanzai.me/nox53r/xh82alhmr8rii1cg" target="_blank" rel="noopener noreferrer">https://www.yuque.com/zeanzai.me/nox53r/xh82alhmr8rii1cg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> redis 简介及常见问题处理</li></ol><h2 id="面试题" tabindex="-1"><a class="header-anchor" href="#面试题" aria-hidden="true">#</a> 面试题</h2><ol><li>简述一下“什么是 redis ”；</li><li>我们说 redis 存储数据类型时，是在说什么？什么是 RedisObject 系统？为什么要有这种系统？</li><li>简述一下 6 种基本数据类型，【保存的内容、命令、特殊应用场景、特殊应用场景的命令】</li><li>特殊的数据类型</li><li>持久化机制 <ol><li>RDB： <ol><li>基本原理</li><li>配置项</li><li>触发机制</li><li>服务崩溃后的应对过程</li></ol></li><li>AOF <ol><li>基本原理</li><li>配置项</li><li>重写的原理及过程中可能发生的问题</li></ol></li></ol></li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zeanzai/cs-tips/edit/main/demo/theme-docs/src/docs/04-middleware/redis.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><nav class="page-nav"><a href="/cs-tips/docs/04-middleware/nginx.html" class="nav-link prev" aria-label="nginx"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->nginx</div></a><a href="/cs-tips/docs/04-middleware/es.html" class="nav-link next" aria-label="搜索引擎知识点汇总"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">搜索引擎知识点汇总<!----></div></a></nav><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">浪漫骑士的二流键盘</div><div class="copyright">Copyright © 2024 zeanzai</div></footer></div><!--]--><!----><!----><!----><!--]--></div>
    <script type="module" src="/cs-tips/assets/app-fa4d50d2.js" defer></script>
  </body>
</html>
